define("helperChat",["niceScroll","vm","fancybox","weixinUtil","editImg","layui","upload","html2js","uploadCos","clipboard","weixinRecorder"],function(e,t,s){e("html2js"),$("#app").replaceWith(window.html2js["html/weixin_heck/helpChat_body.html2js.html"]),e("layui"),e("weixinRecorder");var i=e("editImg");$.fn.wxScroll=function(){var e=$(this);return e.niceScroll({cursorcolor:"#686b71",autohidemode:!0,cursorwidth:7,cursorborderradius:"999px",cursorborder:0}),e};new Clipboard(".copytext",{target:function(){return document.querySelector("#wechatName")}});$("[rel=gallery]").fancybox({openEffect:"none",closeEffect:"none"}),function(){var e=localInfo.userGroupList,t=[];for(var s in e)t.push({id:s,name:e[s]});localInfo.userGroupList=t}(),function(t){if(t.wxHeck=t.wxHeck||{},wxHeck.dataSource={localInfo:localInfo,userList:[],userListAll:[],userListGroup:[],userListPerson:[],groupUserLists:{},groupFromId:"",groupOwnner:"",showOwnnerBtn:!1,curUserId:"",msgList:{},trustList:[],comment:0,clientVersion:"",cloudVersion:"",topList:[],repeatEnter:!1},wxHeck.title=document.title,wxHeck.Util=e("weixinUtil"),wxHeck.Util.wxPop(),wxHeck.isChrome="Chrome"==wxHeck.Util.checkBrowser(),!wxHeck.isChrome)return $(".update_mask2").show();wxHeck.uploadFn=e("upload"),wxHeck.uploadFnCos=e("uploadCos"),wxHeck.userBox=$(".user_lists").wxScroll(),wxHeck.isCC=function(){return"cc"==wxHeck.wxInit.wxData.localInfo.admin_type},wxHeck.isSS=function(){return"is"==wxHeck.wxInit.wxData.localInfo.admin_type},wxHeck.getFullId=function(e){return wxHeck.wxInit.wxData.userList[0].split("$")[0]+"$"+e},wxHeck.userBoxTop=function(){var e=$(".user_lists").wxScroll();return function(){e.scrollTop(0)}}(),wxHeck.checkUserType=function(){var e="";return e=wxHeck.isCC()?6==localInfo.user_group||7==localInfo.user_group?"51Talk\u4e2d\u6559\u8001\u5e08: ":"51Talk\u8bfe\u7a0b\u987e\u95ee: ":"51Talk\u73ed\u4e3b\u4efb\u8001\u5e08\uff1a"},wxHeck.labelFn={nameMap:{},idMap:{},get:function(){if(!e)return[];var e=localInfo.labelList,t=this;$.map(e,function(e,s){$.map(e,function(e,s){t.nameMap[e.tag_name]=t.idMap[e.id]=e})})}},wxHeck.labelFn.get(),wxHeck.toTop=function(e){var t=wxHeck.wxInit.wxData,s=t.topList.indexOf(e)>-1?0:t.topList.length;e!=t.userList[s]&&(console.log("toTop"),t.userList.$remove(e),t.userList.splice(s,-1,e))},wxHeck.scrollToBottom=function(){wxHeck.msgBox&&wxHeck.msgBox.scrollTop(wxHeck.msgBox.get(0).scrollHeight)},wxHeck.isHelper=function(){return"helper"==wxHeck.wxInit.wxData.curUserId},wxHeck.getData=function(e){var t={type:"post",dataType:"json",error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}},s=$.extend({},t,e);$.ajax(s)},wxHeck.getDouble=function(e){var t=e+"";return t.length>1?t:"0"+t},wxHeck.getTime=function(e){var t=new Date(+e),s=[t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()];return s=$.map(s,function(e,t){return wxHeck.getDouble(e)}),s.slice(0,3).join("/")+" "+s.slice(3).join(":")},wxHeck.upLoadImgInit=function(e){wxHeck.uploadFn.init({progress:function(){return $(".send_progress>i")[0]},filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}]},BeforeUpload:function(t,s,i){e.setGroupChat.flag||e.helperSel.flag||i(s,function(t){wxHeck.pushMsg({pushId:e.wxData.curUserId,isCC:!0,msg:[t,s.fileFullName],time:(new Date).getTime(),cnt_type:9999})})},FileUploaded:function(t,s,i){var n={action:"chat",id:localInfo.id,type:"web",to_id:e.wxData.curUserId,to_type:"ios",content:s.fileFullName,cnt_type:1};return e.setGroupChat.flag?void e.sendGroupChat(n):e.helperSel.flag?void e.sendHelperChat(n):void wxHeck.sendMsg(n)},Error:function(e,t){alert(t.message)}})},wxHeck.upLoadFileInit=function(e){wxHeck.uploadFnCos.init({selector:"#send_file_button",fileLimitType:"jpg,jpeg,gif,png,bmp,pdf,doc,xlsx,txt,xls,docx,pptx,ppt",startCallBack:function(){e.loading.show=!0},error:function(t){return e.loading.show=!1,-1==t.errorCode?alert("\u6587\u4ef6\u4e0a\u4f20\u683c\u5f0f\u9519\u8bef\uff01"):-2==t.errorCode?alert("\u6700\u5927\u53ea\u80fd\u53d1\u90015M\u7684\u6587\u4ef6\uff01"):void 0},errorCallBack:function(t){alert(t.responseJSON.message),e.loading.show=!1},successCallBack:function(t){var s=JSON.stringify({title:t.fileInfo.fileName,introduction:t.fileInfo.fileSize+"K",icon:localInfo.fileicon,link:t.fileUpdate.data.access_url,id:t.fileUpdate.data.vid}),i={action:"chat",id:localInfo.id,to_id:wxHeck.wxInit.wxData.curUserId,type:"web",cnt_type:3e3,content:s};return e.helperSel.flag?(e.sendHelperChat(i),void(e.loading.show=!1)):(wxHeck.sendMsg(i),wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:s,cnt_type:3e3,time:(new Date).getTime()}),void(e.loading.show=!1))},progress:function(){return $(".send_progress>i")[0]}})},wxHeck.getTextPos=function(){var e=$(".send_text")[0];if(e)try{var t=e.selectionStart,s=e.selectionEnd;return{startPos:t,endPos:s,setPos:function(t){e.selectionStart=e.selectionEnd=t}}}catch(i){}},wxHeck.getUserList=function(){wxHeck.wxInit.wxData.userList.length>0||(wxHeck.sendMsg({action:"gain_user_list",id:localInfo.id,type:"web"}),wxHeck.sendMsg({action:"receive_wcmsg",id:localInfo.id,type:"web"}),wxHeck.sendMsg({action:"follow_info",id:localInfo.id,type:"web"}))},wxHeck.pushMsg=function(e){var t={pushType:"push",gotoBottom:!0,isGetHistory:!1,cnt_type:0},s=$.extend({},t,e);if(s.isGetHistory&&(s.gotoBottom=!1),wxHeck.wxInit.wxData.msgList&&wxHeck.wxInit.wxData.msgList[s.pushId]){var i={62:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u89c6\u9891\uff0c\u4f46\u6682\u65f6\u65e0\u6cd5\u5728\u7f51\u9875\u7aef\u770b\u7528\u6237\u7684\u89c6\u9891",492001:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u7ea2\u5305\uff0c\u53ef\u4ee5\u63d0\u9192\u7528\u6237\u6211\u4eec\u4e0d\u80fd\u63a5\u53d7\u5ba2\u6237\u7684\u7ea2\u5305",48:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u5730\u5740\uff0c\u4f46\u73b0\u5728\u4e0d\u652f\u6301\u67e5\u770b\u5730\u5740",50:"\u5bf9\u65b9\u9080\u8bf7\u4f60\u97f3\u89c6\u9891\u901a\u8bdd\uff0c\u4f46\u6211\u4eec\u4e0d\u652f\u6301\u97f3\u89c6\u9891\u901a\u8bdd"};if(s.msg=function(){if(0==s.cnt_type)return s._msg=wxHeck.Util.msgFilter(s.msg,!0),wxHeck.Util.msgFilter(s.msg);if(42==s.cnt_type||3e3==s.cnt_type||3100==s.cnt_type||495==s.cnt_type||4950==s.cnt_type||6e3==s.cnt_type||6001==s.cnt_type)try{return JSON.parse(s.msg)}catch(e){return s.msg}return i[s.cnt_type]||s.msg}(),wxHeck.wxInit.wxData.msgList[s.pushId].userMsg[s.pushType]({isCC:s.isCC,content:s.msg,time:wxHeck.getTime(s.time),name:s.name,cnt_type:s.cnt_type,mem_id:e.source?e.source.mem_id:"",from_id:e.source?e.source.from_id:""}),!s.isGetHistory){var n=wxHeck.wxInit.wxData.msgList[s.pushId].isGroup&&!s.isCC?s.name+":":"",a=function(){return 0==s.cnt_type?s._msg:1==s.cnt_type||9999==s.cnt_type?"[\u56fe\u7247\u6d88\u606f]":2==s.cnt_type?"[\u8bed\u97f3\u6d88\u606f]":42==s.cnt_type?"[\u540d\u7247\u6d88\u606f]":3e3==s.cnt_type?"[\u5361\u7247\u6d88\u606f]":495==s.cnt_type?"[\u6587\u7ae0\u6d88\u606f]":4950==s.cnt_type?"[\u52a0\u7fa4\u9080\u8bf7]":6e3==s.cnt_type?"[\u6536\u5230\u6587\u4ef6]":6001==s.cnt_type?"[\u89c6\u9891]":3100==s.cnt_type?s.msg.content:i[s.cnt_type]||s.msg}();wxHeck.wxInit.wxData.msgList[s.pushId].lastMsg=n+a}s.gotoBottom&&window.setTimeout(function(){wxHeck.scrollToBottom()},0)}},wxHeck.getImgUrl=function(e){if(!e)return"";var t=e.split(".")[0].replace(/h.*\//,""),s={testtest1117:"bbimage1",weixinheiniao:"bbimage2"},i=e.replace(/h.*com/,"/"+s[t]);return i},wxHeck.isMyFriend=function(e){return $.inArray(e,wxHeck.wxInit.wxData.userList)>-1},wxHeck.flashTitle=wxHeck.Util.flashText(),wxHeck.flashTitleFn=function(){var e=document.title;return{set:function(e){wxHeck.flashTitle.set(e,function(e){document.title=e})},reset:function(t){wxHeck.flashTitle.reset(function(){document.title=e,"function"==typeof t&&t()})}}}();var s=Vue.extend({template:"#weixin_sel_bom",data:function(){return{selSelect:[],selFilter:"",selShow:!1,openType:"getChat",inputMsg:"",selLabel:"",selLabelss:localInfo.labelList,selList:[],chatType:"",isPending:{flag:!1,text:"",isSure:!1,sureText:""}}},props:{selData:{"default":function(){return{}}},selLabels:{"default":function(){return[]}},localInfo:{"default":function(){return{}}}},computed:{inputMsgVal:function(){return $.trim(this.inputMsg)},isGetGroupChat:function(){return"getGroupChat"==this.openType},isSingle:function(){return this.isGetGroupChat&&"0"==this.chatType},isGroup:function(){return this.isGetGroupChat&&"1"==this.chatType},selTitle:function(){return this.isSingle?"\u7fa4\u53d1\u4e2a\u4eba":this.isGroup?"\u7fa4\u53d1\u7ed9\u7fa4":"\u9009\u62e9\u8054\u7cfb\u4eba"},selLists:function(){var e=this,t=$.trim(e.selFilter),s=e.selLabel;if(""==t&&""==s||0==e.selList.length)return e.selList;var i=[];return $.map(e.selList,function(n,a){var o=e.selData[n].userInfo,r=e.isMath(o.c_remark,t)||e.isMath(o.nick,t),c=o.label.indexOf(s)>-1;r&&c&&i.push(n)}),i},isSelUserAll:function(){var e=this,t=$.trim(e.selFilter),s=e.selLabel;if(0==e.selList.length||0==e.selLists.length)return!1;if(""==t&&""==s)return e.selLists.length==e.selSelect.length;var i=!0;return $.map(e.selLists,function(t,s){return-1==e.selSelect.indexOf(t)?(i=!1,!1):void 0}),i}},watch:{selSelect:function(e){this.isGetGroupChat&&this.$dispatch("getSelList",e)}},methods:{isMath:function(e,t){return e?e.indexOf(t)>-1:void 0},selUser:function(e){var t=this.selSelect.indexOf(e);t>-1?this.selSelect.splice(t,1):this.selSelect.unshift(e)},selDel:function(e){this.selSelect.$remove(e)},selUserAll:function(){var e=this,t=$.trim(e.selFilter),s=e.selLabel;0!=e.selList.length&&0!=e.selLists.length&&(""==t&&""==s?e.isSelUserAll?e.selSelect=[]:e.selSelect=e.selLists.slice():e.isSelUserAll?$.map(e.selLists,function(t,s){e.selSelect.$remove(t)}):$.map(e.selLists,function(t,s){-1==e.selSelect.indexOf(t)&&e.selSelect.unshift(t)}))},selCancel:function(){this.selShow=!1,this.selSelect=[],this.selFilter="",this.inputMsg="",this.selLabel="",this.chatType="",this.isPendingDefault()},isPendingDefault:function(){this.isPending.flag=!1,this.isPending.isSure=!1,this.isPending.sureText="",this.isPending.text=""},selOpen:function(){this.selShow=!0,this.$nextTick(function(){$(".sel_list").each(function(e,t){$(t).wxScroll()})})},selSure:function(){if(0!=this.selSelect.length&&("getGroup"!=this.openType||""!=this.inputMsg)){var e=this;e.$dispatch("userSelSure",{openType:e.openType,returnData:{selectList:e.selSelect.slice(),inputMsg:e.inputMsg}})}}},events:{userSelOpen:function(e){this.openType=e.type,this.chatType=e.chatType,this.selList=e[this.isGroup?"listGroup":"listPerson"],this.selOpen()},userSelClose:function(){this.selCancel()},userSelPending:function(e){this.isPending.text=e,this.isPending.flag=!0},userSelPendingSure:function(e){this.isPending.isSure=!0,this.isPending.sureText=e},userSelPendingDefault:function(){this.isPendingDefault()}}}),n=Vue.extend({template:"#weixin_edit",data:function(){return{editShow:!1,editvalue:"",isGroup:!1}},computed:{editValue:function(){return $.trim(this.editvalue)}},methods:{selCancel:function(){this.editShow=!1,this.editvalue=""},selSure:function(){""!=this.editValue&&this.$dispatch("editNameSure",{isGroup:this.isGroup,editValue:this.editValue})}},events:{editNameOpen:function(e){this.editvalue=e.reMark,this.editShow=!0,this.isGroup=e.isGroup},editNameClose:function(){this.selCancel()}}}),a=Vue.extend({template:"#quick_con",data:function(){return{conList:[],inputData:"",tagSel:{selShow:!1,selData:[],selName:""},isSearch:!1,tagList:[],labelId:""}},props:{isShow:{"default":!1},isGroup:!1},methods:{sendQuickCon:function(e){this.$dispatch("getQuickCon",e)},selShow:function(){var e=this;0!=e.tagSel.selData.length||e.tagSel.selShow?e.tagSel.selShow=!e.tagSel.selShow:wxHeck.getData({url:"/Knowledge/getCardKeyword",data:{admin_id:localInfo.admin_id},success:function(t){return 1e4!=t.status?alert(t.message):(e.tagSel.selData=t.message,void(t.message.length>0&&(e.tagSel.selShow=!0)))}})},getTag:function(e){var t=this;t.tagSel.selShow=!1,t.labelId=e.id,console.log(e.id),wxHeck.getData({url:"/Knowledge/getCardPushByKeywordId",data:{keyword_id:e.id,admin_id:localInfo.admin_id},success:function(s){return 1e4!=s.status?alert(s.message):(t.conList=s.message,t.inputData="",t.tagSel.selName=e.name,void(0!=t.conList.length&&(t.isSearch=!1)))}})},selHide:function(){this.tagSel.selShow=!1}},watch:{inputData:function(e){var t=$.trim(e),s=this;return""==t?s.conList=[]:void wxHeck.getData({url:"/Knowledge/getPushContent",data:{name:t,admin_id:localInfo.admin_id},success:function(e){if(1e4!=e.status)return alert(e.message);var i=new RegExp(t.split(/\s+/).join("|"),"gi"),n=function(e){return 0==e.length?e:$.map(e,function(e,t){return e._content=e.content.replace(i,function(e){return"<em>"+e+"</em>"}),e})}(e.message);s.conList=n,s.tagSel.selName="",0!=s.conList.length&&(s.isSearch=!0)}})}},events:{setTagList:function(e){e?this.tagList=e.labelList:this.tagList=[],this.labelId=""},setSelData:function(e){this.inputData=e}}}),o=Vue.extend({template:"#user_search",props:{selList:{"default":function(){return[]}},selData:{"default":function(){return{}}},localInfo:{"default":function(){return{}}}},data:function(){return{selFilter:"",showSel:!1,canHideFlag:!0}},computed:{userListFilter:function(){var e=this,t=$.trim(e.selFilter);if(""==t||0==e.selList.length)return e.showSel=!1,[];var s=[];return $.map(e.selList,function(i,n){var a=e.selData[i].userInfo;(e.isMath(a.c_remark,t)||e.isMath(a.nick,t))&&s.push(i)}),e.showSel=!0,s}},methods:{isMath:function(e,t){return e?e.indexOf(t)>-1:void 0},searchReturn:function(e){this.$dispatch("getSearch",e),this.selFilter="",this.showSel=!1},searchHide:function(){this.canHideFlag&&(this.showSel=!1)},cannotHide:function(){this.canHideFlag=!1},canHide:function(){this.canHideFlag=!0}},ready:function(){$(".user_search_result").wxScroll()}}),c=Vue.extend({template:"#user_type",props:["selLabels","listType"],methods:{setType:function(e){e!=this.type&&(this.type=e,this.$dispatch("setListType",e))}}}),u=Vue.extend({template:"#user_types",data:function(){return{type:"",show:!1}},props:["localInfo"],methods:{setType:function(e){this.type=e,this.$dispatch("setListType",e),this.show=!1},showFn:function(){this.show=!this.show},hideFn:function(){this.show=!1}},computed:{showType:function(){var e=this.type;return""==e?"\u5168\u90e8":"todayFocus"==e?"\u4eca\u65e5\u5173\u6ce8":e}}}),d=Vue.extend({template:"#info_update",data:function(){return{updateShow:!1}},props:["localInfo","nickName","userGroup","deviceId","rankList"],methods:{updateHide:function(){this.updateShow=!1,this.nickName=this.localInfo.nick_name,this.userGroup=this.localInfo.user_group,this.deviceId=this.localInfo.device_id,this.rankList=this.localInfo.rank_list},updateInfoFn:function(){var e=this;if(e.canUpdate){var t={admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id,user_group:e.userGroup,nick_name:$.trim(e.nickName),device_id:$.trim(e.deviceId),rank_list:$.trim(e.rankList).replace(/\uff0c/g,",")};wxHeck.getData({url:"/AdminContact/updateAdminWechatContact",data:t,success:function(s){return 1e4!=s.status?alert(s.message):(e.$dispatch("infoUpdateCb",t),void alert("\u66f4\u65b0\u6210\u529f"))}})}}},computed:{canUpdate:function(){return""!=$.trim(this.nickName)&&!!this.userGroup&&""!=$.trim(this.deviceId)},initShow:function(){return!this.localInfo.nick_name||!this.localInfo.user_group||!this.localInfo.device_id}},events:{showUpdate:function(){this.updateShow=!0},hideUpdate:function(){this.updateHide()}}}),l=Vue.extend({template:"#errors_tip",data:function(){return{errors:{netErr:!1,phoneErr:!1},iscc:!1,isss:!1,errDetail:!1,ttt:20,bTime:20,isErrored:!1,mt:null,wechatId:localInfo.wechat_id,crm:localInfo.id,resetError:{show:!1,time:10,timeRemark:10,mt:null,send:!1},showLast:!1}},methods:{sendStatus:function(e){wxHeck.getData({url:"/AdminMonitor/addAdminMonitorLog",data:{wechat_id:localInfo.wechat_id,status:e},error:function(){}})},reload:function(){window.location.reload()},resetErr:function(){if(!this.resetError.send&&!this.resetError.show){var e=this;clearInterval(this.resetError.mt),wxHeck.getData({beforeSend:function(){e.resetError.send=!0},url:"/AdminContact/killWechat",data:{wechat_id:localInfo.wechat_id},timeout:5e3,success:function(t){return 1e4!=t.status?void _alert(t.message,function(){e.resetErrClear(),e.showLast=!0}):void e.resetErrSuccess()},complete:function(){e.resetError.send=!1},error:function(){_alert("\u64cd\u4f5c\u5931\u8d25",function(){e.resetErrClear(),e.showLast=!0})}})}},resetErrSuccess:function(){this.resetError.show=!0,this.resetError.mt=setInterval(function(){this.resetError.time>1?this.resetError.time--:(this.resetErrClear(),this.showLast=!0)}.bind(this),1e3)},resetErrClear:function(){clearInterval(this.resetError.mt),this.errDetail=!1,this.resetError.time=this.resetError.timeRemark,this.resetError.show=!1}},props:{deviceId:{"default":""}},computed:{errorsTipShow:function(){var e=this.errors;for(var t in e)if(e[t])return!0;return!1}},events:{setErrors:function(e){var t=this,s=this.errors;for(var i in e)i in s&&(s[i]=e[i]);return this.iscc=e.iscc,this.isss=e.isss,s.netErr?(console.log(t.mt),clearInterval(t.mt),t.bTime=t.ttt,t.errDetail=!1,void(t.iscc=t.isss=!1)):(clearInterval(t.mt),void(s.phoneErr?(this.isErrored=!0,t.sendStatus(1),t.mt=setInterval(function(){t.bTime>1?t.bTime--:(t.sendStatus(3),clearInterval(t.mt),t.bTime=t.ttt,t.errDetail=!0,t.iscc=t.isss=!1)},1e3)):this.isErrored&&(console.log("\u624b\u673a\u4e0a\u7ebf"),t.bTime!=t.ttt&&t.sendStatus(2),clearInterval(t.mt),t.bTime=t.ttt,t.errDetail=!1,t.iscc=t.isss=!1,this.errDetail=!1,this.showLast=!1,this.resetErrClear())))}}}),h=Vue.extend({template:"#add_friend",data:function(){return{toNext:!1,addFriendShow:!1,wxAcc:"",wxDes:"",type:"0",wechat_img:"",wechat_nick:"",remark:"",crmId:"",crmMobile:"",addType:""}},props:["localInfo"],methods:{addFriendHide:function(){this.crmId="",this.crmMobile="",this.remark="",this.wechat_nick="",this.wechat_img="",this.type="0",this.wxDes="",this.wxAcc="",this.addType="",this.addFriendShow=!1,this.toNext=!1},addFriendNext:function(){if(this._wxAcc){if(this.addType)return void this.$dispatch("addFriendNextCb",{keyword:this._wxAcc});var e=/^1[3|4|5|7|8][0-9]{9}$/;if(e.test(this._wxAcc)){var t=this;wxHeck.getData({url:"/UserContact/searchUserInfo",data:{user_num:t._wxAcc},success:function(e){e.message.id?(t.crmId=e.message.id,t.crmMobile=e.message.mobile,t.$dispatch("addFriendNextCb",{keyword:t._wxAcc,crmId:t.crmId})):t.$dispatch("addFriendNextCb",{keyword:t._wxAcc})}})}else this.$dispatch("addFriendNextCb",{keyword:this._wxAcc})}},addFriendFn:function(){var e=this;e.canUpdate&&wxHeck.getData({url:"/UserContact/remindCount",data:{admin_id:localInfo.id},success:function(t){return 1e4!=t.status?_alert(t.message):void _confirm(t.message,function(){e.$dispatch("addFriendCb",{wxid:e.wxAcc,verify_msg:e._wxDes,type:e.type,user_id:e.crmId,mobile:e.crmMobile,remark:e.remark})})},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")}})}},computed:{_wxAcc:function(){return $.trim(this.wxAcc)},_wxDes:function(){return $.trim(this.wxDes)},canUpdate:function(){return""!=this._wxAcc&&""!=this._wxDes}},events:{showAddFriend:function(e){1==e.type?this.wxAcc=e.wxAcc:this.wxAcc=e.acc||"",this.type=e.type,this.wxDes=wxHeck.checkUserType()+this.localInfo.nick_name,this.crmId=e.crmId||"",this.crmMobile=e.crmMobile||"",this.addType=e.addType||"",this.addFriendShow=!0},addFriendToNext:function(e){var t=this,s=/^1[3|4|5|7|8][0-9]{9}$/,i=[];!function(){t.crmId&&i.push(t.crmId),i.push(e.wechat_nick),t.crmMobile?i.push(t.crmMobile):s.test(t._wxAcc)&&i.push(t._wxAcc)}(),this.wechat_img=e.wechat_img,this.wechat_nick=e.wechat_nick,this.remark=i.join("-"),this.toNext=!0},addFriendGoNext:function(e){this.wechat_img=e.wechat_img,this.wechat_nick=e.wechat_nick,this.toNext=!0,this.wxAcc=e.wxid.split("$")[1],this.wxDes=wxHeck.checkUserType()+this.localInfo.nick_name,this.addFriendShow=!0},hideAddFriend:function(){this.addFriendHide()}}}),w=Vue.extend({template:"#send_paste",data:function(){return{sendPasteShow:!1,imgSrc:"",sureDisable:!1}},methods:{hide:function(){this.sendPasteShow=!1,this.imgSrc="",this.sureDisable=!1},send:function(){this.sureDisable=!0,this.$dispatch("getSendPaste",{imgSrc:this.imgSrc})}},events:{openSendPaste:function(e){this.sendPasteShow=!0,this.imgSrc=e.imgSrc},enableSendPaste:function(){this.sureDisable=!1},hideSendPaste:function(){this.hide()}}}),p=Vue.extend({template:"#send_face",data:function(){return{show:!1,curType:0,faceData:[{type:0,des:"\u9ed8\u8ba4\u8868\u60c5",data:wxHeck.Util.qqfaceConfigArr}]}},methods:{changType:function(e){this.curType!=e&&(this.curType=e)},sendFace:function(e,t){this.$dispatch("getFace",{type:e,con:t})},sendFaceShow:function(){this.show=!this.show},sendFaceHide:function(){this.show=!1}}}),f=Vue.extend({template:"#send_img"}),m=Vue.extend({template:"#send_article",data:function(){return{isLoading:!0,articleListShow:!1,navlist:{},articleListData:[],curArticleIndex:null,articlePageCount:0,articleCurrentPage:null}},methods:{show:function(){this.articleListShow=!0,this.articleListData.length>0||(this.getArticle("1"),this.$nextTick(function(){$(".con-show").niceScroll({autohidemode:!1,cursorcolor:"#686b71",cursoropacitymin:.7,cursoropacitymax:.7})}))},getArticle:function(e){if(e!=this.articleCurrentPage){var t=this;wxHeck.getData({url:"/Article/getArctype",success:function(e){return 1e4!=e.status?alert(e.message):void(t.navlist=e.message)}}),wxHeck.getData({url:"/Article/chatList",beforeSend:function(){},data:{page:1,aid:e},success:function(s){return 1e4!=s.status?alert(s.message):(t.articleListData=s.message.list,t.articlePageCount=s.message.pageCount,t.articleCurrentPage=e,void(t.curArticleIndex=null))},complete:function(){t.isLoading=!1}})}},hide:function(){this.articleListShow=!1,this.curArticleIndex=null,this.articleCurrentPage=null,this.articleListData=[]},cutAticle:function(e){this.curArticleIndex=e,this.articleListShow=!0},sendArticle:function(){var e=JSON.stringify({title:this.articleListData[this.curArticleIndex].title,introduction:this.articleListData[this.curArticleIndex].introduction,icon:this.articleListData[this.curArticleIndex].icon,link:this.articleListData[this.curArticleIndex].link,id:this.articleListData[this.curArticleIndex].id}),t={action:"chat",id:localInfo.id,to_id:wxHeck.wxInit.wxData.curUserId,type:"web",cnt_type:3e3,content:e};wxHeck.wxInit.setGroupChat.flag?wxHeck.wxInit.sendGroupChat(t,!0):wxHeck.wxInit.helperSel.flag?wxHeck.wxInit.sendHelperChat(t,!0):(wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:e,cnt_type:3e3,time:(new Date).getTime()}),wxHeck.sendMsg(t)),this.curArticleIndex=null,this.articleCurrentPage=null,this.articleListData=[],this.articleListShow=!1}}}),g=Vue.extend({template:"#send_file"}),x=Vue.extend({template:"#send_voice",data:function(){return{creat:!1,show:!0,isStep2:!1,isOver:!1,time:0,timeLimit:60,audioName:"voice",recorderOpen:!1,mt:null,pending:!1}},methods:{open:function(){this.creat=!0,this.show=!0},close1:function(){this.show=!1},start:function(){FWRecorder.record(this.audioName,"audio.wav")},close2:function(){this.clear(),this.show=!1},clear:function(){this.stopRecording(),this.time=0,this.isStep2=!1,this.isOver=!1},stopRecording:function(){FWRecorder.stopRecording(this.audioName),clearInterval(this.mt)},startRecord:function(){this.isStep2=!0,clearInterval(this.mt),this.mt=window.setInterval(function(){this.time<this.timeLimit?this.time=Math.ceil(FWRecorder.duration(this.audioName)):(this.stopRecording(),this.isOver=!0)}.bind(this),1e3)},end:function(){var e=this;e.pending=!0,e.stopRecording(),window.setTimeout(function(){wxHeck.getData({url:"/UploadFile/uploadRecorder",type:"post",dataType:"json",data:{file_base64:FWRecorder.getBase64(e.audioName)},success:function(t){return 1e4!=t.status?void _alert(t.message,function(){e.pending=!1}):(e.sendVoiceFn(t.message),e.close2(),void(e.pending=!1))},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01",function(){e.pending=!1})}})},0)},sendVoiceFn:function(e){wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:e,time:(new Date).getTime(),cnt_type:2})}}}),_=Vue.extend({template:"#chat_tools",components:{sendImg:f,sendFace:p,sendArticle:m,sendFile:g,sendVoice:x}}),k=Vue.extend({template:"#update_wechat",data:function(){return{waiting:!0}},props:["clientVersion","cloudVersion"],computed:{updataShow:function(){return parseInt(this.clientVersion)<parseInt(this.cloudVersion)}},methods:{onUpdate:function(){wxHeck.sendMsg({action:"get_version",id:localInfo.id,type:"web"}),setTimeout(function(){location.reload()},3e4),this.waiting=!1}}}),y=Vue.extend({template:"#logout",data:function(){return{logoutShow:!1,selSelect:"",selFilter:""}},props:{selList:{"default":function(){return[]}},selData:{"default":function(){return{}}}},computed:{selLists:function(){var e=this,t=$.trim(e.selFilter);if(""==t||0==e.selList.length)return e.selList;var s=[];return $.map(e.selList,function(i,n){var a=e.selData[i].userInfo,o=(a.c_remark||a.nick).indexOf(t)>-1;o&&s.push(i)}),s}},methods:{userLogout:function(){window.confirm("\u786e\u8ba4\u9000\u51fa\uff1f")&&wxHeck.Util.closeTab()},selHide:function(){this.logoutShow=!1,this.selFilter="",this.selSelect=""},selUser:function(e){e==this.selSelect?this.selSelect="":this.selSelect=e},selOpen:function(e){var t=this,s=e+"";!function(){if(""!=e){var i=$.inArray(s,t.selList);-1!=i&&(t.selList.splice(i,1),t.selList.unshift(s),t.selSelect=s)}}(),this.logoutShow=!0,this.$nextTick(function(){$(".sel_list").each(function(e,t){$(t).wxScroll()})})},userLogoutTrust:function(){""!=this.selSelect&&this.$dispatch("userLogoutTrust",this.selSelect)}},events:{logoutShowFn:function(e){this.selOpen(e)}}}),I=Vue.extend({template:"#fn_tab",data:function(){return{show:!1,pos:{left:0,top:0},sendData:""}},methods:{hide:function(){this.show=!1},sendSelData:function(){this.$dispatch("getSelData",this.sendData),this.hide()},open:function(e){this.pos.left=e.pos.left+"px",this.pos.top=e.pos.top-35+"px",this.sendData=e.sendSelData,this.show=!0,this.$nextTick(function(){document.querySelector(".fn_tab").focus()})}},events:{openFnTab:function(e){this.open(e)},closeFnTab:function(){this.hide()}}}),v=Vue.extend({template:"#crm_remark",data:function(){return{remarks:[],isshow:!1,inputData:"",userId:"",showTip:!1,selTime:"",selYear:"2017",selMonth:"1",selDay:"1",demo:!1}},computed:{_inputData:function(){return $.trim(this.inputData)}},methods:{hide:function(){this.isshow=!1,this.remarks=[],this.inputData="",this.userId="",this.showTip=!1},show:function(){this.isshow=!0,this.$nextTick(function(){$(".add-info-scroll").wxScroll()})},addRemark:function(){this.demo?this.selTime=this.selYear+"-"+this.selMonth+"-"+this.selDay:this.selTime="";var e=this;""!=e._inputData&&wxHeck.getData({url:"/Remark/addNew",data:{user_id:e.userId,content:e._inputData,follow_date:e.selTime},success:function(t){return 1e4!=t.status?alert(t.message):(e.inputData="",e.showTip=!0,clearTimeout(e.tm),void(e.tm=setTimeout(function(){e.showTip=!1},1500)))}})},addRemarkTime:function(){this.demo=!this.demo}},events:{crmRemarkOpen:function(e){var t=new Date;this.selYear=t.getFullYear(),this.selMonth=t.getMonth()+1,this.selDay=t.getDate()+1;var s=this;s.userId=e.user_id,wxHeck.getData({url:"/Remark/list",data:{user_id:s.userId},success:function(e){s.remarks=e.message.reverse()}}),s.show()}}}),H=Vue.extend({template:"#quick_tab",data:function(){return{show:!1,pos:{left:0,top:0},name:"",from_id:"",mem_id:"",groupUserInfo:{groupUserWechat_id:"",groupUserWechat_nick:""},showChatList:!1,chatListDetail:[],voicePlay2:{voiceSrc2:"",playVoiceSrc2:""},contentType:{types:["0","1","2","9999","42","3000","3100","4000","5000","495","4950","6000","6001","10000"]},delShow:{show:!1},videoUrl:""}},methods:{atUser:function(){var e=this.mem_id.split("$");return""==e[1]?void _alert("\u975e\u6cd5@"):e[0]==e[1]?void _alert("\u4e0d\u80fd@\u81ea\u5df1"):(this.$dispatch("getAt",this.name,this.mem_id),void(this.show=!1))},privateChat:function(){console.log("++++"+this.mem_id),console.log("----"+this.groupUserInfo.groupUserWechat_id);var e=this.mem_id.split("$");return""==e[1]?void _alert("\u4e0d\u80fd\u79c1\u804a\uff01"):e[0]==e[1]?void _alert("\u4e0d\u80fd\u79c1\u804a\u81ea\u5df1"):(this.$dispatch("oneChat",this.mem_id),this.show=!1,void console.log("\u79c1\u804a:"+this.mem_id))},getChatList:function(){var e=this;return e.mem_id.split("$")[1]?void wxHeck.getData({url:"/WechatMessage/getChatSelfMessage",data:{wechatId:e.from_id,ccId:localInfo.id,mem_id:e.mem_id.split("$")[1]},success:function(t){if(e.show=!1,1e4!=t.status)return alert(t.message);for(var s=0;s<t.message.length;s++)(495==t.message[s].cnt_type||4950==t.message[s].cnt_type||6e3==t.message[s].cnt_type||6001==t.message[s].cnt_type)&&(t.message[s].content=JSON.parse(t.message[s].content));e.chatListDetail=t.message,e.showChatList=!0,e.$nextTick(function(){$(".chat-content").wxScroll()})}}):_alert("\u5bf9\u4e0d\u8d77\uff0c\u5f53\u524d\u8bb0\u5f55\u6682\u4e0d\u80fd\u67e5\u8be2")},delCutUser:function(){this.$dispatch("groupListUserDelete",this.groupUserInfo),console.log(this.groupUserInfo),this.show=!1},closeChatDetail:function(){this.showChatList=!1},hide:function(){this.show=!1,this.mem_id=""},playVoice2:function(e){this.voicePlay2.voiceSrc2=e,this.$nextTick(function(){voiceMsgPlayer2.play()})},isPlaying:function(){this.voicePlay2.playVoiceSrc2=this.voicePlay2.voiceSrc},isEnded:function(){this.voicePlay2.playVoiceSrc2=""}},events:{openQuickTab:function(e){console.log(e),this.from_id=e.from_id||e.curtId,console.log(this.from_id),this.mem_id=e.mem_id,this.name=e.name,this.pos.left=e.event.x+"px",this.pos.top=e.event.y+"px",this.show=!0,this.$nextTick(function(){$(".quick_tab")[0].focus()}),this.groupUserInfo.groupUserWechat_id=e.wechat_id,this.groupUserInfo.groupUserWechat_nick=e.wechat_nick},showDelBtn:function(e){this.delShow.show=e},delGroupListUser:function(e){if(1e4==e.status){var t=wxHeck.dataSource.groupUserLists[e.from_id];console.log(t);for(var s=this.groupUserInfo.groupUserWechat_id,i=0;i<t.length;i++)t[i].wechat_id==s&&t.splice(i,1);_alert("\u5220\u9664\u6210\u529f")}else _alert(e.message)}},filters:{paser:function(e,t){this.$data.chatListDetail[t].content=JSON.parse(e)},artile:function(e,t,s){return"string"==typeof t?JSON.parse(t)[s]:void 0}}}),b=Vue.extend({template:"#page",data:function(){return{current:1,showItem:6,allpage:1}},computed:{pages:function(){var e=[];if(this.current<this.showItem)for(var t=Math.min(this.showItem,this.allpage);t;)e.unshift(t--);else{var s=this.current-Math.floor(this.showItem/2),t=this.showItem;for(s>this.allpage-this.showItem&&(s=this.allpage-this.showItem+1);t--;)e.push(s++)}return e}},methods:{"goto":function(e){this.current=e,this.$dispatch("goPage",e)}},events:{changePage:function(e){this.allpage=e.pageCount,this.current=e.pageCurrent}}}),S=Vue.extend({template:"#myStudyLayer",data:function(){return{startTime:"",endTime:"",show:!1,friends:[],uids:[],user_info:"",studyList:[],curStudyList:[],detailPage:2,countPage:null,cutPage:1,hasStudy:!1,cc:!1,ss:!1,cutBtn:{appoint_status:1,date_type:0,appoint_time:""},cutSelUserList:[],addStatus:{isSelUserId:"",unfind:!1,adding:!1}}},components:{page:b},methods:{selUser:function(e){this.addStatus.isSelUserId=e},selStudyList:function(){var e=this;wxHeck.getData({url:"/UserContact/remindCount",data:{admin_id:localInfo.id},success:function(t){return 1e4!=t.status?_alert(t.message):void _confirm(t.message,function(){_confirm("\u6279\u91cf\u6dfb\u52a0\u4e86"+e.cutSelUserList.length+"\u4eba\u8017\u65f6\u5728"+e.cutSelUserList.length+"\u5206\u949f\u5de6\u53f3\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",function(){wxHeck.getData({url:"/MassAddUserWechat/addCrmUser",data:{admin_id:localInfo.admin_id,user_id:e.cutSelUserList},success:function(e){return 1e4!=e.status?_alert(e.message):void _alert(e.message)}}),e.$dispatch("reGetMyStudy"),e.cutSelUserList=[]})})},error:function(){
_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")}})},hideMyStudy:function(){this.show=!1,this.cutBtn.appoint_status=1,this.cutSelUserList=[]},addChat:function(e){this.$dispatch("studyChat",this.user_info+"$"+e),this.show=!1},goAddFriend:function(e,t,s){this.$dispatch("addListFriend",e,t,s)},crmRemarkTable:function(e){this.$dispatch("crmRemarkTableOpen",e)},telphone:function(e,t){this.$dispatch("callTelpnone",e,t)},studyChat:function(e){this.show=!1,this.$dispatch("studyChat",e)},changePage:function(e){var t=this;setTimeout(function(){t.$broadcast("changePage",e)},0)},checkType:function(e){var t="",s=this;if(wxHeck.isSS()){s.cutBtn.appoint_status=1,t="/UserContact/getCrmUser";var i={start_time:studyStartTime.value,end_time:studyEndTime.value,page_num:1,page_size:10,appoint_status:1}}if(wxHeck.isCC()){switch(e){case"classA":s.cutBtn.appoint_status=1;break;case"classB":s.cutBtn.appoint_status=2;break;case"classC":s.cutBtn.appoint_status=3;break;case"classD":s.cutBtn.appoint_status=4;break;default:s.cutBtn.appoint_status=1}t="/UserContact/getCrmUserByCc";var n=new Date(studyEndTime.value).getTime()+1728e5,a=new Date(n),o=a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1),r=a.getDate()>9?a.getDate():"0"+a.getDate(),c=a.getFullYear()+"-"+o+"-"+r,i={start_time:studyStartTime.value,end_time:c,page_num:1,page_size:10,appoint_status:s.cutBtn.appoint_status}}wxHeck.getData({url:t,data:i,success:function(e){return 1e4!=e.status?_alert(e.message):void(0==e.message.list.length?(s.curStudyList=[],s.hasStudy=!1):(s.curStudyList=e.message.list,s.hasStudy=!0,setTimeout(function(){s.$broadcast("changePage",e.message.pagenation)},0)))}})}},events:{studySearch:function(){this.checkType()},goPage:function(e){this.cutPage=e;var t=this,s="",i={start_time:studyStartTime.value,end_time:studyEndTime.value,page_num:e,page_size:10,appoint_status:t.cutBtn.appoint_status};wxHeck.isSS()&&(s="/UserContact/getCrmUser"),wxHeck.isCC()&&(s="/UserContact/getCrmUserByCc",i.appoint_id=t.appoint_status),wxHeck.getData({url:s,data:i,success:function(e){return 1e4!=e.status?_alert(e.message):void(t.curStudyList=e.message.list)}})},showMyStudyLayer:function(e){this.user_info=e.user_info,this.startTime=e.myStudyData.date.startTime,this.endTime=wxHeck.Util.setDate(0),0!=e.myStudyData.list.length&&(this.hasStudy=!0,this.curStudyList=e.myStudyData.list,this.pageCount=e.myStudyData.pagenation.pageCount,this.pageSize=e.myStudyData.pagenation.pageSize,this.pageCurrent=e.myStudyData.pagenation.pageCurrent,this.changePage(e.myStudyData.pagenation)),this.show=!0},setTimePast:function(e){this.startTime=e},setTimeNow:function(e){this.endTime=e},setStudyTypeBoolean:function(e){this.cc=e.cc,this.ss=e.ss}},watch:{cutPage:function(e){var t=this.detailPage*(this.cutPage-1),s=this.detailPage*this.cutPage;this.curStudyList=this.studyList.slice(t,s)}},filters:{m_d_h_m:function(e){return e.substring(6,16)},h_m:function(e){return e.substring(11,16)}}}),D=Vue.extend({template:"#myFriend",data:function(){return{isShow:!1,list:[],pending:!0}},methods:{hide:function(){this.isShow=!1,this.list=[],this.pending=!0},show:function(){this.isShow=!0,this.$nextTick(function(){$(".friend-box-in ul").wxScroll()})},accept:function(e){wxHeck.sendMsg({action:"add_hello_friend",id:localInfo.id,type:"web",encryptusername:e})},ignore:function(e){wxHeck.sendMsg({action:"add_hello_friend",id:localInfo.id,type:"web",encryptusername:e})}},events:{myFriendShow:function(){this.show()},myFriendData:function(e){this.list=e,this.pending=!1},myFriendSure:function(e){var t=this,s=t.list;$.map(s,function(t,i){return t.encryptusername==e?(s[i].encryptusername="",!1):void 0})}}}),L=Vue.extend({template:"#homeWork",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",groupId:"",editKey:"",edit$Key:"",groupData:{},groupheader:"",scoreShow:!1,score:"",imgSrc:"",scoreAudioShow:!1,audioText:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},cur$key:"",comText:""}},methods:{playVoice:function(e){this.voicePlay.voiceSrc=e,this.$nextTick(function(){voiceMsgPlayer3.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},shList:function(e,t,s){this.list[t][s].showTool=0==e},editList:function(e,t){this.cur$key=t;var s=wxHeck.getImgUrl(this.list[e][t].content.split(",")[1]||this.list[e][t].content),n=this.groupData[e],a=(n.wechat_img,n.wechat_nick),o=1==this.list[e][t].status,r=this;i.initNew({source:s,isEdit:o,nickName:a,save:function(e,t){return t?_alert("\u64cd\u4f5c\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"):void r.$emit("sendHomeWorkResult",e)}}),this.editKey=e,this.edit$Key=t},editListAudio:function(e,t){this.scoreAudioShow=!0,this.editKey=e,this.edit$Key=t},scoreAudioHide:function(){this.scoreAudioShow=!1,this.audioText=""},delList:function(e,t){var s=this;confirm("\u786e\u8ba4\u5220\u9664\uff1f")&&wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:{wechat_id:s.groupId,message_id:t,status:1},success:function(i){return 1e4!=i.status?alert(i.message):(Vue["delete"](s.list[e],t),void s.list[e].length--)}})},checkListAudio:function(){var e=this;if(""!=e._audioText){var t={wechat_id:e.groupId,message_id:e.edit$Key,status:2,u_wechat_id:e.editKey,text:e._audioText};e.scoreAudioHide(),e.$parent.loading.show=!0,e.$dispatch("getAt",e.groupData[e.editKey].wechat_nick,e.editKey,t.text),e.$parent.sendMsg(),wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:t,success:function(t){return 1e4!=t.status?alert(t.message):(e.list[e.editKey][e.edit$Key].status="1",_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),void(e.$parent.loading.show=!1))}})}},checkList:function(e){var t=this,s={wechat_id:t.groupId,message_id:t.edit$Key,status:2,score:e.score,u_wechat_id:e.u_wechat_id,correct_img:e.correct_img,text:e.text};wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:s,success:function(e){return 1e4!=e.status?alert(e.message):void(t.list[t.editKey][t.edit$Key].status="1")}})},hide:function(){this.isShow=!1,this.list=[],this.groupId="",this.pending=!0,this.editKey="",this.edit$Key="",this.groupheader="",this.groupData={},this.cur$key="",this.scoreShow=!1},getDate:function(){var e=new Date,t=function(e){var t=e+"";return t.length<2?"0"+t:t};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())},getHomeWork:function(){var e=this;wxHeck.getData({url:"/WorkCorrect/ajaxGetChatRoomMessage",data:{wechat_id:e.groupId,start_time:_startTime.value||"",end_time:_endTime.value||""},success:function(t){if(1e4!=t.status)return alert(t.message);var s=function(e){if(e){var t=e.split("$");return t[0]==t[1]}};if(""==t.message||t.message==[]){var i={};i.length=0;for(var n in e.groupData)s(n)||(i[n]={length:0},i.length++);return void(e.list=i)}e.list=function(t){for(var i in t)if(!s(i)){t[i].length=0;for(var n in t[i])"length"!=n&&(t[i][n].showTool=!1,t[i].length++)}for(var i in e.groupData)i in t||s(i)||(t[i]={length:0});return t}(t.message)},complete:function(){e.pending=!1}})},homeWorkTip:function(e){if(wxHeck.isMyFriend(e)){var t="\u5c0f\u670b\u53cb\u6293\u7d27\u65f6\u95f4\u4ea4\u4f5c\u4e1a\u54e6\uff0c\u6bcf\u5929\u7684\u575a\u6301\u90fd\u662f\u5f88\u91cd\u8981\u7684\u5462\uff01";this.$parent.sendMsg(null,!0,e,t),_alert("\u53d1\u9001\u63d0\u9192\u6210\u529f\uff01")}else _confirm("\u548c\u5b66\u5458\u8fd8\u4e0d\u662f\u597d\u53cb\u5173\u7cfb\uff0c\u662f\u5426\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb\uff1f\u5982\u5b66\u5458\u672a\u53ca\u65f6\u901a\u8fc7\u597d\u53cb\u8bf7\u6c42\uff0c\u5efa\u8bae\u7535\u8bdd\u6c9f\u901a~",function(){this.$root.$broadcast("showAddFriend",{wxAcc:e.split("$")[1],type:"1"})}.bind(this))},sendScore:function(e){var t=this;if(""!=t._score||e){var s=this.$parent,i=this.imgSrc,n=t._score,a=t.comText,o=t.editKey;this.hideScore(),wxHeck.getData({beforeSend:function(){s.loading.show=!0},url:"/UploadFile/screenImg",data:{file_base64:i,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(e){if(1e4==e.status){var r={action:"chat",id:localInfo.id,type:"web",to_id:s.wxData.curUserId,to_type:"ios",content:e.message,cnt_type:1};wxHeck.pushMsg({pushId:s.wxData.curUserId,isCC:!0,msg:[i,e.message],time:(new Date).getTime(),cnt_type:9999}),wxHeck.sendMsg(r),t.$dispatch("getAt",t.groupData[t.editKey].wechat_nick,t.editKey),s.sendMsg(),t.checkList({score:n,correct_img:e.message,u_wechat_id:o,text:a}),_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01")}else _alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01")},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")},complete:function(){s.loading.show=!1}})}},hideScore:function(){this.scoreShow=!1,this.imgSrc="",this.score="",this.comText=""}},computed:{_score:function(){return $.trim(this.score)},_audioText:function(){return $.trim(this.audioText)}},events:{sendHomeWorkResult:function(e){this.scoreShow=!0,this.imgSrc=e.img,this.comText=e.text},showHomeWork:function(e){var t=this;t.groupheader=e.localInfo.groupheader,t.groupId=e.groupId,function(e){$.map(e,function(e,s){Vue.set(t.groupData,e.wechat_id,e)})}(e.groupData||[]),t.startTime=t.endTime=t.getDate(),t.isShow=!0,t.$nextTick(function(){$(".home-work-con").wxScroll()}),t.$nextTick(function(){t.getHomeWork()})}}}),C=Vue.extend({template:"#homeWorkOne",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",realgroupId:"",groupId:"",editKey:"",edit$Key:"",groupData:{},scoreShow:!1,score:"",imgSrc:"",scoreAudioShow:!1,audioText:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},cur$key:"",comText:""}},methods:{playVoice:function(e){this.voicePlay.voiceSrc=e,this.$nextTick(function(){voiceMsgPlayer3.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},shList:function(e,t,s){this.list[t][s].showTool=0==e},editList:function(e,t){this.cur$key=t;var s=wxHeck.getImgUrl(this.list[e][t].content.split(",")[1]||this.list[e][t].content),n=this.groupData[e],a=(n.img,n.c_remark||n.nick),o=1==this.list[e][t].status,r=this;i.initNew({source:s,isEdit:o,nickName:a,save:function(e,t){return t?_alert("\u64cd\u4f5c\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"):void r.$emit("sendHomeWorkResult",e)}}),this.editKey=e,this.edit$Key=t},editListAudio:function(e,t){this.scoreAudioShow=!0,this.editKey=e,this.edit$Key=t},scoreAudioHide:function(){this.scoreAudioShow=!1,this.audioText=""},delList:function(e,t){var s=this;confirm("\u786e\u8ba4\u5220\u9664\uff1f")&&wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:{wechat_id:s.realgroupId,message_id:t,status:1},success:function(i){return 1e4!=i.status?alert(i.message):(Vue["delete"](s.list[e],t),void s.list[e].length--)}})},checkListAudio:function(){var e=this;if(""!=e._audioText){var t={wechat_id:e.realgroupId,message_id:e.edit$Key,status:2,u_wechat_id:e.editKey,text:e._audioText};e.scoreAudioHide(),e.$parent.loading.show=!0,e.$parent.wxData.msgList[e.editKey].msgContent=t.text,e.$parent.sendMsg(),wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:t,success:function(t){return 1e4!=t.status?alert(t.message):(e.list[e.editKey][e.edit$Key].status="1",_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),void(e.$parent.loading.show=!1))}})}},checkList:function(e){var t=this,s={wechat_id:t.realgroupId,message_id:t.edit$Key,status:2,score:e.score,u_wechat_id:e.u_wechat_id,correct_img:e.correct_img,text:e.text};wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:s,success:function(e){return 1e4!=e.status?alert(e.message):void(t.list[t.editKey][t.edit$Key].status="1")}})},hide:function(){this.isShow=!1,this.list=[],this.realgroupId="",this.groupId="",this.pending=!0,this.editKey="",this.edit$Key="",this.groupData={},this.cur$key="",this.scoreShow=!1},getDate:function(){var e=new Date,t=function(e){var t=e+"";return t.length<2?"0"+t:t};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())},getHomeWork:function(){var e=this;wxHeck.getData({url:"/WorkCorrect/getStudentJobList",data:{group_id:e.realgroupId,wechat_id:e.groupId,start_time:_startTime.value||"",end_time:_endTime.value||""},success:function(t){if(1e4!=t.status)return alert(t.message);if(""==t.message||t.message==[]){var s={};s.length=0;for(var i in e.groupData)s[i]={length:0},s.length++;return void(e.list=s)}e.list=function(e){for(var t in e){e[t].length=0;for(var s in e[t])"length"!=s&&(e[t][s].showTool=!1,e[t].length++)}return e}(t.message)},complete:function(){e.pending=!1}})},homeWorkTip:function(e){var t=this.groupData[e],s=t.nick+"\u5c0f\u670b\u53cb\u6293\u7d27\u65f6\u95f4\u4ea4\u4f5c\u4e1a\u54e6\uff0c\u6bcf\u5929\u7684\u575a\u6301\u90fd\u662f\u5f88\u91cd\u8981\u7684\u5462\uff01";this.$parent.wxData.msgList[e].msgContent=s,this.$parent.sendMsg(),_alert("\u53d1\u9001\u63d0\u9192\u6210\u529f\uff01")},sendScore:function(e){var t=this;if(""!=t._score||e){var s=this.$parent,i=this.imgSrc,n=t._score,a=t.comText,o=t.editKey;this.hideScore(),wxHeck.getData({beforeSend:function(){s.loading.show=!0},url:"/UploadFile/screenImg",data:{file_base64:i,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(e){if(1e4==e.status){var r={action:"chat",id:localInfo.id,type:"web",to_id:s.wxData.curUserId,to_type:"ios",content:e.message,cnt_type:1};wxHeck.pushMsg({pushId:s.wxData.curUserId,isCC:!0,msg:[i,e.message],time:(new Date).getTime(),cnt_type:9999}),wxHeck.sendMsg(r),t.checkList({score:n,correct_img:e.message,u_wechat_id:o,text:a}),_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01")}else _alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01")},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")},complete:function(){s.loading.show=!1}})}},hideScore:function(){this.scoreShow=!1,this.imgSrc="",this.score="",this.comText=""}},computed:{_score:function(){return $.trim(this.score)},_audioText:function(){return $.trim(this.audioText)}},events:{sendHomeWorkResult:function(e){this.scoreShow=!0,this.imgSrc=e.img,this.comText=e.text},showHomeWorkOne:function(e){var t=this;t.groupId=e.groupId,t.realgroupId=wxHeck.getFullId(e.groupData[e.groupId].showHW)+"@chatroom",function(e){Vue.set(t.groupData,t.groupId,e[t.groupId].userInfo)}(e.groupData||[]),t.startTime=t.endTime=t.getDate(),t.isShow=!0,t.$nextTick(function(){$(".home-work-con").wxScroll(),t.getHomeWork()})}}}),T=Vue.extend({template:"#homeWorkDetail",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",groupId:"",groupData:{},groupheader:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},hwShow:!1,hwSrc:""}},methods:{playVoice:function(e){this.voicePlay.voiceSrc=e,this.$nextTick(function(){voiceMsgPlayer4.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},hide:function(){this.isShow=!1,this.list=[],this.groupId="",this.pending=!0,this.groupheader="",this.hwHideFn(),this.groupData={}},hwHideFn:function(){this.hwShow=!1,this.hwSrc=""},getDate:function(){var e=new Date,t=function(e){var t=e+"";return t.length<2?"0"+t:t};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())},getHomeWork:function(){var e=this;wxHeck.getData({url:"/WorkCorrect/classInfoList",data:{wechat_id:e.groupId,start_time:_startTime_2.value||"",end_time:_endTime_2.value||""},success:function(t){if(1e4!=t.status)return alert(t.message);var s=function(e){if(e){var t=e.split("$");return t[0]==t[1]}};return""==t.message||t.message==[]?void(e.list=[]):void(e.list=function(e){for(var t in e)if(!s(t)){e[t].length=0;for(var i in e[t])"length"!=i&&(e[t][i].showTool=!1,e[t].length++)}return e}(t.message))},complete:function(){e.pending=!1}})},send:function(e){if(wxHeck.isMyFriend(e)){var t=this.getUrl(e),s=location.origin+t._url,i=t._nick+"\u7684\u4f5c\u4e1a\u8bb0\u5f55",n="\u8fd9\u662f"+t._nick+"\u5c0f\u670b\u53cb\u572851Talk\u7684\u4f5c\u4e1a\u8bb0\u5f55\uff0c\u8bf7\u67e5\u6536\uff5e",a=localInfo.img,o=JSON.stringify({title:i,introduction:n,icon:a,link:s,id:999}),r={action:"chat",id:localInfo.id,to_id:e,type:"web",cnt_type:3e3,content:o};wxHeck.pushMsg({pushId:e,isCC:!0,msg:o,cnt_type:3e3,time:(new Date).getTime()}),wxHeck.sendMsg(r),_alert("\u53d1\u9001\u6210\u529f")}else _confirm("\u548c\u5b66\u5458\u8fd8\u4e0d\u662f\u597d\u53cb\u5173\u7cfb\uff0c\u662f\u5426\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb\uff1f\u5982\u5b66\u5458\u672a\u53ca\u65f6\u901a\u8fc7\u597d\u53cb\u8bf7\u6c42\uff0c\u5efa\u8bae\u7535\u8bdd\u6c9f\u901a~",function(){this.$root.$broadcast("showAddFriend",{wxAcc:e.split("$")[1],type:"1"})}.bind(this))},getUrl:function(e){var t=this,s=t.groupData[e],i=localInfo.wechat_id+"$"+localInfo.wechat_id,n=t.groupData[i],a=["startTime="+_startTime_2.value,"endTime="+_endTime_2.value,"u_wechat_id="+e,"wechat_id="+t.groupId,"nickName="+s.wechat_real_nick,"headUrl="+s.wechat_img,"teaName="+n.wechat_nick,"teaHead="+n.wechat_img],o="/Guest/stuInfoList?"+a.join("&");return{_url:o,_nick:s.wechat_real_nick}},preview:function(e){var t=this.getUrl(e)._url;this.hwSrc=t,this.hwShow=!0}},events:{showHomeWorkDetail:function(e){var t=this;t.groupheader=e.localInfo.groupheader,t.groupId=e.groupId,function(e){$.map(e,function(e,s){Vue.set(t.groupData,e.wechat_id,e)})}(e.groupData||[]),t.startTime=t.endTime=t.getDate(),t.isShow=!0,t.$nextTick(function(){$(".home-work-con").wxScroll()}),t.$nextTick(function(){t.getHomeWork()})}}}),U=Vue.extend({template:"#groupAnnounce",data:function(){return{show:!1,annContent:"",groupId:""}},methods:{sendAnnounce:function(){this.show=!1,wxHeck.sendMsg({action:"announcement",id:localInfo.id,u_id:this.groupId,type:"web",content:this.annContent}),this.annContent=""},hide:function(){this.show=!1}},events:{showAnnLayer:function(e){this.show=!0,this.groupId=e}}}),M=Vue.extend({template:"#autoSend",data:function(){return{show:!1,setTime:{walkhalf:{val:0,text:""},walkhour:{val:0,text:""},walkcut:{val:0,text:""}},uid:""}},methods:{confirmBtn:function(){this.show=!1},conselBtn:function(){this.show=!1},setTimeCheck:function(e){switch(e){case"walkhalf":0==this.setTime.walkhalf.val?this.setTime.walkhalf.val=1:this.setTime.walkhalf.val=0;break;case"walkhour":0==this.setTime.walkhour.val?this.setTime.walkhour.val=1:this.setTime.walkhour.val=0;break;case"walkcut":0==this.setTime.walkcut.val?this.setTime.walkcut.val=1:this.setTime.walkcut.val=0}},confirmBtn:function(){var e=this;wxHeck.getData({url:"/UserContact/saveRemindSwitch",data:{uid:e.uid,admin_id:localInfo.admin_id,walkhalf:void 0==e.setTime.walkhalf.val?"":e.setTime.walkhalf.val,walkhour:void 0==e.setTime.walkhour.val?"":e.setTime.walkhour.val,walkcut:void 0==e.setTime.walkcut.val?"":e.setTime.walkcut.val},success:function(t){1e4!=t.status&&_alert(t.message),_alert("\u81ea\u52a8\u53d1\u9001\u8bbe\u7f6e\u6210\u529f\uff01"),e.show=!1}})}},events:{showAutoLayer:function(){this.show=!0},setTimeAjax:function(e,t){this.uid=t,this.setTime.walkhalf.val=void 0==e.walkhalf?"":e.walkhalf,this.setTime.walkhalf.text=void 0==e.text.walkhalf?"":e.text.walkhalf,this.setTime.walkhour.val=void 0==e.walkhour?"":e.walkhour,this.setTime.walkhour.text=void 0==e.text.walkhour?"":e.text.walkhour,this.setTime.walkcut.val=void 0==e.walkcut?"":e.walkcut,this.setTime.walkcut.text=void 0==e.text.walkcut?"":e.text.walkcut}}}),G=Vue.extend({template:"#setHW",data:function(){return{show:!1,showLoading:!1,isGroupOwner:!1,list:[],groupId:"",sending:!1}},computed:{sel_nosure:function(){return 0==this.list.length}},methods:{sendHwMsg:function(){var e=this,t=e.list[0];wxHeck.pushMsg({pushId:e.groupId,isCC:!0,msg:[t,t],time:(new Date).getTime(),cnt_type:9999});var s={action:"chat",id:localInfo.id,type:"web",to_id:e.groupId,to_type:"ios",content:t,cnt_type:1};wxHeck.sendMsg(s)},subHW:function(){var e=this;0!=e.list.length&&wxHeck.getData({beforeSend:function(){e.sending=!0},url:"/WorkCorrect/assignHomework",data:{wechat_id:e.groupId,work_images:e.list.join(",")},success:function(t){return 1e4!=t.status?void alert(t.message):(e.sendHwMsg(),void _alert("\u53d1\u9001\u6210\u529f",e.hide))},error:function(){alert("\u53d1\u9001\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01")},complete:function(){e.sending=!1}})},hide:function(){this.show=!1,this.list=[],this.groupId="",this.isGroupOwner=!1},initUpload:function(){var e=this;wxHeck.uploadFn.init({browse_button:"set-hw-upload-btn",container:"set-hw-upload",filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}]},BeforeUpload:function(t,s,i){e.showLoading=!0},FileUploaded:function(t,s,i){e.list.push(s.fileFullName),e.showLoading=!1},Error:function(t,s){alert(s.message),e.showLoading=!1}})}},events:{showSetHW:function(e){this.isGroupOwner=e.isGroupOwner,this.groupId=e.groupId,this.show=!0,this.$nextTick(this.initUpload)}}}),F=Vue.extend({template:"#changeGroupOwner",data:function(){return{show:!1,showlayer:!1,showOk:!1,sel:"",groupList:[],groupId:"",groupOwnner:"",search:"",nickName:""}},methods:{hideChangeOwner:function(){this.show=!1,this.groupList=[]},selUser:function(e,t){e==this.sel?this.sel="":this.sel=e,this.nickName=t.wechat_nick||t.wechat_real_nick||""},setNewOwner:function(){if(""!=this.sel){var e=this;_confirm("\u786e\u5b9a\u9009\u62e9"+e.nickName+"\u4e3a\u65b0\u7fa4\u4e3b\uff0c\u4f60\u5c06\u81ea\u52a8\u653e\u5f03\u7fa4\u4e3b\u8eab\u4efd\u3002",function(){wxHeck.sendMsg({action:"change_chatroom_owner",id:window.localInfo.id,type:"web",new_owner_id:e.sel.split("$")[1],u_id:e.groupId})})}}},events:{showChangeOwner:function(e){wxHeck.wxInit.$root.$data.contentGroupLayer.show=!1,this.show=!0,this.showlayer=!0,this.groupId=e.groupId,this.groupOwnner=e.groupOwnner,this.groupList=e.groupList,this.$nextTick(function(){$(".group-user-list").wxScroll()})},changeOwnerOk:function(){this.showOk=!0,this.showlayer=!0;var e=this;setTimeout(function(){e.showOk=!1,e.show=!1},600)}},computed:{selLists:function(){var e=this,t=$.trim(e.search);if(""==t||0==e.groupList.length)return e.groupList;var s=[];return $.map(e.groupList,function(i,n){var a=e.groupList[n].wechat_nick,o=a.indexOf(t)>-1;o&&s.push(i)}),s}}}),B=Vue.extend({template:"#cutUserDetail",data:function(){return{show:!1,details:{}}},methods:{hideCutMask:function(){this.show=!1}},events:{showCutUserLayer:function(e){this.show=!0,this.details=e.details}}}),A=Vue.extend({template:"#instead",data:function(){return{show:!1,crm:""}},methods:{hide:function(){this.show=!1},submitCrm:function(){if(this.crm){var e=this;wxHeck.getData({url:"/AdminContact/updateTrust",data:{trust_id:e.crm},success:function(t){return 1e4!=t.status?_alert(t.message):(_alert(t.message),this.crm="",e.show=!1,void(window.location.href="http://www.51talk.com/"))}})}}},events:{crmTrust:function(){this.show=!0,console.log("----")}}}),P=Vue.extend({template:"#sendLink",data:function(){return{show:!1,classLink:"",className:"",id:"",course_id:"",dengdai:!1}},methods:{hide:function(){this.show=!1},sendLink:function(){console.log(this.id),this.show=!1,this.$root.sendMsg(null,!0,this.id,this.classLink)}},events:{sendLinkClassName:function(e){this.className=e.course_name_cn+e.unit_name_cn+e.lession_name_cn},sendLinkLayer:function(e){var t=this;t.id=e.id,t.course_id=e.course_id,wxHeck.getData({url:"/Course/getCourseLinkById",data:{course_id:t.course_id},success:function(e){return 1e4!=e.status?(t.show=!1,_alert(e.message)):(t.show=!0,void(t.classLink=e.message))}})}}}),O=Vue.extend({template:"#recommend",data:function(){return{show:!1,recMoble:"",des:"",user_id:""}},methods:{addRecomd:function(){var e=this;wxHeck.getData({url:"/RecommendUser/addRecomUser",data:{mobile:e.recMoble,remark:e.des,recomm_user_id:e.user_id},success:function(t){return 1e4!=t.status?_alert(t.message):(_alert(t.message),e.show=!1,void(e.recMoble=e.des=e.user_id=""))}})},hide:function(){this.show=!1,this.recMoble=this.des=""}},events:{recommendFn:function(e){this.show=!0,this.user_id=e.user_id}}}),W=Vue.extend({template:"#labelEditor",data:function(){return{show:!1,showvis:!1,labelList:[],labelData:[],sysList:[],labelDataRemark:"",wechatId:"",pos:{top:"1px"},mt:null}},methods:{editLabel:function(e){if(1!=e.status){var t=e.id,s=this.labelData.indexOf(t);s>-1?this.labelData.splice(s,1):this.labelData.push(t)}},sendEdit:function(){this.$dispatch("changeLabel",{labelData:this.labelData,wechatId:this.wechatId})},close:function(){this.show=this.showvis=!1,this.labelData.sort().join(",")!=this.labelDataRemark&&this.sendEdit(),this.labelList=[],this.sysList=[],this.labelData=[],this.labelDataRemark="",this.wechatId=""},blurHide:function(){this.$root.showLabelEditor="",this.$root.showLabelEditorBlur=this.wechatId,this.close(),clearTimeout(this.mt),setTimeout(function(){this.$root.showLabelEditorBlur=""}.bind(this),300)}},events:{openLabelEditor:function(e){this.close(),this.labelList=e.labelList,this.sysList=e.sysList,this.labelData=e.labelData,this.labelDataRemark=e.labelData.sort().join(","),this.wechatId=e.wechatId,this.show=!0,this.$nextTick(function(){var t=$(".label-editor"),s=e.target,i=s.offset().top,n=$(window).height()-i,a=t.outerHeight(),o=0;o=n>a?i:i-a,this.pos.top=o+"px",this.showvis=!0,this.$nextTick(function(){t.wxScroll().focus()})}.bind(this))},closeLabelEditor:function(){this.close()}}}),R=Vue.extend({template:"#helperSel",data:function(){return{show:!1,curUserId:"helper",curUserIdMark:"",list:[],userGroupList:{"default":localInfo.userGroupList,groups:[],details:[],curid:{typeId:"",groupId:"",userList:[],organization_alias:""}},groupsData:{},groupsSel:[]}},methods:{getGroup:function(e){var t=this,s=t.groupsData[e];s?t.groupsSel.indexOf(e)>-1?($.map(t.groupsData[e],function(e,s){t.list.$remove(e)}),t.groupsSel.$remove(e)):(t.list=t.list.concat(s),t.groupsSel.push(e)):wxHeck.getData({url:"/BlackBirdHelper/ajaxUserGroupList",data:{user_group:e},success:function(s){if(1e4!=s.status)return _alert(s.message);var i=$.map(s.message,function(e,t){return e.admin_id});t.groupsData[e]=i,t.list=t.list.concat(i),t.groupsSel.push(e)}})}},events:{helperSelOpen:function(){var e=this.$root;this.curUserIdMark=e.wxData.curUserId,this.$root.changeUser(this.curUserId),e.helperSel.flag=!0,this.show=!0},helperSelClose:function(){var e=this.$root;e.wxData.msgList[this.curUserId].msgContent="",this.$root.helperSel.flag=!1,this.$root.changeUser(this.curUserIdMark),this.curUserIdMark="",this.list=this.userGroupList.groups=this.userGroupList.details=[],this.userGroupList.curid.typeId=this.userGroupList.curid.organization_alias="",this.groupsSel=[],this.show=!1}},watch:{list:function(e){this.$root.helperSel.list=e}}});Vue.config.warnExpressionErrors=!1,wxHeck.wxInit=new Vue({el:"body",data:{helperSel:{flag:!1,list:[]},mesBackShow:!1,userProgress:{progress:0,isFirst:!0},wxData:wxHeck.dataSource,bindCrm:{showBindBtn:!1,showBindCon:!1,showBindInfo:!1,showBindPop:!1,searchKey:"",searchResult:{id:"",nick_name:""}},bindGroupCtl:{showBindGroup:!1,canselBindGroup:!1,showbindLayer:!1,searchKey:"",searchResult:{id:"",name:""},wechatCode:"http://static.51talk.com/static/images/html/www_new/common/guan-wx.png?v=1484273503143",groupDetail:{},groupType:{cst:!1,dls:!1,other:!1},menu:!1,userGroup:localInfo.user_group},historyMsg:{isLoading:!1},userOp:{show:!1},userOpt:{show:!1},voicePlay:{voiceSrc:"",playVoiceSrc:""},contentTip:"",contentType:{types:["0","1","2","9999","42","3000","3100","4000","5000","495","4950","6000","6001","400","10000"]},fileDetailType:"",noReadAll:0,userListType:"",todayFocusUser:[],at_id:[],setGroupChat:{flag:!1,list:[],msg:"",chatType:""},loading:{show:!1},contentGroupLayer:{show:!1,del:!1},newFriCount:0,showOwnnerBtn:!1,shareArticle:{show:!1,title:"",desc:"",icon:"",dig:"",urlStr:"",videoUrl:""},groupUserInfo:{from_id:"",mem_id:"",name:""},addDelFriendInfo:{show:!1,nameTitle:"51Talk\u7684\u8bfe\u7a0b\u987e\u95ee",msg:""},showLength:{userListByType:{startMark:20,start:20,step:10,cH:64,buffer:30}},personalInfo:{personalMask:!1,copyWechatImg:!1,copyImgBtn:!1,id:"",wechat_username:"",img:"",nick:"",qrcode_url:"",show:!1},classGroupInfo:{show:!1,bindBtn:!0,userGroup:localInfo.user_group},blackUseTip:!1,showInfo:{recent:!1,last:!1},cutUserMenuList:!1,labelsWrap:{data:[],show:!1,showvis:!1,pos:{top:0}},showLabelEditor:"",showLabelEditorBlur:""},filters:{_parseInt:function(e){return Math.round(e)},y_m_d:function(e){return e.substring(0,10)},y_m_d_h_m:function(e){return e.substring(0,16)},h_m:function(e){return e.substring(11,16)}},components:{userSel:s,editName:n,quickCon:a,userSearch:o,infoUpdate:d,errorsTip:l,addFriend:h,chatTools:_,sendPaste:w,updateWechat:k,logout:y,userType:c,fnTab:I,crmRemark:v,quickTab:H,myStudy:S,userTypes:u,myFriend:D,homeWork:L,groupAnnounce:U,autoSend:M,homeWorkDetail:T,homeWorkOne:C,setHw:G,changeOwner:F,cutUserDetail:B,instead:A,sendClass:P,recommend:O,labelEditor:W,helperSel:R},computed:{userListByType:function(){var e=this,t=e.userListType,s=[];return""==t?s=e.wxData.userList:$.map(e.wxData.userList,function(i,n){if("todayFocus"==t){if(e.todayFocusUser.indexOf(i)>-1&&(s.push(i),s.length==e.todayFocusUser.length))return!1}else{var a=e.wxData.msgList[i].userInfo,o=a.label.indexOf(t)>-1;o&&s.push(i)}}),this.$nextTick(function(){wxHeck.userBoxTop()}),this.showLength.userListByType.start=this.showLength.userListByType.startMark,s},bindCrmSearchResult:function(){var e=this.bindCrm.searchResult,t=[];return""!=e.id&&t.push("id:"+e.id),""!=e.nick_name&&t.push("\u6635\u79f0:"+e.nick_name),t.join(" ")},bindGroupSearchResult:function(){var e=this.bindGroupCtl.searchResult,t=[];return""!=e.name&&t.push(e.name),t.join(" ")}},methods:{closeHelperSel:function(){this.$broadcast("helperSelClose")},isHelper:function(){return wxHeck.isHelper()},openHelperSel:function(){this.$broadcast("helperSelOpen"),this.userOpHide()},smallHelper:function(){this.$broadcast("birdHelper"),this.userOpHide()},groupBindMenu:function(){this.bindGroupCtl.menu=!this.bindGroupCtl.menu},showBindMenuList:function(){this.cutUserMenuList=!this.cutUserMenuList},hideBindMenuList:function(){this.cutUserMenuList=!1},recommendUser:function(){this.$broadcast("recommendFn",{user_id:this.wxData.msgList[this.wxData.curUserId].crmInfo.user_id})},mesBack:function(){var e={action:"revoke_last_msg",id:localInfo.id,type:"web",u_id:this.wxData.curUserId.split("$")[1]};wxHeck.sendMsg(e)},mesBackShowFn:function(e,t){e&&(this.mesBackShow=1==t)},getLabel:function(e,t){var s=this.wxData.msgList[e].userInfo.label.split(","),i=wxHeck.labelFn.nameMap,n=wxHeck.labelFn.idMap;return $.map(s,function(e,s){if(e in i){var a=i[e].id,o=t?a:n[a];return o}})},setHWShow:function(e){this.$broadcast("showSetHW",{groupId:e,isGroupOwner:this.wxData.msgList[e].isGroupOwner})},scrollShow:function(e,t){if(0!=t){var s=e.target,i=this.showLength.userListByType,n=s.clientHeight,a=s.scrollTop,o=s.scrollHeight;if(n+a>=o-i.buffer){var r=i.start+i.step;r=r>=t?t:r,i.start=r}if(o-(n+a)>i.step*i.cH+i.buffer){var r=i.start-i.step;r=r<=i.startMark?i.startMark:r,i.start=r}}},getFileClass:function(e){var t=e.split(".").slice(-1)[0];return"doc"==t||"docx"==t?"fileWord":"xls"==t||"xlsx"==t?"fileExcel":"ppt"==t||"pptx"==t?"filePpt":"pdf"==t?"filePdf":void 0},gotoBottom:function(){var e=this;window.setTimeout(function(){wxHeck.scrollToBottom(),wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:e.wxData.curUserId})},0)},scrollFn:function(e){var t=e.target;t.scrollTop+t.clientHeight+5>=t.scrollHeight&&(this.wxData.msgList[this.wxData.curUserId].noRead=0,this.noReadAll=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:this.wxData.curUserId}))},homeWorkShow:function(e){this.$broadcast("showHomeWork",{localInfo:this.wxData.localInfo,groupId:e,groupData:this.wxData.groupUserLists[e]})},homeWorkOneShow:function(e){this.$broadcast("showHomeWorkOne",{localInfo:this.wxData.localInfo,groupId:e,groupData:this.wxData.msgList})},homeWorkShowDetail:function(e){this.$broadcast("showHomeWorkDetail",{localInfo:this.wxData.localInfo,groupId:e,groupData:this.wxData.groupUserLists[e]})},getMyFriend:function(){this.userOpHide(),this.$broadcast("myFriendShow"),wxHeck.sendMsg({
action:"hello_list",id:localInfo.id,type:"web"}),this.newFriCount=0},closeGroupChat:function(){this.$broadcast("userSelClose"),this.setGroupChat.flag=!1,this.wxData.msgList[this.wxData.curUserId].msgContent=this.setGroupChat.msg},isMyFriend:function(e){var t=e.wxid;1==e.result?(wxHeck.toTop(t),this.changeUser(t),wxHeck.userBoxTop()):wxHeck.wxInit.$broadcast("addFriendGoNext",e)},quickTab:function(e,t,s){console.log(t),t.isCC||s&&(this.groupUserInfo.from_id=t.from_id,this.groupUserInfo.mem_id=t.mem_id,this.groupUserInfo.name=t.name,this.$broadcast("openQuickTab",{from_id:t.from_id||t.curtId,name:t.name||t.wechat_nick,event:e,mem_id:t.mem_id||t.wechat_id,wechat_id:t.wechat_id||t.mem_id,wechat_nick:t.wechat_nick||t.name,curtId:this.wxData.curUserId}))},crmRemarkOpen:function(e){this.$broadcast("crmRemarkOpen",{user_id:e})},getSelCon:function(e){var t="";t=document.selection?document.selection.createRange().text:document.getSelection(),t=t.toString(),t&&this.$broadcast("openFnTab",{pos:{left:e.x,top:e.y},sendSelData:t})},showLabelTab:function(e,t){0!=t.length&&(this.labelsWrap.data=t,this.labelsWrap.show=!0,this.$nextTick(function(){var t=$(".labels_wrap").outerHeight(),s=$(e.target).offset().top;this.labelsWrap.pos.top=s-t-5+"px",this.labelsWrap.showvis=!0}.bind(this)))},getSys:function(e){var t=this.wxData.localInfo.labelList,s=this.wxData.curUserId;if(e.labelData||s){var i=e.labelData||this.getLabel(this.wxData.curUserId,!0),n=t[1];return n?$.map(n,function(t,s){return i.indexOf(t.id)>-1?e.getId?t.id:t:void 0}):[]}},showLabelEdit:function(e,t){if(t==this.showLabelEditorBlur)return void(this.showLabelEditorBlur="");if(this.showLabelEditorBlur="",t==this.showLabelEditor)this.showLabelEditor="",this.$broadcast("closeLabelEditor");else{var s=this.wxData.localInfo.labelList,i=this.getLabel(t,!0),n=this.getSys({labelData:i});this.showLabelEditor=t,this.$broadcast("openLabelEditor",{labelList:s,labelData:i,sysList:n,wechatId:t,target:$(e.target)})}},hideLabelTab:function(){this.labelsWrap.showvis=!1,this.labelsWrap.show=!1},sendCircleFriend:function(){wxHeck.sendMsg({action:"receive_wcmsg",id:localInfo.id,type:"web",action_type:1})},enNameEdit:function(e,t){var s=$.trim(e.target.innerText);if(s!=t.nick_name)return""==s?(alert("\u4fee\u6539\u82f1\u6587\u540d\u4e0d\u80fd\u4e3a\u7a7a"),void(e.target.innerText=t.nick_name)):void wxHeck.getData({url:"/UserContact/ajaxUpdateUserNickName",data:{user_id:t.user_id,nick_name:s},success:function(i){1e4!=i.status?(_alert(i.message),e.target.innerText=t.nick_name):t.nick_name=s},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),e.target.innerText=t.nick_name}})},contentTipShow:function(){clearTimeout(wxHeck.contentTipMT)},contentTipHide:function(){var e=this;wxHeck.contentTipMT=setTimeout(function(){e.contentTip=""},3e3)},sendMsgForce:function(){this.sendMsg(event,!0),this.contentTip=""},updateSelectMember:function(e,t){wxHeck.getData({url:"/UserContact/ajaxUpdateUserWechat",data:{member:t.selectMember,wechat_id:e},success:function(e){return 1e4!=e.status?(t.selectMember=t.selectMemberMark,_alert(e.message)):void(t.selectMemberMark=t.selectMember)},error:function(){t.selectMember=t.selectMemberMark,alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}})},updateInfo:function(){this.userOpHide(),this.$broadcast("showUpdate")},blackUseTips:function(e){"show"==e?(this.blackUseTip=!0,this.userOp.show=!1):this.blackUseTip=!1},addFriend:function(e){0==e.type&&this.userOpHide(),this.$broadcast("showAddFriend",e)},myStudy:function(){var e=wxHeck.Util.setDate(0);wxHeck.isCC()&&(e=wxHeck.Util.setDate(2));var t="",s=this,i={start_time:wxHeck.Util.setDate(-90),end_time:e,page_num:1,page_size:10,appoint_status:1};wxHeck.isSS()&&(t="/UserContact/getCrmUser",s.$broadcast("setStudyTypeBoolean",{cc:!1,ss:!0})),wxHeck.isCC()&&(t="/UserContact/getCrmUserByCc",s.$broadcast("setStudyTypeBoolean",{ss:!1,cc:!0})),wxHeck.getData({url:t,data:i,success:function(e){var t=e.message;return 1e4!=e.status?_alert(t):void s.$broadcast("showMyStudyLayer",{user_info:s.wxData.userList[0].split("$")[0],myStudyData:t})}}),s.userOpHide()},playVoice:function(e){this.voicePlay.voiceSrc=e,this.$nextTick(function(){voiceMsgPlayer.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},editNameShow:function(e,t){this.$broadcast("editNameOpen",{isGroup:e,reMark:t}),this.contentGroupLayer.del=!1,this.contentGroupLayer.show=!1},showUserDetail:function(e){e&&wxHeck.sendMsg({action:"get_contact_details",u_id:e.split("$")[1],type:"web",id:localInfo.id})},showAnnounceLayer:function(){this.$broadcast("showAnnLayer",this.wxData.curUserId.split("$")[1]),this.contentGroupLayer.show=!1},groupPowerChange:function(){this.$broadcast("showChangeOwner",{groupOwnner:this.wxData.groupOwnner,groupList:this.wxData.groupUserLists[this.wxData.curUserId],groupId:this.wxData.curUserId.split("$")[1]})},userOpShow:function(){this.userOp.show=!this.userOp.show},userOpHide:function(){this.userOp.show=!1},userOptShow:function(){this.userOpt.show=!this.userOpt.show},userOptHide:function(){this.userOpt.show=!1},delFriend:function(e,t){_confirm("\u5c06\u8054\u7cfb\u4eba\u3010"+t+"\u3011\u5220\u9664\uff0c\u5c06\u540c\u65f6\u5220\u9664\u4e0e\u8be5\u8054\u7cfb\u4eba\u7684\u804a\u5929\u8bb0\u5f55",function(){wxHeck.sendMsg({action:"remove_users",wxid:e,type:"web",id:localInfo.id})})},showGroupLayer:function(){this.contentGroupLayer.show=!this.contentGroupLayer.show,this.contentGroupLayer.del=!1,this.$nextTick(function(){$(".content-group-list").wxScroll()}),this.$broadcast("showDelBtn",this.contentGroupLayer.show),$(".content-group-show-layer").focus()},showGroupDelIcon:function(){this.contentGroupLayer.del=!0},delGroupDetailUser:function(e){console.log(e.wechat_id,e.wechat_nick);var t=e.wechat_id.split("$");if(t[0]==t[1])return void _alert("\u4e0d\u80fd\u8e22\u51fa\u81ea\u5df1");var s=this.wxData.curUserId.split("$")[1];_confirm("\u5c06\u7fa4\u6210\u5458\u3010"+e.wechat_nick+"\u3011\u5220\u9664\uff1f",function(){wxHeck.sendMsg({action:"del_group_mem",u_id:s,type:"web",wxids:e.wechat_id,id:localInfo.id})}),this.contentGroupLayer.show=!this.contentGroupLayer.show},getChat:function(e,t){this.setGroupChat.chatType=t||"",this.userOpHide(),this.$broadcast("userSelOpen",{type:e,listPerson:this.wxData.userListPerson,listGroup:this.wxData.userListGroup,chatType:t}),"getGroupChat"==e&&(""==this.wxData.curUserId&&this.changeUser(this.userListByType[0]),this.setGroupChat.msg=this.wxData.msgList[this.wxData.curUserId].msgContent,this.wxData.msgList[this.wxData.curUserId].msgContent="",this.setGroupChat.flag=!0),"add_group_mem"==e&&(this.contentGroupLayer.show=!1,this.contentGroupLayer.del=!1)},userLogout:function(){this.userOpHide(),window.confirm("\u786e\u8ba4\u9000\u51fa\uff1f")&&wxHeck.Util.closeTab()},logoutTrust:function(){this.$broadcast("crmTrust"),this.userOpHide()},userLogoutTrustByWX:function(){this.userOpHide();var e=this;wxHeck.getData({url:"/AdminContact/getSelfWechat",data:{admin_id:localInfo.id},success:function(t){return 1e4!=t.status?alert(t.message):(void 0==t.message&&(t.message=""),void e.$broadcast("logoutShowFn",t.message))}})},getLabels:function(e){},getCrmInfo:function(e,t){var s=this,i=t||s.wxData.curUserId,n=s.wxData.msgList[i].userInfo.c_remark;if(s.wxData.msgList[i].crmInfo.isGet&&s.getLabels(i),!s.wxData.msgList[i].crmInfo.isGet||e,0)s.bindCrm.showBindCon=!1,s.bindCrm.showBindBtn=!1,s.bindCrm.showBindInfo=!0;else{var s=this;wxHeck.getData({url:"/UserContact/showUserInfo",data:{wechat_id:i,wid_remark_name:n,label_list:s.getSys({getId:!0})},success:function(e){if(1e4==e.status){null==e.message.selectMember&&(e.message.selectMember="0"),e.message.selectMemberMark=e.message.selectMember,s.wxData.msgList[i].crmInfo=$.extend({},s.wxData.msgList[i].crmInfo,e.message),s.$broadcast("setTagList",{labelList:s.wxData.msgList[i].crmInfo.tag_list||""});var t=e.message.user_id;wxHeck.getData({url:"/Course/getRecentlyLast",data:{user_id:t},success:function(e){e.message.combo&&e.message.combo.length>0&&(e.message.comboSel="0"),s.wxData.msgList[i].crmInfo=$.extend({},s.wxData.msgList[i].crmInfo,e.message,{isGet:!0}),s.bindCrm.showBindCon=!1,s.bindCrm.showBindBtn=!1,s.bindCrm.showBindInfo=!0,s.getLabels(i),s.$broadcast("sendLinkClassName",e.message.recent)}}),function(){if(999==s.wxData.msgList[i].showHW){var t=e.message.group_list;if(0!=t.length){console.log("get show homework");var n={id:i.split("$")[1],grouparray:t},a={id:localInfo.id,action:"is_contact_in_grouparray",type:"web",to_type:"ios",groupdata:n};wxHeck.sendMsg(a)}}}()}else s.bindCrm.showBindCon=!0,s.bindCrm.showBindBtn=!0,s.bindCrm.showBindInfo=!1,s.wxData.msgList[i].crmInfo={isGet:!1}}})}},getGroupInfo:function(){var e="";"6"==localInfo.user_group?e="/UserWorkGroup/showBoundClass":(this.bindGroupCtl.groupType.dls=!0,e="/BoundCommodity/showBoundCommodity");var t=this;wxHeck.getData({url:e,data:{group_id:t.wxData.curUserId.split("$")[1].split("@")[0]},success:function(e){var s=e.message;""!=s.code&&(t.bindGroupCtl.wechatCode=s.code),("7"==localInfo.user_group||"9"==localInfo.user_group)&&(s.isBound?(t.bindGroupCtl.canselBindGroup=!0,t.bindGroupCtl.showBindGroup=!1,t.bindGroupCtl.groupDetail=s):(t.bindGroupCtl.showBindGroup=!0,t.bindGroupCtl.canselBindGroup=!1)),"6"==localInfo.user_group&&(10001==e.status?t.classGroupInfo.bindBtn=!0:t.classGroupInfo.bindBtn=!1,t.bindGroupCtl.groupType.cst=!0)}})},changeUser:function(e){if(!e)return this.wxData.curUserId="";if(this.contentGroupLayer.show=!1,this.contentGroupLayer.del=!1,this.wxData.curUserId!=e){var t=this;this.wxData.curUserId=e,this.bindCrm.showBindCon=!0,this.bindCrm.showBindBtn=!1,this.bindCrm.showBindInfo=!1,t.bindCrm.isRebind=!1,this.$nextTick(function(){wxHeck.msgBox||(wxHeck.msgBox=$(".content_message"),wxHeck.msgBox.wxScroll(),$(".user_mes_con>dd").wxScroll(),wxHeck.upLoadImgInit(t),wxHeck.upLoadFileInit(t),$(".send_text").on("paste",function(e){wxHeck.Util.pasteFn(e.originalEvent,function(e){t.$broadcast("openSendPaste",{imgSrc:e})})})),wxHeck.scrollToBottom(),function(){if(!(t.wxData.msgList[e].noRead<=0)){var s=t.wxData.msgList[e].time;s&&s>0?t.getHistoryFn({url:"/BlackBirdHelper/ajaxUnreadHelperMessage",data:{score:s},cb:function(){t.noReadAll-=t.wxData.msgList[e].noRead,t.wxData.msgList[e].noRead=0,t.wxData.msgList[e].time=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:e})},isGetNoRead:!0}):(t.noReadAll-=t.wxData.msgList[e].noRead,t.wxData.msgList[e].noRead=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:e}))}}()}),this.clearAtUs(),wxHeck.wxInit.$refs.quickcon.tagSel.selName=""}},sendMsg:function(e,t,s,i){var n=this,a=s||this.wxData.curUserId;if(a&&(!this.helperSel.flag||0!=this.helperSel.list.length)){var o=i||$.trim(n.wxData.msgList[a].msgContent);if(""!=o&&!(this.setGroupChat.flag&&0==this.setGroupChat.list.length||e&&13==e.which&&e.shiftKey)){e&&13==e.which&&e.preventDefault();var r=function(e,s){if(t)return!0;var i=e.match(s);return i?(n.contentTip="\u8bf7\u6839\u636e\u5b66\u5458\u60c5\u51b5\u66f4\u6539"+i.join("\uff0c")+"\u7684\u5185\u5bb9\u540e\u518d\u53d1\u9001",n.contentTipShow(),void n.contentTipHide()):!0}(o,wxHeck.Util.conReg);if(r){var c={action:"chat",id:localInfo.id,type:"web",to_id:a,to_type:"ios"};if(0!=this.at_id.length?(c.content=JSON.stringify({atwxid:this.at_id.join(","),content:o}),c.cnt_type=3100,this.at_id=[]):c.content=o,this.setGroupChat.flag)return void this.sendGroupChat(c);if(this.helperSel.flag)return void this.sendHelperChat(c);wxHeck.sendMsg(c),wxHeck.pushMsg({pushId:a,isCC:!0,msg:o,time:(new Date).getTime()}),wxHeck.toTop(a),n.wxData.msgList[a].msgContent=""}}}},clearAtUs:function(){this.wxData.msgList[this.wxData.curUserId].at_fg=0,this.wxData.msgList[this.wxData.curUserId].atshow=!1},sendHelperChat:function(e){var t=this;wxHeck.sendMsg($.extend(e,{to_id:t.helperSel.list.join(",")})),_alert("\u53d1\u9001\u6210\u529f",function(){t.closeHelperSel()})},sendGroupChat:function(e,t){var s=this,i=s.setGroupChat.list,n=i.length;if(0==i.length)return _alert("\u8bf7\u9009\u62e9\u8054\u7cfb\u4eba\uff01");var a=s.setGroupChat.chatType,o="0"==a&&!t,r="";r=o?"\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u800c\u4e14\u5b66\u5458\u4e5f\u4e0d\u559c\u6b22\u7ecf\u5e38\u6536\u5230\u548c\u8425\u9500\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u662f\u5426\u7fa4\u53d1\uff1f":"\u9009\u62e9"+n+"\u4eba\u7fa4\u53d1\u6d88\u606f\u9700\u7b49\u5f85"+Math.ceil(5*n/60)+"\u5206\u949f\uff0c\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u662f\u5426\u7fa4\u53d1\uff1f",_confirm(r,function(){s.loading.show=!0,e.to_id=i.join(","),o?wxHeck.getData({url:"/WechatMessage/ajaxMassMessage",data:{id:localInfo.id,wechat_id:localInfo.wechat_id,action:"group_chat",type:"web",to_type:"ios",u_ids:e.to_id,content:e.content,cnt_type:e.cnt_type},success:function(e){return 1e4!=e.status?_alert(e.message):(_alert("\u8f6c\u53d1\u6210\u529f"),void s.closeGroupChat())},complete:function(){s.loading.show=!1}}):wxHeck.getData({url:"/WechatMessage/ajaxChangeMessage",data:e,success:function(e){return 1e4!=e.status?_alert(e.message):(_alert("\u8f6c\u53d1\u6210\u529f"),void s.closeGroupChat())},complete:function(){s.loading.show=!1}})})},bindUser:function(){this.bindCrm.showBindPop=!0},unbindUser:function(){var e=this;wechat_id=e.wxData.curUserId,user_id=e.wxData.msgList[wechat_id].crmInfo.user_id,wid_remark_name=e.wxData.msgList[wechat_id].userInfo.c_remark,_confirm("\u786e\u8ba4\u89e3\u9664\u7ed1\u5b9a\uff1f",function(){wxHeck.getData({url:"/UserContact/deleteUserInfo",data:{user_id:user_id,wechat_id:wechat_id,wid_remark_name:wid_remark_name},success:function(t){return 1e4!=t.status?_alert(t.message):(_alert("\u89e3\u7ed1\u6210\u529f"),void e.getCrmInfo(!0))}})})},hideBindPop:function(){this.bindCrm.showBindPop=!1,this.bindCrm.searchKey="",this.bindCrm.searchResult.id="",this.bindCrm.searchResult.nick_name=""},bindSearch:function(){var e=$.trim(this.bindCrm.searchKey),t=this;return""==e?alert("\u8bf7\u8f93\u5165\u641c\u7d22\u7535\u8bdd\u53f7\u7801\u6216ID\u53f7"):void wxHeck.getData({url:"/UserContact/searchUserInfo",data:{user_num:e,admin_id:localInfo.admin_id},success:function(e){return e?1e4!=e.status?alert(e.message):(t.bindCrm.searchResult.id=e.message.id,void(t.bindCrm.searchResult.nick_name=e.message.nick_name)):alert("\u8fd4\u56de\u6570\u636e\u4e3a\u7a7a\uff0c\u8bf7\u4fdd\u7559\u73b0\u573a\uff0c\u8054\u7cfb\u9ed1\u9e1f\u6280\u672f\uff01")}})},bindCrmFn:function(){var e=this,t=e.bindCrm.searchResult.id,s=e.wxData.curUserId;return t?void wxHeck.getData({url:"/UserContact/addUserWechatContact",data:{wechat_id:s,user_id:t},success:function(t){return 1e4!=t.status?alert(t.message):(alert("\u7ed1\u5b9a\u6210\u529f"),e.hideBindPop(),void e.getCrmInfo(!0))}}):alert("\u8bf7\u63d0\u4f9b\u7ed1\u5b9a\u4fe1\u606f\uff01")},bindGroupBtn:function(){this.bindGroupCtl.showbindLayer=!0},hideBindGroupLayer:function(){this.bindGroupCtl.showbindLayer=!1,this.bindGroupCtl.searchKey="",this.bindGroupCtl.searchResult.id="",this.bindGroupCtl.searchResult.name=""},bindGroupSearch:function(){var e=$.trim(this.bindGroupCtl.searchKey),t=this;return""==e?alert("\u8bf7\u8f93\u5165\u5546\u54c1ID"):/^[0-9]*$/.test(e)?void wxHeck.getData({url:"/BoundCommodity/getCommodityById",data:{id:e,group_id:t.wxData.curUserId.split("$")[1].split("@")[0]},success:function(s){return 1e4!=s.status?alert(s.message):(t.bindGroupCtl.searchResult.id=e,t.bindGroupCtl.searchResult.name=s.message.name,void(""==s.message.name&&alert("\u6682\u65e0\u8be5ID\u5546\u54c1\uff01")))}}):alert("\u5546\u54c1ID\u53ea\u80fd\u662f\u6570\u5b57\uff01")},bindGroupFn:function(){var e=this,t=e.bindGroupCtl.searchResult.id,s=e.wxData.curUserId.split("$")[1].split("@")[0],i=e.bindGroupCtl.searchResult.name;return console.log("\u63d0\u4ea4\u7fa4\u7ed1\u5b9a\u53c2\u6570\uff1a"+t,s,i,localInfo.admin_id),t?void wxHeck.getData({url:"/BoundCommodity/boundCommodity",data:{commodity_id:t,commodity_name:i,wechat_id:localInfo.wechat_id,group_id:s},success:function(t){return 1e4!=t.status?alert(t.message):(alert("\u7ed1\u5b9a\u6210\u529f"),e.hideBindGroupLayer(),void e.getGroupInfo())}}):alert("\u8bf7\u63d0\u4f9b\u7ed1\u5b9a\u5546\u54c1ID\uff01")},unbindGroup:function(){var e=this;group_id=e.wxData.curUserId.split("$")[1].split("@")[0],window.confirm("\u786e\u8ba4\u89e3\u9664\u7fa4\u7ed1\u5b9a\uff1f")&&wxHeck.getData({url:"/BoundCommodity/canserBound",data:{group_id:group_id},success:function(t){return 1e4!=t.status?alert(t.message):(alert("\u7fa4\u89e3\u7ed1\u6210\u529f"),void e.getGroupInfo())}})},getHistoryFn:function(e){var t=this;curUserId=t.wxData.curUserId,score=t.wxData.msgList[curUserId].historyMsg.score,t.historyMsg.isLoading=!0;var s={url:"/BlackBirdHelper/ajaxHelperMessage",data:{helper_id:localInfo.id,score:score,cc_id:curUserId}},i=$.extend(!0,{},s,e);wxHeck.getData({url:i.url,data:i.data,success:function(e){return 1e4!=e.status?alert(e.message):(0==e.message.length?t.wxData.msgList[curUserId].historyMsg.isGetAll=!0:$.map(e.message,function(s,i){!function(){i==e.message.length-1&&(t.wxData.msgList[curUserId].historyMsg.score=s.time)}(),function(e){var t=e.from_id==localInfo.id,s=t?e.to_id:e.from_id;if(wxHeck.wxInit.wxData.msgList[s]){var i="object"==typeof e.content?JSON.stringify(e.content):e.content;wxHeck.pushMsg({pushId:s,isCC:t,msg:i,pushType:"unshift",isGetHistory:!0,time:e.time,name:e.name,c_remark:e.c_remark,cnt_type:e.cnt_type,source:e})}}(s)}),void("function"==typeof i.cb&&i.cb()))},complete:function(){t.historyMsg.isLoading=!1}})},getChatPar:function(e){var t=this,s=e.selectList;if(1==s.length){var i=s[0];wxHeck.toTop(i),t.changeUser(i),wxHeck.userBoxTop()}else wxHeck.sendMsg({id:localInfo.id,action:"create_group",type:"web",wxids:s.join(",")});this.$broadcast("userSelClose")},add_group_memPar:function(e){var t=this,s=e.selectList;wxHeck.sendMsg({id:localInfo.id,action:"add_group_mem",type:"web",to_id:t.wxData.curUserId,to_type:"ios",wxids:s.join(",")}),this.$broadcast("userSelClose")},addUsersPar:function(e){var t=this,s=e.selectList;wxHeck.sendMsg({id:localInfo.id,action:"add_group_mem",type:"web",to_id:t.wxData.curUserId,to_type:"ios",wxids:s.join(",")}),this.$broadcast("userSelClose")},getGroupPar:function(e){var t=this,s=e.selectList,i=e.inputMsg;this.$broadcast("userSelPending","\u6b63\u5728\u7fa4\u53d1\u4e2d..."),wxHeck.getData({url:"/WechatMessage/ajaxMassMessage",data:{id:localInfo.id,wechat_id:localInfo.wechat_id,action:"group_chat",type:"web",to_type:"ios",u_ids:s.join(","),content:i},success:function(e){1e4!=e.status?alert(e.message):(alert("\u7fa4\u53d1\u6210\u529f"),t.$broadcast("userSelClose")),t.$broadcast("userSelPendingDefault")}})},hideContentTip:function(){this.contentTips.show=!1},handCall:function(){wxHeck.getData({url:"/Call/handCall",data:{user_id:this.wxData.msgList[this.wxData.curUserId].crmInfo.user_id,wechat_id:localInfo.wechat_id},success:function(e){1e4!=e.status?alert(e.message):_alert("\u62e8\u6253\u6210\u529f\uff01")}})},sendClassLink:function(){var e="";wxHeck.wxInit.wxData.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo.recent.course_id&&(e=wxHeck.wxInit.wxData.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo.recent.course_id),this.$broadcast("sendLinkLayer",{id:wxHeck.wxInit.wxData.curUserId,course_id:e})},setAutoSend:function(){var e=this;wxHeck.getData({url:"/UserContact/getRemindSwitch",data:{uid:e.wxData.msgList[e.wxData.curUserId].crmInfo.user_id,admin_id:localInfo.admin_id},success:function(t){1e4!=t.status&&_alert(t.message),e.$broadcast("setTimeAjax",t.message,e.wxData.msgList[e.wxData.curUserId].crmInfo.user_id)}}),this.$broadcast("showAutoLayer")},shareArticleData:function(e,t){"article"==t&&(this.shareArticle.dig=this.shareArticle.videoUrl="",this.shareArticle.show=!0,this.shareArticle.title=e.title,this.shareArticle.desc=e.desc,this.shareArticle.icon=e.thumbUrl,this.shareArticle.urlStr=e.urlStr),"video"==t&&(this.shareArticle.dig=this.shareArticle.title=this.shareArticle.desc=this.shareArticle.icon=this.shareArticle.urlStr="",this.shareArticle.show=!0,this.shareArticle.videoUrl=e.url)},shareArticleBtn:function(){var e=this;wxHeck.getData({url:"/CircleFriend/publishShareArticle",data:{title:e.shareArticle.title,introduction:e.shareArticle.desc,icon:e.shareArticle.icon,link:e.shareArticle.urlStr||e.shareArticle.videoUrl,shareword:e.shareArticle.dig},success:function(t){1e4!=t.status&&_alert(t.message),_alert(t.message),e.shareArticle.show=!1}})},hideShareBtn:function(){this.shareArticle.show=!1},inviteGroupMem:function(e){var t=this;_confirm("\u786e\u5b9a\u63a5\u53d7\u9080\u8bf7\u8fdb\u7fa4\u5417\uff1f",function(){console.log(e,t.wxData.curUserId),msgObj={id:localInfo.id,action:"invite_group_mem",type:"web",to_type:"ios",u_id:t.wxData.curUserId.split("$")[1],localMsgId:e},wxHeck.sendMsg(msgObj)})},addDelFriend:function(){this.addDelFriendInfo.nameTitle=wxHeck.checkUserType(),this.addDelFriendInfo.show=!0},sendAddFriendBtn:function(){msgObj={id:localInfo.id,action:"add_friend",type:"web",to_id:this.wxData.curUserId,to_type:"ios",wxid:this.wxData.curUserId.split("$")[1],verify_msg:this.addDelFriendInfo.msg,user_id:"",mobile:"",remark:"",cnt_type:400},wxHeck.sendMsg(msgObj)},hideSendfriendBtn:function(){this.addDelFriendInfo.show=!1},showPersonalMask:function(){wxHeck.sendMsg({action:"user_info",type:"web",id:localInfo.id,to_type:"ios"}),this.personalInfo.personalMask=!0},hidePersonalMask:function(){this.personalInfo.personalMask=!1,this.personalInfo.id=this.personalInfo.qrcode_url=this.personalInfo.nick=""},copyImgOk:function(){this.personalInfo.copyWechatImg=!1},showCopyBtn:function(){this.personalInfo.copyImgBtn=!0},hideCopyBtn:function(){this.personalInfo.copyImgBtn=!1},copyImgBtn:function(){},copyWechatText:function(){},setGroupToClass:function(e){if("bind"==e)this.classGroupInfo.show=!0;else{var t=this;wxHeck.getData({url:"/UserWorkGroup/cancelBound",data:{group_id:t.wxData.curUserId.split("$")[1].split("@")[0]},success:function(e){return 1e4!=e.status?_alert(e.message):(_alert(e.message),void(t.classGroupInfo.bindBtn=!0))}})}},confirmClassGroup:function(e){if("yes"==e){var t=this;wxHeck.getData({url:"/UserWorkGroup/boundWorkClass",data:{wechat_id:localInfo.wechat_id,group_id:t.wxData.curUserId.split("$")[1].split("@")[0]},success:function(e){return 1e4!=e.status?_alert(e.message):void _alert(e.message)}}),this.classGroupInfo.show=!1,this.classGroupInfo.bindBtn=!1}else this.classGroupInfo.show=!1},showInfoFn:function(e){switch(e){case"recent":this.showInfo.recent=!this.showInfo.recent;break;case"last":this.showInfo.last=!this.showInfo.last}}},events:{changeLabel:function(e){var t=wxHeck.labelFn,s=this.wxData.msgList[e.wechatId].userInfo.label,i=$.map(e.labelData,function(e,s){return t.idMap[e].tag_name});""==s?s=i:(s=s.split(","),s=$.map(s,function(e,s){return e in t.nameMap?void 0:e}),s=s.concat(i)),wxHeck.sendMsg({action:"modify_label",u_id:e.wechatId,id:localInfo.id,type:"web",labels:s.join(",")})},reGetMyStudy:function(){this.myStudy()},getSelList:function(e){this.setGroupChat.list=e},getAt:function(e,t,s){-1==$.inArray(t,this.at_id)&&this.at_id.push(t),this.wxData.msgList[this.wxData.curUserId].msgContent+=" @"+e+" ",s&&(this.wxData.msgList[this.wxData.curUserId].msgContent+=s)},oneChat:function(e){var t={id:localInfo.id,action:"is_myfriend",type:"web",to_type:"ios",wxid:e};wxHeck.sendMsg(t)},groupListUserDelete:function(e){var t=e.groupUserWechat_id.split("$");if(console.log(t),t[0]==t[1])return void _alert("\u4e0d\u80fd\u8e22\u51fa\u81ea\u5df1");var s=this.wxData.curUserId.split("$")[1];_confirm("\u5c06\u7fa4\u6210\u5458\u3010"+e.groupUserWechat_nick+"\u3011\u5220\u9664\uff1f",function(){wxHeck.sendMsg({action:"del_group_mem",u_id:s,type:"web",wxids:e.groupUserWechat_id,id:localInfo.id})})},getSelData:function(e){this.$broadcast("setSelData",e)},setListType:function(e){this.userListType=e},userLogoutTrust:function(e){wxHeck.getData({url:"/AdminContact/saveSelfWechat",data:{wechat_id:e,admin_id:localInfo.id},success:function(t){return 1e4!=t.status?alert(r.message):void wxHeck.sendMsg({action:"chat_trust_set",id:localInfo.id,type:"web",trust_id:e})}})},getSendPaste:function(e){var t=this,s=e.imgSrc;wxHeck.getData({url:"/UploadFile/screenImg",data:{file_base64:s,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(e){if(1e4==e.status){var i={action:"chat",id:localInfo.id,type:"web",to_id:t.wxData.curUserId,to_type:"ios",content:e.message,cnt_type:1};if(t.setGroupChat.flag)return t.sendGroupChat(i),void t.$broadcast("hideSendPaste");if(t.helperSel.flag)return t.sendHelperChat(i),void t.$broadcast("hideSendPaste");wxHeck.pushMsg({pushId:t.wxData.curUserId,isCC:!0,msg:[s,e.message],time:(new Date).getTime(),cnt_type:9999}),wxHeck.sendMsg(i),t.$broadcast("hideSendPaste")}else alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),t.$broadcast("enableSendPaste")},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),t.$broadcast("enableSendPaste")}})},addFriendNextCb:function(e){var t={id:localInfo.id,action:"find_contact_keywd",type:"web",to_type:"ios",keyword:e.keyword};wxHeck.sendMsg(t)},addFriendCb:function(e){var t={0:"add_friend",1:"add_card_friend"},s={id:localInfo.id,action:t[e.type],type:"web",to_id:this.wxData.curUserId,to_type:"ios",wxid:e.wxid,verify_msg:e.verify_msg,user_id:e.user_id,mobile:e.mobile,remark:e.remark};wxHeck.sendMsg(s),wxHeck.getData({url:"/WechatUserInfo/addUserInfo",data:{stu_id:e.user_id,wechat_id:e.wxid,mobile:e.mobile},success:function(e){console.log("\u8bb0\u5f55\u5f53\u524d\u5b66\u5458\u6dfb\u52a0\u8005\u4fe1\u606fOK")},error:function(){}})},addListFriend:function(e,t,s){this.$broadcast("showAddFriend",{type:0,acc:e,crmMobile:e,crmId:t,addType:s})},getFace:function(e){if(0==e.type){var t=wxHeck.getTextPos();if(!t)return;var s=e.con,i=t.startPos,n=t.endPos,a=i,o=this.wxData.msgList[this.wxData.curUserId].msgContent,r=o.slice(0,i)+s+o.slice(n);this.wxData.msgList[this.wxData.curUserId].msgContent=r,this.$nextTick(function(){t.setPos(a+s.length)})}},infoUpdateCb:function(e){$.extend(this.wxData.localInfo,e),this.$broadcast("hideUpdate")},getSearch:function(e){wxHeck.toTop(e),this.changeUser(e),wxHeck.userBoxTop()},getQuickCon:function(e){var t=this,s=wxHeck.Util.conRegArr,i={},n=t.wxData,a=n.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo,o=[n.localInfo.nick_name,a.member?4==a.selectMember?"":a.member[a.selectMember]:a.member,a.nick_name],r=e.replace(/{[^{}]*}/,"");$.map(s,function(e,t){i[e]=o[t]}),t.wxData.msgList[this.wxData.curUserId].msgContent=wxHeck.Util.conFilter(r,i)},userSelSure:function(e){var t=this;"getGroup"==e.openType?_confirm("\u9ed1\u9e1f\u4e0d\u4f1a\u9650\u5236\u7fa4\u53d1\uff0c\u4f46\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u800c\u4e14\u5b66\u5458\u4e5f\u4e0d\u559c\u6b22\u7ecf\u5e38\u6536\u5230\u548c\u8425\u9500\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f60\u662f\u5426\u8981\u6025\u9700\u7fa4\u53d1\uff1f",function(){t[e.openType+"Par"](e.returnData)}):t[e.openType+"Par"](e.returnData)},editNameSure:function(e){this.$broadcast("editNameClose"),wxHeck.sendMsg({id:localInfo.id,action:e.isGroup?"modify_name":"modify_remark",type:"web",to_id:this.wxData.curUserId,to_type:"ios",new_name:e.editValue})},crmRemarkTableOpen:function(e){this.$broadcast("crmRemarkOpen",{user_id:e})},callTelpnone:function(e,t){wxHeck.getData({url:"/Call/handCall/",data:{user_id:e,wechat_id:localInfo.wechat_id},success:function(e){1e4!=e.status?alert(e.message):_alert("\u62e8\u6253\u6210\u529f\uff01")}})},studyChat:function(e){wxHeck.toTop(this.wxData.userList[0].split("$")[0]+"$"+e),this.changeUser(this.wxData.userList[0].split("$")[0]+"$"+e),wxHeck.userBoxTop()},changePage:function(e){this.$broadcast("pageOK",e)}},watch:{userListType:function(e){var t=this;"todayFocus"==e&&wxHeck.getData({url:"/UserContact/getFollowUserDate",success:function(e){if(1e4!=e.status)return!1;for(var s=e.message.length,i=[],n=0;s>n;n++)i.push(t.wxData.userList[0].split("$")[0]+"$"+e.message[n].wechat_id);t.todayFocusUser=i}})},noReadAll:function(e){e>0?wxHeck.flashTitleFn.set("\u60a8\u6709\u65b0\u7684\u6d88\u606f\uff01"):wxHeck.flashTitleFn.reset()}}}),function(){wxHeck.entered=!1,wxHeck.wb=function(){return t.WebSocket||t.MozWebSocket}(),wxHeck.wb&&(wxHeck.sendMsg=function(e){var t=e,s=e.to_id;switch(delete t.to_id,$.extend(t,{type:"helper"}),e.action){case"chat":$.extend(t,{to_type:"web",to_ids:s,helper_fg:"1",name:localInfo.admin_name,crm_id:localInfo.crm_id});break;case"chat_ok":$.extend(t,{to_id:s})}wxHeck.wb.OPEN==wxHeck.socket.readyState?wxHeck.socket.send(JSON.stringify(t)):console.log("The socket is not open.")},wxHeck.msgHandler=new function(){var e=this;e.heartbeat=function(e){wxHeck.heartbeat=0},e.enter=function(e){wxHeck.enterTime=e.time||(new Date).getTime(),wxHeck.wxInit.userProgress.isFirst=!1,wxHeck.msgHandler.add_users_res({list:[{id:"helper",c_remark:"helper",c_type:"0",nick:"helper",type:"web"}]}),wxHeck.sendMsg({action:"chat_helper_msg_st",id:localInfo.id,type:"web"}),wxHeck.wxInit.$broadcast("setErrors",{netErr:!1,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.heartbeat=0,clearInterval(wxHeck.interVal),wxHeck.interVal=window.setInterval(function(){wxHeck.heartbeat>=3?(wxHeck.wxInit.$broadcast("setErrors",{netErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.socket.close()):(wxHeck.sendMsg({action:"heartbeat",id:localInfo.id,type:"web"}),wxHeck.heartbeat++)},5e3)},e.ios_online=function(){wxHeck.wxInit.$broadcast("setErrors",{phoneErr:!1,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.getUserList()},e.ios_offline=function(){wxHeck.wxInit.$broadcast("setErrors",{phoneErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()})},e.find_contact_keywd=function(e){wxHeck.wxInit.$broadcast("addFriendToNext",e)},e.add_friend=e.add_card_friend=function(e){wxHeck.getData({url:"/UserContact/addFriendAndRmark",data:{admin_id:localInfo.id,user_id:wxHeck.wxInit.$refs.addfriend.crmId},success:function(){wxHeck.wxInit.$refs.addfriend.addType&&wxHeck.wxInit.$broadcast("studySearch")},error:function(){}}),wxHeck.wxInit.$broadcast("hideAddFriend"),wxHeck.wxInit.$root.$data.addDelFriendInfo.show=!1},e.remove_users=function(e){var t=$.inArray(e.wxid,wxHeck.dataSource.userList),s=t==wxHeck.dataSource.userList.length-1?t-1:t+1,i=wxHeck.dataSource.userList[s];wxHeck.dataSource.userList.$remove(e.wxid),wxHeck.dataSource.userListPerson.$remove(e.wxid),wxHeck.wxInit.changeUser(i),_alert("\u5220\u9664\u6210\u529f\uff01")},e.group_user_list=function(e){Vue.set(wxHeck.dataSource.groupUserLists,e.from_id,e.list)},e.group_ownner_id=function(e){wxHeck.dataSource.groupFromId=e.from_id,wxHeck.dataSource.groupOwnner=e.owner_id},e.add_group_mem=function(e){$.map(e.infoList,function(t,s){wxHeck.dataSource.groupUserLists[e.from_id].push(t)})},e.del_group_mem=function(e){wxHeck.wxInit.$broadcast("delGroupListUser",e)},e.is_contact_in_grouparray=function(e){var t=e.result,s=wxHeck.getFullId(e.groupdata.id);wxHeck.wxInit.wxData.msgList[s].showHW=t},e.user_list=e.add_users_res=function(e){!function(){if(1e4!=e.action_type){var t="add_users_res"==e.action;!function(e,s){$.map(e,function(e,i){var n=e.id,a=e.time,o=!!a&&a>0,r=e.num,c=1==e.c_type;return n in s?!0:(o&&(wxHeck.wxInit.noReadAll+=r),e.label||(e.label=""),e.labelOpen=!1,Vue.set(s,n,{showHW:999,at_fg:0,atshow:!1,userInfo:e,userMsg:[],noRead:o?r:0,lastMsg:"",msgContent:"",crmInfo:{isGet:!1},historyMsg:{isGetAll:!1,score:wxHeck.enterTime},time:a,isGroup:c,isTop:!1,isGroupOwner:!1}),t?(wxHeck.toTop(n),wxHeck.userBoxTop()):wxHeck.dataSource.userList[o?"unshift":"push"](n),void wxHeck.dataSource[c?"userListGroup":"userListPerson"].push(n))}),wxHeck.wxInit.userProgress.isFirst=!1}(e.list,wxHeck.dataSource.msgList),t||wxHeck.sendMsg({action:"top_session_list",id:localInfo.id,type:"web"})}}()},e.chat_helper_msg_st=function(e){var t=e.list;0!=t.length&&$.map(t,function(e,t){!function(){
var t=e.id,s=wxHeck.wxInit.wxData.userList;$.inArray(t,s)>-1||wxHeck.msgHandler.add_users_res({list:[{id:t,c_remark:e.name,c_type:"0",nick:e.name,type:"web"}]})}();var s=wxHeck.wxInit.wxData.msgList[e.id];s&&(s.noRead=e.num,s.time=e.time)})},e.modify_name=function(e){var t=e.from_id;wxHeck.dataSource.msgList[t].userInfo.nick=e.new_name},e.modify_remark=function(e){var t=e.from_id;wxHeck.dataSource.msgList[t].userInfo.c_remark=e.c_remark,wxHeck.wxInit.getCrmInfo()},e.modify_label=function(e){wxHeck.dataSource.msgList[e.from_id].userInfo.label=e.labels},e.chat=function(e){if(function(){var t=e.from_id,s=wxHeck.wxInit.wxData.userList;$.inArray(t,s)>-1||wxHeck.msgHandler.add_users_res({list:[{id:t,c_remark:e.name,c_type:"0",nick:e.name,type:"web"}]})}(),3100==e.cnt_type){var t=JSON.parse(e.content),s=wxHeck.wxInit;s.wxData.msgList[e.from_id].at_fg=parseInt(t.at_fg),s.wxData.msgList[e.from_id].atshow=!0}!function(){var t=e.from_id==localInfo.id,s=t?e.to_id:e.from_id;if(wxHeck.wxInit.wxData.msgList[s]){var i=wxHeck.wxInit.wxData.curUserId!=s&&!t,n=4e3==e.cnt_type||5e3==e.cnt_type,a=function(){var e=$(".content_message")[0];if(!e)return!1;var i=e.scrollTop+e.clientHeight<e.scrollHeight;return wxHeck.wxInit.wxData.curUserId==s&&!t&&i}();(i||n||a)&&(wxHeck.wxInit.wxData.msgList[s].noRead++,wxHeck.wxInit.noReadAll++,wxHeck.toTop(s)),wxHeck.wxInit.wxData.curUserId!=s||t||a||wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:s});var o=function(e){return e?e[0].scrollTop==e[0].scrollHeight-e[0].clientHeight:!1}(wxHeck.msgBox);wxHeck.pushMsg({pushId:s,isCC:t,msg:e.content,gotoBottom:o,time:e.time,name:e.name,c_remark:e.c_remark,cnt_type:e.cnt_type,source:e})}}()},e.receive_wcmsg=function(e){wxHeck.wxInit.wxData.comment=e.number},e.get_version=function(e){wxHeck.dataSource.clientVersion=e.client_version,wxHeck.dataSource.cloudVersion=e.cloud_version},e.chat_trust_set=function(){alert("\u6258\u7ba1\u6210\u529f\uff01"),wxHeck.Util.closeTab()},e.is_myfriend=function(e){wxHeck.wxInit.isMyFriend(e)},e.hello_number=function(e){wxHeck.wxInit.newFriCount=e.number},e.hello_list=function(e){wxHeck.wxInit.$broadcast("myFriendData",e.arr)},e.add_hello_friend=function(e){wxHeck.wxInit.$broadcast("myFriendSure",e.encryptusername)},e.top_session_list=function(e){var t=wxHeck.wxInit.wxData.userList[0];if(t){var s=t.split("$")[0]+"$",i=$.map(e.list,function(e,t){var i=s+e,n=wxHeck.wxInit.wxData.userList.$remove(i);return n?i:void 0});wxHeck.wxInit.wxData.userList=i.concat(wxHeck.wxInit.wxData.userList),wxHeck.wxInit.wxData.topList=i}},e.receive_file=function(e){console.log(e)},e.user_info=function(e){wxHeck.wxInit.$root.$data.personalInfo.id=void 0==e.id?"":e.id,wxHeck.wxInit.$root.$data.personalInfo.wechat_username=void 0==e.wechat_username?"":e.wechat_username,wxHeck.wxInit.$root.$data.personalInfo.img=void 0==e.img?"":e.img,wxHeck.wxInit.$root.$data.personalInfo.nick=void 0==e.nick?"":e.nick,wxHeck.wxInit.$root.$data.personalInfo.qrcode_url=void 0==e.qrcode_url?"":e.qrcode_url},e.change_chatroom_owner=function(e){wxHeck.wxInit.$broadcast("changeOwnerOk")},e.get_contact_details=function(e){wxHeck.wxInit.$broadcast("showCutUserLayer",{details:e.details})}},function(){return wxHeck.args=arguments,wxHeck.wsHost=function(){return localInfo.isLocal?"ws://172.16.0.92:8801/websocket":localInfo.ws_host?"ws://"+localInfo.ws_host+"/websocket":void 0}(),wxHeck.wsHost?(wxHeck.socket=new wxHeck.wb(wxHeck.wsHost),wxHeck.socket.onopen=function(e){wxHeck.entered=!0,clearInterval(wxHeck.interFirstEnter),wxHeck.sendMsg({action:"enter",id:localInfo.id,type:"web",v_code:localInfo.v_code})},wxHeck.socket.onclose=function(e){console.log("The socket is closed")},wxHeck.socket.onerror=function(){wxHeck.wxInit.$broadcast("setErrors",{netErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()})},void(wxHeck.socket.onmessage=function(e){var t=JSON.parse(e.data);if("web_update_msg"==t.action)return void _alert("\u6709\u65b0\u7248\u672c\u4e0a\u7ebf\uff0c\u8bf7\u5237\u65b0\u6d4f\u89c8\u5668\u66f4\u65b0",function(){window.location.reload(!0)});if(10005==t.status&&"enter"==t.action)return clearInterval(wxHeck.interVal),void(1==localInfo.is_trust?(alert("\u6258\u7ba1\u8eab\u4efd\u88ab\u53d6\u6d88\uff01"),wxHeck.Util.closeTab()):wxHeck.dataSource.repeatEnter=!0);if(t.status&&2e4==t.status&&"find_contact_keywd"==t.action){var s=wxHeck.wxInit.$refs.addfriend;if(s.addType&&s.crmId)return void wxHeck.getData({url:"/WechatUserInfo/getUserInfoByUserId",data:{stu_id:s.crmId},success:function(e){return 1e4!=e.status?alert(e.message):void(e.message&&e.message.wechat_id?(_alert("\u4e0a\u4e00\u4e2a\u624b\u673a\u53f7\u672a\u641c\u7d22\u5230\u5fae\u4fe1\u53f7\uff0c\u7cfb\u7edf\u4eceCRM\u5e93\u4e2d\u6362\u4e00\u4e2a\u624b\u673a\u53f7\u7ee7\u7eed\u641c\u7d22\u3002"),s.wxAcc=e.message.wechat_id):_alert(t.message))}})}if(t.status&&2e4==t.status&&"add_friend"==t.action){var s=wxHeck.wxInit.$refs.addfriend,i=localInfo.wechat_id+"$"+t.wxid;if(s.addType){var n=s.crmId;wxHeck.getData({url:"/UserContact/addUserWechatContact",data:{wechat_id:i,user_id:n},success:function(e){return 1e4!=e.status?alert(e.message):(_alert("\u5b66\u5458\u5df2\u5728\u4f60\u7684\u597d\u53cb\u5217\u8868\u4e2d\uff0c\u73b0\u5df2\u6210\u529f\u7ed1\u5b9a\uff01"),wxHeck.sendMsg({id:localInfo.id,action:"modify_remark",type:"web",to_id:i,to_type:"ios",new_name:s.remark}),wxHeck.wxInit.getCrmInfo(!0,i),s.addFriendHide(),void wxHeck.wxInit.$broadcast("studySearch"))}})}else _alert(t.message),s.addFriendHide(),wxHeck.toTop(i)}else{if(t.status&&1e4!=t.status){var a=t.message||t.msg;return _alert(a)}"function"==typeof wxHeck.msgHandler[t.action]&&wxHeck.msgHandler[t.action](t)}})):void(window.confirm("\u8fde\u63a5\u5931\u8d25\uff0c\u5237\u65b0\u91cd\u8bd5\uff1f")&&window.location.reload())}())}()}(window)});