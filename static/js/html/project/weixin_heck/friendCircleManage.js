define("friendCircleManage",["plupload","niceScroll","layui"],function(e,t,o){e("niceScroll"),e("layui"),$.fn.heckScroll=function(){var e=$(this);return e.niceScroll({cursorcolor:"#686b71",autohidemode:!0,cursorwidth:7,cursorborderradius:"999px",cursorborder:0,horizrailenabled:!1}),e},window.onscroll=function(){$(document).scrollTop()>80?$(".uptop").show():$(".uptop").hide()},$(".uptop").click(function(){$("html,body").animate({scrollTop:0},500)}),$(".sel-types p[label-value=all]").click(function(){var e=$(this).hasClass("choose-show");e?$(".choose-show[label-value != all]").removeClass("choose-show"):$.each($(".sel-types [label-value != all]"),function(e,t){$(t).attr("label-value")&&$(t).addClass("choose-show")})});for(var n,i,s=0;24>s;s++)n+='<option value="'+s+'">'+s+"</option>";$(".putHours select").html(n);for(var a=0;60>a;a++)a%15==0&&(i+='<option value="'+a+'">'+a+"</option>");$(".putMinut select").html(i),$(".times").on("click",function(){$("#setTime").show(300)}),$(".closeTimeBtn").on("click",function(e){$("#setTime").hide(),e.stopPropagation()}),$(".already_send_mes").on("click",".close_btn",function(){var e=$(this).closest(".already_mes").attr("id"),t=$(this).attr("delet-url");console.log(e),window.confirm("\u786e\u8ba4\u5220\u9664\u6b64\u6761\uff1f")&&$.ajax({url:t,type:"post",dataType:"json",data:{id:e},success:function(e){1e4==e.status?window.location.reload():10020==e.status?window.location="/AdminContact/guide":alert(e.message)},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}})});var l,r,c,u,d,h,f,p,m,g=function(){var e=$(".up_img"),t=e.children("ul"),o=t.find(".add_img");return $browse=$("#browse"),close,close=function(){window.confirm("\u786e\u8ba4\u5173\u95ed\u5220\u9664\u56fe\u7247\u5417\uff1f")&&(t.find(".js-check").remove(),e.hide(),l.splice(0,20),t.find(".js-addP").parent().remove())},e.on("click","p>span",close),t.on("click","#addImg",function(){$browse.trigger("click")}).on("click","li>span",function(){var e=$(this),o=e.siblings("img").attr("imgId");l.removeFile(o),e.parent().remove(),t.find("li").length<=10&&$(".add_img").show()}).on("click","li>i",function(){var e=$(this);e.parent().remove(),t.find("li").length<=10&&$(".add_img").show()}),{close:close,open:function(){e.show()},setCon:function(e){var t=[];$.map(e,function(e,o){t.push('<li><img src="'+e.imgSrc+'" imgId="'+e.imgId+'"class="js-addP" /><span>&times;</span></li>')}),e.length<=9&&(o.before(t.join("")),$(".add_img").show())}}},v=g(),w={expire:0};r=function(){var e=Math.ceil((new Date).getTime()/1e3),t=w.expire,o=8,n=0>=t-(e+o);n&&$.ajax({url:"/AdminContact/upload",type:"post",dataType:"json",success:function(e){w=e},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")},async:!1})},c=function(e,t){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var o=new mOxie.FileReader;o.onload=function(){t(o.result),o.destroy(),o=null},o.readAsDataURL(e.getSource())}else{var n=new mOxie.Image;n.onload=function(){var e="image/jpeg"==n.type?n.getAsDataURL("image/jpeg",80):n.getAsDataURL();t&&t(e),n.destroy(),n=null},n.load(e.getSource())}},u=function(e,t){var o=e.length,n=[];$.map(e,function(e,i){c(e,function(i){n.push({imgId:e.id,imgSrc:i}),o--,0==o&&"function"==typeof t&&t(n)})})},d=function(e){var e=e||32,t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,n=[];for(s=0;e>s;s++)n.push(t.charAt(Math.floor(Math.random()*o)));return n.join("")},h=function(e){var t=e.lastIndexOf(".");return t>-1?e.substring(t):void 0},f=function(e){return d(20)+h(e)};var _=[];p=function(e){_=[];var t=$(".choose-show[label-value != all]");$.each(t,function(e,t){var o=$(t).attr("label-value");_.push(o)});var o=$(".send_to_user").attr("ajax-url"),n={url:o,type:"post",dataType:"json",success:function(e){1e4==e.status?window.location.reload():10020==e.status?window.location="/AdminContact/guide":($(".load_up").hide(),alert(e.message))},error:function(){$(".load_up").hide(),alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")},complete:function(){$(".load_up").hide()}},i=$.extend({},n,e);console.log(i.data),$.ajax(i)},m=function(e){l=new plupload.Uploader({url:"http://oss.aliyuncs.com",runtimes:"html5,silverlight,html4",browse_button:"browse",container:"select_mes",filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}],max_file_size:"5120kb"},init:{PostInit:function(){console.log("upload init")},FilesAdded:function(e,t){var o=$(".up_img").find(".js-check");e.files.length>9-o.length?(alert("\u4e0a\u4f20\u56fe\u7247\u6570\u4e0d\u80fd\u591a\u4e8e9\u5f20"),e.splice(0,100)):e.files.length<9-o.length?u(t,function(e){v.setCon(e),v.open()}):e.files.length==9-o.length&&(console.log(e.files.length),u(t,function(e){v.setCon(e),v.open(),$(".add_img").hide()}))},BeforeUpload:function(e,t){r(),t.fileName=f(t.name),t.fileKey=w.dir+t.fileName,t.fileFullName=w.host+"/"+w.dir+t.fileName,new_multipart_params={key:t.fileKey,policy:w.policy,OSSAccessKeyId:w.accessid,success_action_status:"200",signature:w.signature},e.setOption({url:w.host,multipart_params:new_multipart_params})},UploadProgress:function(e,t){},FileUploaded:function(e,t,o){},UploadComplete:function(t,o){"function"==typeof e.complete&&e.complete(t,o)},FilesRemove:function(e,t){},Error:function(e,t){console.log("error "+e,t)}}}),window.uploader=l,l.init()},m({complete:function(e,t){var o=$.map(t,function(e,t){return e.fileKey}),n=[],i=$(".js-check");if(i.length>0)for(var s=0;s<i.length;s++)n.push(i.eq(s).find("img").attr("src"));var a=$("#layui-laydate-input").val(),l=$(".putHours select").val(),r=$(".putMinut select").val(),c=a+" "+l+":"+r,u={text:y,imgHost:w.host,imgSrc:o.join(","),pubTime:c,userGroup:_};p({data:u})}}),$.fn.insertText=function(e){return this.each(function(){if("INPUT"===this.tagName||"TEXTAREA"===this.tagName)if(document.selection){this.focus();var t=document.selection.createRange();t.text=e,t.collapse(),t.select()}else if(void 0!==this.selectionStart){var o=this.selectionStart,n=this.selectionEnd;this.value=this.value.substring(0,o)+e+this.value.substring(n,this.value.length),this.selectionStart=this.selectionEnd=o+e.length}else this.value+=e}),this},$(".smail").on("click","em",function(e){$(".face_panel").fadeIn(),e.stopPropagation()}),$(window).on("click",function(){$(".face_panel").fadeOut()}),$(".face_con").on("click",".qqface",function(){var e=$(this),t=$("textarea"),o="/"+e.attr("title");t.val();t.insertText(o)});var y,b=$(".send_message textarea"),_=[];$("#start_upload").on("click",function(){y=$.trim(b.val());var e=l.files.length,t=$("#layui-laydate-input").val(),o=$(".putHours select").val(),n=$(".putMinut select").val(),i=t+" "+o+":"+n;if(0==t.length)return alert("\u8bf7\u9009\u62e9\u53d1\u9001\u65f6\u95f4\uff01");var s=new Date,a=""+s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes(),r=new Date(i),c=new Date(a);if(c>r)return alert("\u53d1\u5e03\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u5f53\u524d\uff01");if(0==$(".choose-show").length)return alert("\u8bf7\u52fe\u9009\u81f3\u5c11\u4e00\u4e2a\u6807\u7b7e\uff01");_=[];var u=$(".choose-show[label-value != all]");if($.each(u,function(e,t){var o=$(t).attr("label-value");_.push(o)}),void 0==_[0]&&_.splice(0,1),0==e){var d=[],h=$(".js-check"),t=$("#layui-laydate-input").val(),o=$(".putHours select").val(),n=$(".putMinut select").val(),i=t+" "+o+":"+n;if(h.length>0)for(var f=0;f<h.length;f++)d.push(h.eq(f).find("img").attr("src"));var m={text:y,pubTime:i,userGroup:_};p({data:m})}else $(".load_up").show(),l.start()}),window.closeIfr=function(){var e=sessionStorage.getItem("text"),t=$(".up_img"),o=t.children("ul"),n=sessionStorage.getItem("imgArr");n||(n="");var i=n.split(","),s=sessionStorage.getItem("flag"),a=$(".up_img");1==s&&(""!=$(".send_message").find("textarea").val()?confirm("\u60a8\u786e\u5b9a\u8981\u653e\u5f03\u73b0\u5728\u7f16\u8f91\u7684\u5185\u5bb9\u5417\uff1f")&&$(".send_message").find("textarea").val(e):$(".send_message").find("textarea").val(e),""!=n&&(i.length<9&&i.length>=1?(o.find(".js-check").remove(),l.splice(0,20),o.find(".js-addP").parent().remove(),a.find(".add_img").before(i.join("")),a.show(),a.find(".add_img").show()):9==i.length&&(o.find(".js-check").remove(),l.splice(0,20),o.find(".js-addP").parent().remove(),a.find(".add_img").before(i.join("")),a.find(".add_img").hide(),a.show())),sessionStorage.setItem("flag",0),sessionStorage.setItem("text",""),sessionStorage.setItem("imgArr",""))},function(){var e=$(".sel-types p[label-value=all]"),t=$(".sel-types p[label-value!=all]");e.on("click",function(){e.hasClass("choose-show2")?(e.removeClass("choose-show2"),t.removeClass("choose-show")):(e.addClass("choose-show2"),t.addClass("choose-show"))}),t.on("click",function(){var o=$(this);o.hasClass("choose-show")?o.removeClass("choose-show"):o.addClass("choose-show"),t.length!=$(".choose-show").length?e.removeClass("choose-show2"):e.addClass("choose-show2")})}()});