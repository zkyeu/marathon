define("weixinHeck",["niceScroll","vm","fancybox","weixinUtil","editImg","layui","upload","html2js","uploadCos","clipboard","weixinRecorder"],function(t,e,i){t("html2js"),$("#app").replaceWith(window.html2js["html/weixin_heck/weixin_body.html2js.html"]),t("layui"),t("weixinRecorder");var s=t("editImg");$.fn.wxScroll=function(){var t=$(this);return t.niceScroll({cursorcolor:"#686b71",autohidemode:!0,cursorwidth:7,cursorborderradius:"999px",cursorborder:0}),t};new Clipboard(".copytext",{target:function(){return document.querySelector("#wechatName")}});$("[rel=gallery]").fancybox({openEffect:"none",closeEffect:"none",padding:0}),function(){var t=localInfo.wxHelper;if(t){var e=[];e.push({id:t.id,c_type:"0",img:localInfo.helperImg,nick:t.nick}),localInfo.wxHelper=e}}(),function(e){if(e.wxHeck=e.wxHeck||{},wxHeck.dataSource={localInfo:localInfo,userList:[],userListAll:[],userListGroup:[],userListPerson:[],groupUserLists:{},groupFromId:"",groupOwnner:"",showOwnnerBtn:!1,curUserId:"",msgList:{},trustList:[],comment:0,clientVersion:"",cloudVersion:"",wechat_version:"",topList:[],helpList:[],repeatEnter:!1,muteList:[]},wxHeck.Util=t("weixinUtil"),wxHeck.Util.wxPop(),wxHeck.isChrome="Chrome"==wxHeck.Util.checkBrowser(),!wxHeck.isChrome)return $(".update_mask2").show();wxHeck.uploadFn=t("upload"),wxHeck.uploadFnCos=t("uploadCos"),wxHeck.userBox=$(".user_lists").wxScroll(),wxHeck.isCC=function(){return"cc"==wxHeck.wxInit.wxData.localInfo.admin_type},wxHeck.isSS=function(){return"is"==wxHeck.wxInit.wxData.localInfo.admin_type},wxHeck.getFullId=function(t){return localInfo.wechat_id+"$"+t},wxHeck.userBoxTop=function(){var t=$(".user_lists").wxScroll();return function(){t.scrollTop(0)}}(),wxHeck.checkUserType=function(t,e){var i="";if(wxHeck.isCC())if(6==localInfo.user_group||7==localInfo.user_group||8==localInfo.user_group||9==localInfo.user_group)i=t;else{var s="\u6211\u662f"+t+"\uff0c\u6211\u5e26\u60a8\u505a\u4e00\u4e0b\u8bfe\u524d\u51c6\u5907\uff0c\u60a8\u52a0\u4e00\u4e0b\u6211\u7684\u5fae\u4fe1\u5427\uff5e",n="\u60a8\u597d\uff0c\u6211\u662f"+t+"\uff0c\u6211\u7ed9\u60a8\u53d1\u4e00\u4e0b\u4f53\u9a8c\u8bfe\u62a5\u544a\uff0c\u60a8\u52a0\u4e00\u4e0b\u6211\u7684\u5fae\u4fe1\u5427\uff5e",a="\u60a8\u597d\uff0c\u6211\u662f"+t+"\uff0c\u6211\u5e2e\u60a8\u91cd\u65b0\u9884\u7ea6\u4e00\u8282\u5916\u6559\u8bfe\u5427\uff5e",o="\u60a8\u597d\uff0c\u6211\u662f"+t+"\uff0c\u6709\u65f6\u95f4\u6211\u5e2e\u60a8\u9884\u7ea6\u4e00\u8282\u5916\u6559\u8bfe\u5427\uff5e";switch(console.log("userName\uff1a"+t,"\u7c7b\u578b\uff1a"+e),e){case"on":i=s;break;case"non":i=o;break;case"end":i=n;break;case"cancel":case"s_absent":case"t_absent":i=a;break;default:i=t}}else i="51Talk\u73ed\u4e3b\u4efb\u8001\u5e08\uff1a"+t;return i},wxHeck.labelFn={nameMap:{},idMap:{},get:function(){var t=localInfo.labelList,e=this;$.map(t,function(t,i){$.map(t,function(t,i){e.nameMap[t.tag_name]=e.idMap[t.id]=t})})}},wxHeck.labelFn.get(),wxHeck.toTop=function(t){console.log("to top ====> "+t);var e=wxHeck.wxInit.wxData,i=e.helpList.indexOf(t),s=e.topList.indexOf(t);e.userList.$remove(t);var n;switch(!0){case i>-1:n=0;break;case s>-1:n=e.helpList.length;break;default:n=e.helpList.length+e.topList.length}e.userList.splice(n,-1,t)},wxHeck.scrollToBottom=function(){wxHeck.msgBox&&(document.hidden||wxHeck.msgBox.scrollTop(wxHeck.msgBox.get(0).scrollHeight))},wxHeck.getData=function(t){var e={timeout:1e4,type:"post",dataType:"json",error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}},i=$.extend({},e,t);$.ajax(i)},wxHeck.getDouble=function(t){var e=t+"";return e.length>1?e:"0"+e},wxHeck.getTime=function(t){var e=new Date(+t),i=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()];return i=$.map(i,function(t,e){return wxHeck.getDouble(t)}),i.slice(0,3).join("/")+" "+i.slice(3).join(":")},wxHeck.upLoadImgInit=function(t){wxHeck.uploadFn.init({progress:function(){return $(".send_progress>i")[0]},filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}]},BeforeUpload:function(e,i,s){t.setGroupChat.flag||s(i,function(e){wxHeck.pushMsg({pushId:t.wxData.curUserId,isCC:!0,msg:[e,i.fileFullName],time:(new Date).getTime(),cnt_type:9999})})},FileUploaded:function(e,i,s){var n={action:"chat",id:localInfo.id,type:"web",to_id:t.wxData.curUserId,to_type:"ios",content:i.fileFullName,cnt_type:1};return t.setGroupChat.flag?void t.sendGroupChat(n):void wxHeck.sendMsg(n)},Error:function(t,e){alert(e.message)}})},wxHeck.upLoadFileInit=function(t){wxHeck.uploadFnCos.init({selector:"#send_file_button",fileLimitType:"jpg,jpeg,gif,png,bmp,pdf,doc,xlsx,txt,xls,docx,pptx,ppt",startCallBack:function(){t.loading.show=!0},error:function(e){return t.loading.show=!1,-1==e.errorCode?alert("\u6587\u4ef6\u4e0a\u4f20\u683c\u5f0f\u9519\u8bef\uff01"):-2==e.errorCode?alert("\u6700\u5927\u53ea\u80fd\u53d1\u90015M\u7684\u6587\u4ef6\uff01"):void 0},errorCallBack:function(e){alert(e.responseJSON.message),t.loading.show=!1},successCallBack:function(e){var i=JSON.stringify({title:e.fileInfo.fileName,introduction:e.fileInfo.fileSize+"K",icon:localInfo.fileicon,link:e.fileUpdate.data.access_url,id:e.fileUpdate.data.vid});wxHeck.sendMsg({action:"chat",id:localInfo.id,to_id:wxHeck.wxInit.wxData.curUserId,type:"web",cnt_type:3e3,content:i}),wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:i,cnt_type:3e3,time:(new Date).getTime()}),t.loading.show=!1},progress:function(){return $(".send_progress>i")[0]}})},wxHeck.getTextPos=function(){var t=$(".send_text")[0];if(t)try{var e=t.selectionStart,i=t.selectionEnd;return{startPos:e,endPos:i,setPos:function(e){t.selectionStart=t.selectionEnd=e}}}catch(s){}},wxHeck.getUserList=function(){wxHeck.wxInit.wxData.userList.length>0||(wxHeck.sendMsg({action:"gain_user_list",id:localInfo.id,type:"web"}),wxHeck.sendMsg({action:"receive_wcmsg",id:localInfo.id,type:"web"}),wxHeck.sendMsg({action:"follow_info",id:localInfo.id,type:"web"}))},wxHeck.pushMsg=function(t){var e={pushType:"push",gotoBottom:!0,isGetHistory:!1,cnt_type:0},i=$.extend({},e,t);if(i.isGetHistory&&(i.gotoBottom=!1),wxHeck.wxInit.wxData.msgList&&wxHeck.wxInit.wxData.msgList[i.pushId]){var s={62:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u89c6\u9891\uff0c\u4f46\u6682\u65f6\u65e0\u6cd5\u5728\u7f51\u9875\u7aef\u770b\u7528\u6237\u7684\u89c6\u9891",492001:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u7ea2\u5305\uff0c\u53ef\u4ee5\u63d0\u9192\u7528\u6237\u6211\u4eec\u4e0d\u80fd\u63a5\u53d7\u5ba2\u6237\u7684\u7ea2\u5305",48:"\u6536\u5230\u7528\u6237\u53d1\u9001\u7684\u5730\u5740\uff0c\u4f46\u73b0\u5728\u4e0d\u652f\u6301\u67e5\u770b\u5730\u5740",50:"\u5bf9\u65b9\u9080\u8bf7\u4f60\u97f3\u89c6\u9891\u901a\u8bdd\uff0c\u4f46\u6211\u4eec\u4e0d\u652f\u6301\u97f3\u89c6\u9891\u901a\u8bdd"};if(i.msg=function(){if(0==i.cnt_type)return i._msg=wxHeck.Util.msgFilter(i.msg,!0),wxHeck.Util.msgFilter(i.msg);if(42==i.cnt_type||3e3==i.cnt_type||3001==i.cnt_type||3100==i.cnt_type||495==i.cnt_type||4950==i.cnt_type||6e3==i.cnt_type||6001==i.cnt_type)try{return JSON.parse(i.msg)}catch(t){return i.msg}return s[i.cnt_type]||i.msg}(),wxHeck.wxInit.wxData.msgList[i.pushId].userMsg[i.pushType]({isCC:i.isCC,content:i.msg,time:wxHeck.getTime(i.time),name:i.name,cnt_type:i.cnt_type,mem_id:t.source?t.source.mem_id:"",from_id:t.source?t.source.from_id:"",source:t.source}),!i.isGetHistory){var n=wxHeck.wxInit.wxData.msgList[i.pushId].isGroup&&!i.isCC?i.name+":":"",a=function(){return 0==i.cnt_type?i._msg:1==i.cnt_type||9999==i.cnt_type?"[\u56fe\u7247\u6d88\u606f]":2==i.cnt_type?"[\u8bed\u97f3\u6d88\u606f]":42==i.cnt_type?"[\u540d\u7247\u6d88\u606f]":3e3==i.cnt_type||3001==i.cnt_type?"[\u5361\u7247\u6d88\u606f]":495==i.cnt_type?"[\u6587\u7ae0\u6d88\u606f]":4950==i.cnt_type?"[\u52a0\u7fa4\u9080\u8bf7]":6e3==i.cnt_type?"[\u6536\u5230\u6587\u4ef6]":6001==i.cnt_type?"[\u89c6\u9891]":3100==i.cnt_type?i.msg.content:s[i.cnt_type]||i.msg}();wxHeck.wxInit.wxData.msgList[i.pushId].lastMsg=n+a}i.gotoBottom&&window.setTimeout(function(){wxHeck.scrollToBottom()},0)}},wxHeck.getImgUrl=function(t){if(!t)return"";var e=t.split(".")[0].replace(/h.*\//,""),i={testtest1117:"bbimage1",weixinheiniao:"bbimage2",useoss:"bbimage2"},s=t.replace(/h.*com/,"/"+i[e]);return s},wxHeck.isMyFriend=function(t){return $.inArray(t,wxHeck.wxInit.wxData.userList)>-1},wxHeck.isHelper=function(){var t=wxHeck.wxInit.wxData.curUserId,e=wxHeck.wxInit.wxData.helpList;return $.inArray(t,e)>-1},wxHeck.flashTitle=wxHeck.Util.flashText(),wxHeck.flashTitleFn=function(){var t=document.title;return{set:function(t){wxHeck.flashTitle.set(t,function(t){document.title=t})},reset:function(e){wxHeck.flashTitle.reset(function(){document.title=t,"function"==typeof e&&e()})}}}();var i=Vue.extend({template:"#weixin_sel_bom",data:function(){return{selSelect:[],selFilter:"",selShow:!1,openType:"getChat",inputMsg:"",selLabel:"",selLabelss:localInfo.labelList,selList:[],chatType:"",isPending:{flag:!1,text:"",isSure:!1,sureText:""}}},props:{selData:{"default":function(){return{}}},selLabels:{"default":function(){return[]}},localInfo:{"default":function(){return{}}}},computed:{inputMsgVal:function(){return $.trim(this.inputMsg)},isGetGroupChat:function(){return"getGroupChat"==this.openType},isSingle:function(){return this.isGetGroupChat&&"0"==this.chatType},isGroup:function(){return this.isGetGroupChat&&"1"==this.chatType},selTitle:function(){return this.isSingle?"\u7fa4\u53d1\u4e2a\u4eba":this.isGroup?"\u7fa4\u53d1\u7ed9\u7fa4":"\u9009\u62e9\u8054\u7cfb\u4eba"},selLists:function(){var t=this,e=$.trim(t.selFilter),i=t.selLabel;if(""==e&&""==i||0==t.selList.length)return t.selList;var s=[];return $.map(t.selList,function(n,a){var o=t.selData[n].userInfo,r=t.isMath(o.c_remark,e)||t.isMath(o.nick,e),c=o.label.indexOf(i)>-1;r&&c&&s.push(n)}),s},isSelUserAll:function(){var t=this,e=$.trim(t.selFilter),i=t.selLabel;if(0==t.selList.length||0==t.selLists.length)return!1;if(""==e&&""==i)return t.selLists.length==t.selSelect.length;var s=!0;return $.map(t.selLists,function(e,i){return-1==t.selSelect.indexOf(e)?(s=!1,!1):void 0}),s}},watch:{selSelect:function(t){this.isGetGroupChat&&this.$dispatch("getSelList",t)}},methods:{isMath:function(t,e){return t?t.toLowerCase().indexOf(e.toLowerCase())>-1:void 0},selUser:function(t){var e=this.selSelect.indexOf(t);e>-1?this.selSelect.splice(e,1):this.selSelect.unshift(t)},selDel:function(t){this.selSelect.$remove(t)},selUserAll:function(){var t=this,e=$.trim(t.selFilter),i=t.selLabel;0!=t.selList.length&&0!=t.selLists.length&&(""==e&&""==i?t.isSelUserAll?t.selSelect=[]:t.selSelect=t.selLists.slice():t.isSelUserAll?$.map(t.selLists,function(e,i){t.selSelect.$remove(e)}):$.map(t.selLists,function(e,i){-1==t.selSelect.indexOf(e)&&t.selSelect.unshift(e)}))},selCancel:function(){this.selShow=!1,this.selSelect=[],this.selFilter="",this.inputMsg="",this.selLabel="",this.chatType="",this.isPendingDefault(),this.$root.parentSend=!1,this.$root.forwardText=""},isPendingDefault:function(){this.isPending.flag=!1,this.isPending.isSure=!1,this.isPending.sureText="",this.isPending.text=""},selOpen:function(){this.selShow=!0,this.$nextTick(function(){$(".sel_list").each(function(t,e){$(e).wxScroll()})})},selSure:function(){if(0!=this.selSelect.length&&("getGroup"!=this.openType||""!=this.inputMsg)){var t=this;t.$dispatch("userSelSure",{openType:t.openType,returnData:{selectList:t.selSelect.slice(),inputMsg:t.inputMsg}})}}},events:{userSelOpen:function(t){this.openType=t.type,this.chatType=t.chatType,this.selList=t[this.isGroup?"listGroup":"listPerson"],this.selOpen()},userSelClose:function(){this.selCancel()},userSelPending:function(t){this.isPending.text=t,this.isPending.flag=!0},userSelPendingSure:function(t){this.isPending.isSure=!0,this.isPending.sureText=t},userSelPendingDefault:function(){this.isPendingDefault()}}}),n=Vue.extend({template:"#weixin_edit",data:function(){return{editShow:!1,editvalue:"",isGroup:!1,isNicker:!1}},computed:{editValue:function(){return $.trim(this.editvalue.replace(/<|>|\//g,""))}},methods:{selCancel:function(){this.editShow=!1,this.editvalue=""},selSure:function(t){""!=this.editValue&&this.$dispatch("editNameSure",{isGroup:this.isGroup,editValue:this.editValue,nickInfo:t})}},events:{editNameOpen:function(t){this.editvalue=t.reMark,this.editShow=!0,this.isGroup=t.isGroup,this.isNicker=t.isNicker},editNameClose:function(){this.selCancel()},editMyNicker:function(t){this.editShow=!0,this.isNicker=!0,this.isGroup=!0,this.editvalue=t.nicker}}}),a=Vue.extend({template:"#quick_con",data:function(){return{conList:[],otherList:[{content:"1.\u5982\u4f55\u4f7f\u7528\u9ed1\u9e1f\u7ed9\u5b66\u5458\u53d1\u9001\u6559\u6750\uff1f\u70b9\u5f00\u5b66\u5458\u804a\u5929\u754c\u9762\uff0c\u53f3\u4e0a\u89d2\u4f1a\u663e\u793a\u5b66\u5458\u5f53\u5929\u9884\u7ea6\u7684\u6559\u6750\uff0c\u70b9\u51fb\u4e00\u952e\u53d1\u9001\u5373\u53ef\u3002\u76ee\u524d\u9ed1\u9e1f\u652f\u6301\u5f53\u5929\u6216\u9ed1\u9e1f\u4e0a\u663e\u793a\u9884\u7ea6\u7684\u6559\u6750\uff0c\u5982\u60f3\u53d1\u5176\u4ed6\u65e5\u671f\u4e0a\u7684\u6559\u6750\u9700\u8981\u8fdb\u5165\u5b66\u5458\u4f1a\u5458\u4e2d\u5fc3\u4e0b\u8f7d\u5355\u72ec\u53d1\u9001\u3002"},{content:"2.\u5982\u4f55\u628a\u5b66\u5458\u8bbe\u7f6e\u4e3a\u5168\u90e8\u6807\u7b7e\u91cc\u7684\u67d0\u4e00\u4e2a\u6807\u7b7e\uff0c\u5982\uff1a\u5feb\u5230\u671f\uff0c\u5df2\u8fc7\u671f\uff1f\u5168\u90e8\u6807\u7b7e\u6240\u6709\u7684\u6807\u7b7e\u90fd\u662f\u7cfb\u7edf\u5224\u65ad\u7684\uff0c\u4e0d\u80fd\u624b\u52a8\u8bbe\u7f6e\u3002\u5982\u6709\u53d1\u73b0\u540d\u5b57\u4e0b\u6709\u6b64\u7c7b\u5b66\u5458\u6ca1\u6709\u88ab\u7cfb\u7edf\u6807\u6ce8\u6b63\u786e\u6807\u7b7e\uff0c\u8bf7\u60a8\u53ca\u65f6\u53cd\u9988\u7ed9\u6211\u4eec\u3002"},{content:"3.\u5982\u4f55\u5efa\u7fa4\uff1f\u70b9\u51fb\u5de6\u4e0a\u89d2\u83dc\u5355\u6309\u94ae\uff0c\u70b9\u51fb\u53d1\u8d77\u7fa4\u804a\uff0c\u5728\u641c\u7d22\u680f\u91cc\u9009\u62e9\u4f60\u8981\u7fa4\u804a\u7684\u5bf9\u8c61\uff0c\u70b9\u51fb\u786e\u8ba4\u5373\u53ef\u3002"},{content:"4.\u5982\u4f55\u7fa4\u53d1\u4e2a\u4eba\uff1f\u70b9\u51fb\u5de6\u4e0a\u89d2\u83dc\u5355\u6309\u94ae\uff0c\u70b9\u51fb \u7fa4\u53d1\u4e2a\u4eba\uff0c\u5728\u641c\u7d22\u680f\u91cc\u9009\u62e9\u4f60\u8981\u7fa4\u53d1\u7684\u5bf9\u8c61\u548c\u56fe\u7247\uff0c\u70b9\u51fb\u786e\u8ba4\u5373\u53ef\u3002\u76ee\u524d\u7fa4\u53d1\u56fe\u7247\u548c\u6587\u5b57\u65f6\u4e0d\u80fd\u540c\u6b65\u53d1\u9001\u3002"},{content:"5.\u5982\u4f55\u7fa4\u53d1\u56fe\u7247\uff1f\u9ed1\u9e1f\u652f\u6301\u7fa4\u53d1\u56fe\u7247\u548c\u6587\u5b57\uff0c\u70b9\u51fb\u7fa4\u53d1\u6309\u94ae\uff0c\u9009\u62e9\u7fa4\u53d1\u5bf9\u8c61\uff0c\u9009\u4e2d\u7fa4\u53d1\u56fe\u7247\u5373\u53ef\u3002"},{content:"6.\u5b66\u5458\u63a8\u8350\u597d\u53cb\u7ed9\u6211\uff0c\u5982\u4f55\u67e5\u770b\u63a8\u8350\u6765\u6e90\u63a8\u8350\u4eba\u662f\u8c01\uff1f\u76ee\u524d\u9ed1\u9e1f\u65e0\u6cd5\u5b9e\u73b0\u6b64\u529f\u80fd\uff0c\u5efa\u8bae\u60a8\u95ee\u5b66\u5458\u662f\u88ab\u8c01\u63a8\u8350\u6765\u7684\uff1a\u5982\u5fae\u4fe1\u540d\u5b57\u6216\u8005\u624b\u673a\u53f7\u7b49\u3002"},{content:"7.\u5982\u679c\u4f7f\u7528\u9ed1\u9e1f\u5f80\u670b\u53cb\u5708\u5206\u4eab\u5c0f\u89c6\u9891\uff1f1\uff09\u5b89\u88c5PC\u7aef\u5fae\u4fe1\u5ba2\u6237\u7aef\uff0c\u767b\u9646\u81ea\u5df1\u7684\u5fae\u4fe1\u53f7\u30022\uff09\u4f7f\u7528\u81ea\u5df1\u5fae\u4fe1\u53d1\u89c6\u9891\u7ed9\u9ed1\u9e1f\u5de5\u4f5c\u5fae\u4fe1\u30023\uff09\u5728\u9ed1\u9e1f\u5fae\u4fe1\u6d4f\u89c8\u5668\u7aef\u70b9\u51fb\u5206\u4eab\u5230\u670b\u53cb\u5708\u3002"},{content:"8.\u5fae\u4fe1\u6389\u7ebf\u600e\u4e48\u529e\uff1f\u53ca\u65f6\u590d\u5236\u4e0b\u56fe\u4e0a\u7684\u5fae\u4fe1ID\u53d1\u5230\u9ed1\u9e1f\u5de5\u4f5c\u7fa4\u91cc\uff0c\u4ee5\u4fbf\u6280\u672f\u53ca\u65f6\u4e3a\u60a8\u89e3\u51b3\u3002\u5982\u679c\u662f\u81ea\u5df1\u4f7f\u7528\u624b\u673a\u8e22\u6389\u7ebf\u7684\uff0c\u5728\u51c6\u5907\u63d0\u6389\u7ebf\u4e4b\u524d\u8bf7\u63d0\u524d\u8bf4\u660e\u3002"}],isOther:!1,inputData:"",tagSel:{selShow:!1,selData:[],selName:""},isSearch:!1,tagList:[],labelId:""}},props:{isShow:{"default":!1},isGroup:!1},computed:{conLists:function(){return this.isOther?this.otherListCom:this.conList},otherListCom:function(){var t=$.trim(this.inputData);return""==t?this.otherList:this.highLight(t,this.otherList,!0)}},methods:{highLight:function(t,e,i){var s=[];if(0==e.length)return s;var n=new RegExp(t.split(/\s+/).join("|"),"gi");return $.map(e,function(t,e){var a=t.content;if(!(i&&a.search(n)<0)){var o=a.replace(n,function(t){return"<em>"+t+"</em>"});s.push({content:a,_content:o})}}),s},sendQuickCon:function(t){this.$dispatch("getQuickCon",t)},selShow:function(){var t=this;0!=t.tagSel.selData.length||t.tagSel.selShow?t.tagSel.selShow=!t.tagSel.selShow:wxHeck.getData({url:"/Knowledge/getCardKeyword",data:{admin_id:localInfo.admin_id},success:function(e){return 1e4!=e.status?alert(e.message):(t.tagSel.selData=e.message,void(e.message.length>0&&(t.tagSel.selShow=!0)))}})},getTag:function(t){var e=this;e.tagSel.selShow=!1,e.labelId=t.id,wxHeck.getData({url:"/Knowledge/getCardPushByKeywordId",data:{keyword_id:t.id,admin_id:localInfo.admin_id},success:function(i){return 1e4!=i.status?alert(i.message):(e.conList=i.message,e.inputData="",e.tagSel.selName=t.name,void(0!=e.conList.length&&(e.isSearch=!1)))}})},selHide:function(){this.tagSel.selShow=!1}},watch:{inputData:function(t){var e=$.trim(t),i=this;return this.isOther?void 0:""==e?i.conList=[]:void wxHeck.getData({url:"/Knowledge/getPushContent",data:{name:e,admin_id:localInfo.admin_id},success:function(t){return 1e4!=t.status?alert(t.message):(i.conList=i.highLight(e,t.message),i.tagSel.selName="",void(0!=i.conList.length&&(i.isSearch=!0)))}})}},events:{setOtherList:function(t){this.isOther=t},setTagList:function(t){t?this.tagList=t.labelList:this.tagList=[],this.labelId=""},setSelData:function(t){this.inputData=t}}}),o=Vue.extend({template:"#user_search",props:{selList:{"default":function(){return[]}},selData:{"default":function(){return{}}},localInfo:{"default":function(){return{}}}},data:function(){return{selFilter:"",showSel:!1,canHideFlag:!0}},computed:{userListFilter:function(){var t=this,e=$.trim(t.selFilter);if(""==e||0==t.selList.length)return t.showSel=!1,[];var i=[];return $.map(t.selList,function(s,n){var a=t.selData[s].userInfo;(t.isMath(a.c_remark,e)||t.isMath(a.nick,e))&&i.push(s)}),t.showSel=!0,i}},methods:{isMath:function(t,e){return t?t.toLowerCase().indexOf(e.toLowerCase())>-1:void 0},searchReturn:function(t){this.$dispatch("getSearch",t),this.selFilter="",this.showSel=!1},searchHide:function(){this.canHideFlag&&(this.showSel=!1)},cannotHide:function(){this.canHideFlag=!1},canHide:function(){this.canHideFlag=!0}},ready:function(){$(".user_search_result").wxScroll()}}),c=Vue.extend({template:"#user_type",props:["selLabels","listType"],methods:{setType:function(t){t!=this.type&&(this.type=t,this.$dispatch("setListType",t))}}}),u=Vue.extend({template:"#user_types",data:function(){return{type:"",show:!1}},props:["localInfo"],methods:{setType:function(t){this.type=t,this.$dispatch("setListType",t),this.show=!1},showFn:function(){this.show=!this.show,this.show&&this.$nextTick(function(){$(".wx_sel").wxScroll()})},hideFn:function(){this.show=!1}},computed:{showType:function(){var t=this.type;return""==t?"\u5168\u90e8":"todayFocus"==t?"\u4eca\u65e5\u5173\u6ce8":t}}}),d=Vue.extend({template:"#info_update",data:function(){return{updateShow:!1}},props:["localInfo","nickName","userGroup","deviceId","rankList"],methods:{updateHide:function(){this.updateShow=!1,this.nickName=this.localInfo.nick_name,this.userGroup=this.localInfo.user_group,this.deviceId=this.localInfo.device_id,this.rankList=this.localInfo.rank_list},updateInfoFn:function(){var t=this;if(t.canUpdate){var e={admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id,user_group:t.userGroup,nick_name:$.trim(t.nickName),device_id:$.trim(t.deviceId),rank_list:$.trim(t.rankList).replace(/\uff0c/g,",")};wxHeck.getData({url:"/AdminContact/updateAdminWechatContact",data:e,success:function(i){return 1e4!=i.status?alert(i.message):(t.$dispatch("infoUpdateCb",e),void alert("\u66f4\u65b0\u6210\u529f"))}})}}},computed:{canUpdate:function(){return""!=$.trim(this.nickName)&&!!this.userGroup&&""!=$.trim(this.deviceId)},initShow:function(){return!this.localInfo.nick_name||!this.localInfo.user_group||!this.localInfo.device_id}},events:{showUpdate:function(){this.updateShow=!0},hideUpdate:function(){this.updateHide()}}}),l=Vue.extend({template:"#errors_tip",data:function(){return{errors:{netErr:!1,phoneErr:!1},iscc:!1,isss:!1,errDetail:!1,ttt:20,bTime:20,isErrored:!1,mt:null,wechatId:localInfo.wechat_id,crm:localInfo.id,resetError:{show:!1,time:20,timeRemark:20,mt:null,send:!1},showLast:!1,isKickOff:!1}},methods:{sendStatus:function(t){wxHeck.getData({url:"/AdminMonitor/addAdminMonitorLog",data:{wechat_id:localInfo.wechat_id,status:t},error:function(){}})},reload:function(){window.location.reload()},resetErr:function(){if(!this.resetError.send&&!this.resetError.show){var t=this;clearInterval(this.resetError.mt);var e=this.isKickOff?"/Reboot/setReboot":"/AdminContact/killWechat";wxHeck.getData({beforeSend:function(){t.resetError.send=!0},url:e,data:{wechat_id:localInfo.wechat_id},timeout:5e3,success:function(e){return 1e4!=e.status?void _alert(e.message,function(){t.resetErrClear(),t.showLast=!0}):void t.resetErrSuccess()},complete:function(){t.resetError.send=!1},error:function(){_alert("\u64cd\u4f5c\u5931\u8d25",function(){t.resetErrClear(),t.showLast=!0})}})}},resetErrSuccess:function(){this.resetError.show=!0,this.resetError.mt=setInterval(function(){this.resetError.time>1?this.resetError.time--:(this.resetErrClear(),this.showLast=!0)}.bind(this),1e3)},resetErrClear:function(){clearInterval(this.resetError.mt),this.errDetail=!1,this.isKickOff=!1,this.resetError.time=this.resetError.timeRemark,this.resetError.show=!1}},props:{deviceId:{"default":""}},computed:{errorsTipShow:function(){var t=this.errors;for(var e in t)if(t[e])return!0;return!1}},events:{setErrors:function(t){var e=this,i=this.errors;for(var s in t)s in i&&(i[s]=t[s]);this.iscc=t.iscc,this.isss=t.isss;var n=i.netErr||i.phoneErr;return n?wxHeck.flashTitleFn.set("\u9ed1\u9e1f\u5df2\u6389\u7ebf\uff01"):wxHeck.flashTitleFn.reset(function(){wxHeck.wxInit.noReadAll>0&&wxHeck.flashTitleFn.set("\u60a8\u6709\u65b0\u7684\u6d88\u606f\uff01")}),i.netErr?(clearInterval(e.mt),e.bTime=e.ttt,e.errDetail=!1,void(e.iscc=e.isss=!1)):(clearInterval(e.mt),void(i.phoneErr?(this.isErrored=!0,e.sendStatus(1),e.mt=setInterval(function(){e.bTime>1?e.bTime--:(e.sendStatus(3),clearInterval(e.mt),wxHeck.getData({url:"/Reboot/getKickOutStatus",data:{wechat_id:localInfo.wechat_id},success:function(t){e.isKickOff=1e4==t.status,e.bTime=e.ttt,e.errDetail=!0,e.iscc=e.isss=!1},error:function(){e.bTime=e.ttt,e.errDetail=!0,e.iscc=e.isss=!1}}))},1e3)):this.isErrored&&(console.log("\u624b\u673a\u4e0a\u7ebf"),e.bTime!=e.ttt&&e.sendStatus(2),clearInterval(e.mt),e.bTime=e.ttt,e.errDetail=!1,e.iscc=e.isss=!1,this.errDetail=!1,this.showLast=!1,this.resetErrClear())))}}}),h=Vue.extend({template:"#add_friend",data:function(){return{toNext:!1,addFriendShow:!1,wxAcc:"",wxDes:"",type:"0",wechat_img:"",wechat_nick:"",remark:"",crmId:"",crmMobile:"",addType:"",trialStatus:"",longStrTip:!1}},props:["localInfo"],methods:{addFriendHide:function(){this.crmId="",this.crmMobile="",this.remark="",this.wechat_nick="",this.wechat_img="",this.type="0",this.wxDes="",this.wxAcc="",this.addType="",this.trialStatus="",this.addFriendShow=!1,this.toNext=!1},addFriendNext:function(){if(this._wxAcc){if(this.addType)return void this.$dispatch("addFriendNextCb",{keyword:this._wxAcc,trialStatus:this.trialStatus});var t=/^1[3|4|5|7|8][0-9]{9}$/;if(t.test(this._wxAcc)){var e=this;wxHeck.getData({url:"/UserContact/searchUserInfo",data:{user_num:e._wxAcc},success:function(t){t.message.id?(e.crmId=t.message.id,e.crmMobile=t.message.mobile,e.trialStatus=t.message.trialStatus||"",e.$dispatch("addFriendNextCb",{keyword:e._wxAcc,crmId:e.crmId,trialStatus:e.trialStatus})):e.$dispatch("addFriendNextCb",{keyword:e._wxAcc}),console.log("\u72b6\u6001\u662f\uff1a"+e.trialStatus)}})}else this.$dispatch("addFriendNextCb",{keyword:this._wxAcc})}},addFriendFn:function(){var t=this;t.canUpdate&&wxHeck.getData({url:"/UserContact/remindCount",data:{admin_id:localInfo.id},success:function(e){return 1e4!=e.status?_alert(e.message):void _confirm(e.message,function(){t.$dispatch("addFriendCb",{wxid:t.wxAcc,verify_msg:t._wxDes,type:t.type,user_id:t.crmId,mobile:t.crmMobile,remark:t.remark})})},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")}})}},computed:{_wxAcc:function(){return $.trim(this.wxAcc)},_wxDes:function(){return $.trim(this.wxDes)},_wxDesLen:function(){var t=this._wxDes;return t.length>50?this.longStrTip=!0:this.longStrTip=!1,t.length},canUpdate:function(){return""!=this._wxAcc&&""!=this._wxDes&&this._wxDesLen<=50}},events:{showAddFriend:function(t){if(console.log(t),1==t.type?this.wxAcc=t.wxAcc:this.wxAcc=t.acc||"","fromMyStudy"==t.addType)switch(t.trialStatus){case 1:this.trialStatus="end";break;case 2:this.trialStatus="on";break;case 3:this.trialStatus="non";break;case 4:this.trialStatus="cancel";break;default:this.trialStatus="noData"}this.type=t.type,this.wxDes=wxHeck.checkUserType(localInfo.nick_name,this.trialStatus),console.log("a",localInfo.nick_name,this.trialStatus),this.crmId=t.crmId||"",this.crmMobile=t.crmMobile||"",this.addType=t.addType||"",this.addFriendShow=!0},addFriendToNext:function(t){var e=this,i=/^1[3|4|5|7|8][0-9]{9}$/,s=[];!function(){e.crmId&&s.push(e.crmId),s.push(t.wechat_nick),e.crmMobile?s.push(e.crmMobile):i.test(e._wxAcc)&&s.push(e._wxAcc)}(),this.wechat_img=t.wechat_img,this.wechat_nick=t.wechat_nick,this.remark=s.join("-"),this.wxDes=wxHeck.checkUserType(localInfo.nick_name,this.trialStatus),console.log("b",localInfo.nick_name,this.trialStatus),this.toNext=!0},addFriendGoNext:function(t){this.wechat_img=t.wechat_img,this.wechat_nick=t.wechat_nick,this.toNext=!0,this.wxAcc=t.wxid.split("$")[1],this.wxDes=wxHeck.checkUserType(localInfo.nick_name,this.trialStatus),this.addFriendShow=!0,console.log("c",localInfo.nick_name,this.trialStatus)},hideAddFriend:function(){this.addFriendHide()}}}),w=Vue.extend({template:"#send_paste",data:function(){return{sendPasteShow:!1,imgSrc:"",sureDisable:!1}},methods:{hide:function(){this.sendPasteShow=!1,this.imgSrc="",this.sureDisable=!1},send:function(){this.sureDisable=!0,this.$dispatch("getSendPaste",{imgSrc:this.imgSrc})}},events:{openSendPaste:function(t){this.sendPasteShow=!0,this.imgSrc=t.imgSrc},enableSendPaste:function(){this.sureDisable=!1},hideSendPaste:function(){this.hide()}}}),f=Vue.extend({template:"#send_face",data:function(){return{show:!1,curType:0,faceData:[{type:0,des:"\u9ed8\u8ba4\u8868\u60c5",data:wxHeck.Util.qqfaceConfigArr}]}},methods:{changType:function(t){this.curType!=t&&(this.curType=t)},sendFace:function(t,e){this.$dispatch("getFace",{type:t,con:e})},sendFaceShow:function(){this.show=!this.show},sendFaceHide:function(){this.show=!1}}}),m=Vue.extend({template:"#send_img"}),p=Vue.extend({template:"#send_article",data:function(){return{isLoading:!0,articleListShow:!1,navlist:{},articleListData:[],curArticleIndex:null,articlePageCount:0,articleCurrentPage:null,searchKey:""}},methods:{show:function(){this.articleListShow=!0,this.articleListData.length>0||(this.getArticle("1"),this.$nextTick(function(){$(".con-show").niceScroll({autohidemode:!1,cursorcolor:"#686b71",cursoropacitymin:.7,cursoropacitymax:.7,railpadding:{top:10,right:0,left:0,bottom:10}})}))},getArticle:function(t){if(this.searchKey="",t!=this.articleCurrentPage){var e=this;wxHeck.getData({url:"/Article/getArctype",success:function(t){return 1e4!=t.status?_alert(t.message):void(e.navlist=t.message)}}),wxHeck.getData({url:"/Article/chatList",beforeSend:function(){},data:{page:1,aid:t},success:function(i){return 1e4!=i.status?_alert(i.message):(e.articleListData=i.message.list,e.articlePageCount=i.message.pageCount,e.articleCurrentPage=t,void(e.curArticleIndex=null))},complete:function(){e.isLoading=!1}})}},searchArticle:function(){var t=this;wxHeck.getData({url:"/Article/search",beforeSend:function(){},data:{aid:t.articleCurrentPage,keyword:t.searchKey},success:function(e){1e4!=e.status&&wxHeck.getData({url:"/Article/chatList",beforeSend:function(){},data:{page:1,aid:t.articleCurrentPage},success:function(e){t.articleListData=e.message.list,t.curArticleIndex=null},complete:function(){t.isLoading=!1}}),t.articleListData=e.message.list,t.articlePageCount=e.message.pageCount,t.curArticleIndex=null},complete:function(){t.isLoading=!1}})},hide:function(){this.articleListShow=!1,this.curArticleIndex=null,this.articleCurrentPage=null,this.articleListData=[],this.searchKey=""},cutAticle:function(t){this.curArticleIndex=t,this.articleListShow=!0},sendArticleParent:function(t){var e=JSON.stringify({title:t.title,introduction:t.desc,icon:t.thumbUrl,link:t.urlStr,id:localInfo.admin_id,forward_text:t.forwardText}),i={action:"chat",id:localInfo.id,to_id:wxHeck.wxInit.wxData.curUserId,type:"web",cnt_type:3e3,content:e};wxHeck.wxInit.sendGroupChat(i,!0)},sendArticle:function(){var t=JSON.stringify({title:this.articleListData[this.curArticleIndex].title,introduction:this.articleListData[this.curArticleIndex].introduction,icon:this.articleListData[this.curArticleIndex].icon,link:this.articleListData[this.curArticleIndex].link,id:this.articleListData[this.curArticleIndex].id}),e={action:"chat",id:localInfo.id,to_id:wxHeck.wxInit.wxData.curUserId,type:"web",cnt_type:3e3,content:t};if(wxHeck.wxInit.setGroupChat.flag){var i=this.$root;i.temShareMsg={desc:this.articleListData[this.curArticleIndex].introduction,thumbUrl:this.articleListData[this.curArticleIndex].icon,title:this.articleListData[this.curArticleIndex].title,urlStr:this.articleListData[this.curArticleIndex].link},i.parentSend=!0}else wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:t,cnt_type:3e3,time:(new Date).getTime()}),wxHeck.sendMsg(e);this.curArticleIndex=null,this.articleCurrentPage=null,this.articleListData=[],this.articleListShow=!1,wxHeck.getData({url:"/OperationLog/addOperationLog",data:{operation_type:7},success:function(t){},error:function(t){}})}},filters:{filterKey:function(t){var e=new RegExp(this.searchKey,"g");return t.replace(e,"<span>"+this.searchKey+"</span>")}},watch:{searchKey:function(t){var e=$.trim(t),i=this;""==e&&wxHeck.getData({url:"/Article/search",beforeSend:function(){},data:{aid:i.articleCurrentPage,keyword:i.searchKey},success:function(t){1e4!=t.status&&wxHeck.getData({url:"/Article/chatList",beforeSend:function(){},data:{page:1,aid:i.articleCurrentPage},success:function(t){i.articleListData=t.message.list,i.curArticleIndex=null},complete:function(){i.isLoading=!1}}),i.articleListData=t.message.list,i.articlePageCount=t.message.pageCount,i.curArticleIndex=null},complete:function(){i.isLoading=!1}})}},events:{shareMsg:function(t){this.sendArticleParent(t.msg)}}}),g=Vue.extend({template:"#send_file"}),x=Vue.extend({template:"#send_voice",data:function(){return{creat:!1,show:!0,isStep2:!1,isOver:!1,time:0,timeLimit:60,audioName:"voice",recorderOpen:!1,mt:null,pending:!1}},methods:{open:function(){this.creat=!0,this.show=!0},close1:function(){this.show=!1},start:function(){FWRecorder.record(this.audioName,"audio.wav")},close2:function(){this.clear(),this.show=!1},clear:function(){this.stopRecording(),this.time=0,this.isStep2=!1,this.isOver=!1},stopRecording:function(){FWRecorder.stopRecording(this.audioName),clearInterval(this.mt)},startRecord:function(){this.isStep2=!0,clearInterval(this.mt),this.mt=window.setInterval(function(){this.time<this.timeLimit?this.time=Math.ceil(FWRecorder.duration(this.audioName)):(this.stopRecording(),this.isOver=!0)}.bind(this),1e3)},end:function(){var t=this;t.pending=!0,t.stopRecording(),window.setTimeout(function(){wxHeck.getData({url:"/UploadFile/uploadRecorder",type:"post",
dataType:"json",data:{file_base64:FWRecorder.getBase64(t.audioName)},success:function(e){return 1e4!=e.status?void _alert(e.message,function(){t.pending=!1}):(t.sendVoiceFn(e.message),t.close2(),void(t.pending=!1))},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01",function(){t.pending=!1})}})},0)},sendVoiceFn:function(t){wxHeck.pushMsg({pushId:wxHeck.wxInit.wxData.curUserId,isCC:!0,msg:t,time:(new Date).getTime(),cnt_type:2})}}}),_=Vue.extend({template:"#chat_tools",components:{sendImg:m,sendFace:f,sendArticle:p,sendFile:g,sendVoice:x}}),k=Vue.extend({template:"#update_wechat",data:function(){return{waiting:!0}},props:["clientVersion","cloudVersion"],computed:{updataShow:function(){return parseInt(this.clientVersion)<parseInt(this.cloudVersion)}},methods:{onUpdate:function(){wxHeck.sendMsg({action:"get_version",id:localInfo.id,type:"web"}),setTimeout(function(){location.reload()},3e4),this.waiting=!1}}}),I=Vue.extend({template:"#logout",data:function(){return{logoutShow:!1,selSelect:"",selFilter:""}},props:{selList:{"default":function(){return[]}},selData:{"default":function(){return{}}}},computed:{selLists:function(){var t=this,e=$.trim(t.selFilter);if(""==e||0==t.selList.length)return t.selList;var i=[];return $.map(t.selList,function(s,n){var a=t.selData[s].userInfo,o=(a.c_remark||a.nick).indexOf(e)>-1;o&&i.push(s)}),i}},methods:{userLogout:function(){window.confirm("\u786e\u8ba4\u9000\u51fa\uff1f")&&wxHeck.Util.closeTab()},selHide:function(){this.logoutShow=!1,this.selFilter="",this.selSelect=""},selUser:function(t){t==this.selSelect?this.selSelect="":this.selSelect=t},selOpen:function(t){var e=this,i=t+"";!function(){if(""!=t){var s=$.inArray(i,e.selList);-1!=s&&(e.selList.splice(s,1),e.selList.unshift(i),e.selSelect=i)}}(),this.logoutShow=!0,this.$nextTick(function(){$(".sel_list").each(function(t,e){$(e).wxScroll()})})},userLogoutTrust:function(){""!=this.selSelect&&this.$dispatch("userLogoutTrust",this.selSelect)}},events:{logoutShowFn:function(t){this.selOpen(t)}}}),y=Vue.extend({template:"#fn_tab",data:function(){return{show:!1,pos:{left:0,top:0},sendData:""}},methods:{hide:function(){this.show=!1},sendSelData:function(){this.$dispatch("getSelData",this.sendData),this.hide()},open:function(t){this.pos.left=t.pos.left+"px",this.pos.top=t.pos.top-35+"px",this.sendData=t.sendSelData,this.show=!0,this.$nextTick(function(){document.querySelector(".fn_tab").focus()})}},events:{openFnTab:function(t){this.open(t)},closeFnTab:function(){this.hide()}}}),v=Vue.extend({template:"#crm_remark",data:function(){return{remarks:[],isshow:!1,inputData:"",userId:"",showTip:!1,selTime:"",selYear:"2017",selMonth:"1",selDay:"1",demo:!1}},computed:{_inputData:function(){return $.trim(this.inputData)}},methods:{hide:function(){this.isshow=!1,this.remarks=[],this.inputData="",this.userId="",this.showTip=!1},show:function(){this.isshow=!0,this.$nextTick(function(){$(".add-info-scroll").wxScroll()})},addRemark:function(){this.demo?this.selTime=this.selYear+"-"+this.selMonth+"-"+this.selDay:this.selTime="";var t=this;""!=t._inputData&&wxHeck.getData({url:"/Remark/addNew",data:{user_id:t.userId,content:t._inputData,follow_date:t.selTime},success:function(e){return 1e4!=e.status?alert(e.message):(t.inputData="",t.showTip=!0,clearTimeout(t.tm),void(t.tm=setTimeout(function(){t.showTip=!1},1500)))}})},addRemarkTime:function(){this.demo=!this.demo}},events:{crmRemarkOpen:function(t){var e=new Date;this.selYear=e.getFullYear(),this.selMonth=e.getMonth()+1,this.selDay=e.getDate()+1;var i=this;i.userId=t.user_id,wxHeck.getData({url:"/Remark/list",data:{user_id:i.userId},success:function(t){i.remarks=t.message.reverse()}}),i.show()}}}),H=Vue.extend({template:"#quick_tab",data:function(){return{show:!1,pos:{left:0,top:0},name:"",from_id:"",mem_id:"",groupUserInfo:{groupUserWechat_id:"",groupUserWechat_nick:""},showChatList:!1,chatListDetail:[],voicePlay2:{voiceSrc2:"",playVoiceSrc2:""},contentType:{types:["0","1","2","9999","42","3000","3001","3100","4000","5000","495","4950","6000","6001","10000"]},delShow:{show:!1},videoUrl:""}},methods:{atUser:function(){var t=this.mem_id.split("$");return""==t[1]?void _alert("\u975e\u6cd5@"):t[0]==t[1]?void _alert("\u4e0d\u80fd@\u81ea\u5df1"):(this.$dispatch("getAt",this.name,this.mem_id),void(this.show=!1))},privateChat:function(){console.log("++++"+this.mem_id),console.log("----"+this.groupUserInfo.groupUserWechat_id);var t=this.mem_id.split("$");return""==t[1]?void _alert("\u4e0d\u80fd\u79c1\u804a\uff01"):t[0]==t[1]?void _alert("\u4e0d\u80fd\u79c1\u804a\u81ea\u5df1"):(this.$dispatch("oneChat",this.mem_id),this.show=!1,void console.log("\u79c1\u804a:"+this.mem_id))},getChatList:function(){var t=this;return t.mem_id.split("$")[1]?void wxHeck.getData({url:"/WechatMessage/getChatSelfMessage",data:{wechatId:t.from_id,ccId:localInfo.id,mem_id:t.mem_id.split("$")[1]},success:function(e){if(t.show=!1,1e4!=e.status)return alert(e.message);for(var i=0;i<e.message.length;i++)(495==e.message[i].cnt_type||4950==e.message[i].cnt_type||6e3==e.message[i].cnt_type||6001==e.message[i].cnt_type)&&(e.message[i].content=JSON.parse(e.message[i].content));t.chatListDetail=e.message,t.showChatList=!0,t.$nextTick(function(){$(".chat-content").wxScroll()})}}):_alert("\u5bf9\u4e0d\u8d77\uff0c\u5f53\u524d\u8bb0\u5f55\u6682\u4e0d\u80fd\u67e5\u8be2")},delCutUser:function(){this.$dispatch("groupListUserDelete",this.groupUserInfo),console.log(this.groupUserInfo),this.show=!1},closeChatDetail:function(){this.showChatList=!1},hide:function(){this.show=!1,this.mem_id=""},playVoice2:function(t){this.voicePlay2.voiceSrc2=t,this.$nextTick(function(){voiceMsgPlayer2.play()})},isPlaying:function(){this.voicePlay2.playVoiceSrc2=this.voicePlay2.voiceSrc},isEnded:function(){this.voicePlay2.playVoiceSrc2=""}},events:{openQuickTab:function(t){console.log(t),this.from_id=t.from_id||t.curtId,console.log(this.from_id),this.mem_id=t.mem_id,this.name=t.name,this.pos.left=t.event.x+"px",this.pos.top=t.event.y+"px",this.show=!0,this.$nextTick(function(){$(".quick_tab")[0].focus()}),this.groupUserInfo.groupUserWechat_id=t.wechat_id,this.groupUserInfo.groupUserWechat_nick=t.wechat_nick},showDelBtn:function(t){this.delShow.show=t},delGroupListUser:function(t){if(1e4==t.status){var e=wxHeck.dataSource.groupUserLists[t.from_id];console.log(e);for(var i=this.groupUserInfo.groupUserWechat_id,s=0;s<e.length;s++)e[s].wechat_id==i&&e.splice(s,1);_alert("\u5220\u9664\u6210\u529f")}else _alert(t.message)}},filters:{paser:function(t,e){this.$data.chatListDetail[e].content=JSON.parse(t)},artile:function(t,e,i){return"string"==typeof e?JSON.parse(e)[i]:void 0}}}),S=Vue.extend({template:"#page",data:function(){return{current:1,showItem:6,allpage:1}},computed:{pages:function(){var t=[];if(this.current<this.showItem)for(var e=Math.min(this.showItem,this.allpage);e;)t.unshift(e--);else{var i=this.current-Math.floor(this.showItem/2),e=this.showItem;for(i>this.allpage-this.showItem&&(i=this.allpage-this.showItem+1);e--;)t.push(i++)}return t}},methods:{"goto":function(t){this.current=t,this.$dispatch("goPage",t)}},events:{changePage:function(t){this.allpage=t.pageCount,this.current=t.pageCurrent}}}),b=Vue.extend({template:"#myStudyLayer",data:function(){return{startTime:"",endTime:"",show:!1,friends:[],uids:[],user_info:"",studyList:[],curStudyList:[],detailPage:2,countPage:null,cutPage:1,hasStudy:!1,cc:!1,ss:!1,cutBtn:{appoint_status:1,date_type:0,appoint_time:""},cutSelUserList:[],addStatus:{isSelUserId:"",unfind:!1,adding:!1}}},components:{page:S},methods:{selUser:function(t){this.addStatus.isSelUserId=t},selStudyList:function(){var t=this;wxHeck.getData({url:"/UserContact/remindCount",data:{admin_id:localInfo.id},success:function(e){return 1e4!=e.status?_alert(e.message):void _confirm(e.message,function(){_confirm("\u6279\u91cf\u6dfb\u52a0\u4e86"+t.cutSelUserList.length+"\u4eba\u8017\u65f6\u5728"+t.cutSelUserList.length+"\u5206\u949f\u5de6\u53f3\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85",function(){wxHeck.getData({url:"/MassAddUserWechat/addCrmUser",data:{admin_id:localInfo.admin_id,user_id:t.cutSelUserList},success:function(t){return 1e4!=t.status?_alert(t.message):void _alert(t.message)}}),t.$dispatch("reGetMyStudy"),t.cutSelUserList=[]})})},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")}})},hideMyStudy:function(){this.show=!1,this.cutBtn.appoint_status=1,this.cutSelUserList=[],this.curStudyList=[],this.hasStudy=!1},addChat:function(t){this.$dispatch("studyChat",this.user_info+"$"+t),this.show=!1},goAddFriend:function(t,e,i,s){var n=this;_confirm("\u63d0\u524d\u7535\u8bdd\u6c9f\u901a\uff0c\u5e76\u544a\u8bc9\u5b66\u5458\u4f1a\u52a0\u5979\u597d\u53cb\u4f1a\u6781\u5927\u63d0\u9ad8\u52a0\u597d\u53cb\u7684\u901a\u8fc7\u7387\uff0c\u8bf7\u786e\u8ba4\u5df2\u4e0e\u5b66\u5458\u8fdb\u884c\u8fc7\u7535\u8bdd\u6c9f\u901a\u3002",function(){n.$dispatch("addListFriend",t,e,i,s)})},crmRemarkTable:function(t){this.$dispatch("crmRemarkTableOpen",t)},telphone:function(t,e){this.$dispatch("callTelpnone",t,e)},studyChat:function(t){this.show=!1,this.$dispatch("studyChat",t)},changePage:function(t){var e=this;setTimeout(function(){e.$broadcast("changePage",t)},0)},checkType:function(t){var e="",i=this;if(wxHeck.isSS()){i.cutBtn.appoint_status=1,e="/UserContact/getCrmUser";var s={start_time:studyStartTime.value,end_time:studyEndTime.value,page_num:1,page_size:10,appoint_status:1}}if(wxHeck.isCC()){switch(t){case"classA":i.cutBtn.appoint_status=1;break;case"classB":i.cutBtn.appoint_status=2;break;case"classC":i.cutBtn.appoint_status=3;break;case"classD":i.cutBtn.appoint_status=4;break;default:i.cutBtn.appoint_status=1}e="/UserContact/getCrmUserByCc";var n=new Date(studyEndTime.value).getTime()+1728e5,a=new Date(n),o=a.getMonth()+1>9?a.getMonth()+1:"0"+(a.getMonth()+1),r=a.getDate()>9?a.getDate():"0"+a.getDate(),c=a.getFullYear()+"-"+o+"-"+r,s={start_time:studyStartTime.value,end_time:c,page_num:1,page_size:10,appoint_status:i.cutBtn.appoint_status}}wxHeck.getData({url:e,data:s,success:function(t){return 1e4!=t.status?_alert(t.message):void(0==t.message.list.length?(i.curStudyList=[],i.hasStudy=!1):(i.curStudyList=t.message.list,i.hasStudy=!0,setTimeout(function(){i.$broadcast("changePage",t.message.pagenation)},0)))}})}},events:{studySearch:function(){this.checkType()},goPage:function(t){this.cutPage=t;var e=this,i="",s={start_time:studyStartTime.value,end_time:studyEndTime.value,page_num:t,page_size:10,appoint_status:e.cutBtn.appoint_status};wxHeck.isSS()&&(i="/UserContact/getCrmUser"),wxHeck.isCC()&&(i="/UserContact/getCrmUserByCc",s.appoint_id=e.appoint_status),wxHeck.getData({url:i,data:s,success:function(t){return 1e4!=t.status?_alert(t.message):void(e.curStudyList=t.message.list)}})},showMyStudyLayer:function(t){this.user_info=t.user_info,this.startTime=t.myStudyData.date.startTime,this.endTime=wxHeck.Util.setDate(0),0!=t.myStudyData.list.length&&(this.hasStudy=!0,this.curStudyList=t.myStudyData.list,this.pageCount=t.myStudyData.pagenation.pageCount,this.pageSize=t.myStudyData.pagenation.pageSize,this.pageCurrent=t.myStudyData.pagenation.pageCurrent,this.changePage(t.myStudyData.pagenation)),this.show=!0},setTimePast:function(t){this.startTime=t},setTimeNow:function(t){this.endTime=t},setStudyTypeBoolean:function(t){this.cc=t.cc,this.ss=t.ss}},watch:{cutPage:function(t){var e=this.detailPage*(this.cutPage-1),i=this.detailPage*this.cutPage;this.curStudyList=this.studyList.slice(e,i)}},filters:{m_d_h_m:function(t){return t.substring(6,16)},h_m:function(t){return t.substring(11,16)}}}),D=Vue.extend({template:"#myFriend",data:function(){return{isShow:!1,list:[],pending:!0}},methods:{hide:function(){this.isShow=!1,this.list=[],this.pending=!0},show:function(){this.isShow=!0,this.$nextTick(function(){$(".friend-box-in").wxScroll()})},accept:function(t){wxHeck.sendMsg({action:"add_hello_friend",id:localInfo.id,type:"web",encryptusername:t})}},events:{myFriendShow:function(){this.show()},myFriendData:function(t){this.list=t,this.pending=!1},myFriendSure:function(t){var e=this,i=e.list;$.map(i,function(e,s){return e.encryptusername==t?(i[s].encryptusername="",!1):void 0})}}}),L=Vue.extend({template:"#homeWork",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",groupId:"",editKey:"",edit$Key:"",groupData:{},groupheader:"",scoreShow:!1,score:"",imgSrc:"",scoreAudioShow:!1,audioText:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},cur$key:"",comText:"",editType:{1:"Img",2:"Audio",6001:"Video"},isReEdit:!1,mt:null}},methods:{editGo:function(t){var e,i=$(".home-work-list-in>ul>li .todo"),s=i.length;switch(i.each(function(t,i){var s=$(i);return s.hasClass("cur-edit")?(e=t+1,!1):void 0}),this.scoreAudioHide(),t){case"l":1==e?e=s:e--;break;case"r":e==s?e=1:e++}this.$nextTick(function(){i.eq(e-1).click()})},getJson:function(t){var e;try{e=JSON.parse(t)}catch(i){e=""}return e},playVoice:function(t){this.voicePlay.voiceSrc=t,this.$nextTick(function(){voiceMsgPlayer3.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},shList:function(t,e,i){this.list[e][i].showTool=0==t},editList:function(t,e,i){this.cur$key=e,this["edit"+this.editType[i]].apply(null,arguments),this.editKey=t,this.edit$Key=e},editImg:function(t,e,i){var n=wxHeck.getImgUrl(this.list[t][e].content.split(",")[1]||this.list[t][e].content),a=this.groupData[t],o=(a.wechat_img,a.wechat_nick),r=1==this.list[t][e].status,c=this;s.initNew({source:n,isEdit:r,nickName:o,save:function(t,e){return e?_alert("\u64cd\u4f5c\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"):void c.$emit("sendHomeWorkResult",t)}})},editAudio:function(t,e,i){this.scoreAudioShow=!0,this.editKey=t,this.edit$Key=e,this.isReEdit=1==this.list[t][e].status},scoreAudioHide:function(){this.scoreAudioShow=!1,this.audioText="",this.isReEdit=!1},editVideo:function(t,e,i){this.scoreAudioShow=!0,this.editKey=t,this.edit$Key=e,this.isReEdit=1==this.list[t][e].status},hideReEdit:function(){this.isReEdit=!1},delList:function(t,e){var i=this;confirm("\u786e\u8ba4\u5220\u9664\uff1f")&&wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:{wechat_id:i.groupId,message_id:e,status:1},success:function(s){return 1e4!=s.status?alert(s.message):(Vue["delete"](i.list[t],e),void i.list[t].length--)}})},checkListAudio:function(){var t=this;if(""!=t._audioText){var e={wechat_id:t.groupId,message_id:t.edit$Key,status:2,u_wechat_id:t.editKey,text:t._audioText};t.$parent.loading.show=!0,t.$dispatch("getAt",t.groupData[t.editKey].wechat_nick,t.editKey,e.text),t.$parent.sendMsg(),wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:e,success:function(e){return 1e4!=e.status?alert(e.message):(t.list[t.editKey][t.edit$Key].status="1",_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),void(t.$parent.loading.show=!1))}})}},checkList:function(t){var e=this,i={wechat_id:e.groupId,message_id:e.edit$Key,status:2,score:t.score,u_wechat_id:t.u_wechat_id,correct_img:t.correct_img,text:t.text};wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:i,success:function(t){return 1e4!=t.status?alert(t.message):void(e.list[e.editKey][e.edit$Key].status="1")}})},hide:function(){this.isShow=!1,this.list=[],this.groupId="",this.pending=!0,this.editKey="",this.edit$Key="",this.groupheader="",this.groupData={},this.cur$key="",this.scoreShow=!1},getDate:function(){var t=new Date,e=function(t){var e=t+"";return e.length<2?"0"+e:e};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},getHomeWork:function(){var t=this;wxHeck.getData({url:"/WorkCorrect/ajaxGetChatRoomMessage",data:{wechat_id:t.groupId,start_time:_startTime.value||"",end_time:_endTime.value||""},success:function(e){if(1e4!=e.status)return alert(e.message);var i=function(t){if(t){var e=t.split("$");return e[0]==e[1]}};if(""==e.message||e.message==[]){var s={};s.length=0;for(var n in t.groupData)i(n)||(s[n]={length:0},s.length++);return void(t.list=s)}t.list=function(e){for(var s in e)if(!i(s)){e[s].length=0;for(var n in e[s])"length"!=n&&(e[s][n].showTool=!1,e[s].length++)}for(var s in t.groupData)s in e||i(s)||(e[s]={length:0});return e}(e.message)},complete:function(){t.pending=!1}})},homeWorkTip:function(t){if(wxHeck.isMyFriend(t)){var e="\u5c0f\u670b\u53cb\u6293\u7d27\u65f6\u95f4\u4ea4\u4f5c\u4e1a\u54e6\uff0c\u6bcf\u5929\u7684\u575a\u6301\u90fd\u662f\u5f88\u91cd\u8981\u7684\u5462\uff01";this.$parent.sendMsg(null,!0,t,e),_alert("\u53d1\u9001\u63d0\u9192\u6210\u529f\uff01")}else _confirm("\u548c\u5b66\u5458\u8fd8\u4e0d\u662f\u597d\u53cb\u5173\u7cfb\uff0c\u662f\u5426\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb\uff1f\u5982\u5b66\u5458\u672a\u53ca\u65f6\u901a\u8fc7\u597d\u53cb\u8bf7\u6c42\uff0c\u5efa\u8bae\u7535\u8bdd\u6c9f\u901a~",function(){this.$root.$broadcast("showAddFriend",{wxAcc:t.split("$")[1],type:"1"})}.bind(this))},sendScore:function(t){var e=this;if(""!=e._score||t){var i=this.$parent,s=this.imgSrc,n=e._score,a=e.comText,o=e.editKey;this.hideScore(),wxHeck.getData({beforeSend:function(){i.loading.show=!0},url:"/UploadFile/screenImg",data:{file_base64:s,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(t){if(1e4==t.status){var r=(new Date).getTime();window.testURL&&(t.message=window.testURL);var c={action:"chat",id:localInfo.id,type:"web",to_id:i.wxData.curUserId,to_type:"ios",content:t.message,cnt_type:1,content_id:String(r)};e.setSuccessFn=function(){clearTimeout(e.mt),wxHeck.pushMsg({pushId:i.wxData.curUserId,isCC:!0,msg:[s,t.message],time:r,cnt_type:9999}),e.$dispatch("getAt",e.groupData[e.editKey].wechat_nick,e.editKey),i.sendMsg(),e.checkList({score:n,correct_img:t.message,u_wechat_id:o,text:a}),_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),i.loading.show=!1},wxHeck.sendMsg(c),clearTimeout(e.mt),e.mt=setTimeout(e.setFailFn,1e4)}else _alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),i.loading.show=!1},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),i.loading.show=!1}})}},hideScore:function(){this.scoreShow=!1,this.imgSrc="",this.score="",this.comText=""},setSuccessFn:function(){},setFailFn:function(t){clearTimeout(this.mt),this.setSuccessFn=function(){},_alert(t||"\u53d1\u9001\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),this.$parent.loading.show=!1}},computed:{_score:function(){return $.trim(this.score)},_audioText:function(){return $.trim(this.audioText)}},events:{hwSetSuccess:function(){this.setSuccessFn(),this.setSuccessFn=function(){}},hwSetFail:function(t){this.setFailFn(t)},sendHomeWorkResult:function(t){this.scoreShow=!0,this.imgSrc=t.img,this.comText=t.text},showHomeWork:function(t){var e=this;e.groupheader=t.localInfo.groupheader,e.groupId=t.groupId,function(t){$.map(t,function(t,i){Vue.set(e.groupData,t.wechat_id,t)})}(t.groupData||[]),e.startTime=e.endTime=e.getDate(),e.isShow=!0,e.$nextTick(function(){$(".home-work-con").wxScroll()}),e.$nextTick(function(){e.getHomeWork()})}}}),T=Vue.extend({template:"#homeWorkOne",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",realgroupId:"",groupId:"",editKey:"",edit$Key:"",groupData:{},scoreShow:!1,score:"",imgSrc:"",scoreAudioShow:!1,audioText:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},cur$key:"",comText:"",editType:{1:"Img",2:"Audio",6001:"Video"},isReEdit:!1,mt:null}},methods:{editGo:function(t){var e,i=$(".home-work-list-in>ul>li .todo"),s=i.length;switch(i.each(function(t,i){var s=$(i);return s.hasClass("cur-edit")?(e=t+1,!1):void 0}),this.scoreAudioHide(),t){case"l":1==e?e=s:e--;break;case"r":e==s?e=1:e++}this.$nextTick(function(){i.eq(e-1).click()})},getJson:function(t){var e;try{e=JSON.parse(t)}catch(i){e=""}return e},playVoice:function(t){this.voicePlay.voiceSrc=t,this.$nextTick(function(){voiceMsgPlayer3.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},shList:function(t,e,i){this.list[e][i].showTool=0==t},editList:function(t,e,i){this.cur$key=e,this["edit"+this.editType[i]].apply(null,arguments),this.editKey=t,this.edit$Key=e},editImg:function(t,e,i){var n=wxHeck.getImgUrl(this.list[t][e].content.split(",")[1]||this.list[t][e].content),a=this.groupData[t],o=(a.img,a.c_remark||a.nick),r=1==this.list[t][e].status,c=this;s.initNew({source:n,isEdit:r,nickName:o,save:function(t,e){return e?_alert("\u64cd\u4f5c\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"):void c.$emit("sendHomeWorkResult",t)}})},editAudio:function(t,e,i){this.scoreAudioShow=!0,this.editKey=t,this.edit$Key=e,this.isReEdit=1==this.list[t][e].status},scoreAudioHide:function(){this.scoreAudioShow=!1,this.audioText="",this.isReEdit=!1},editVideo:function(t,e,i){this.scoreAudioShow=!0,this.editKey=t,this.edit$Key=e,this.isReEdit=1==this.list[t][e].status},hideReEdit:function(){this.isReEdit=!1},delList:function(t,e){var i=this;confirm("\u786e\u8ba4\u5220\u9664\uff1f")&&wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:{wechat_id:i.realgroupId,message_id:e,status:1},success:function(s){return 1e4!=s.status?alert(s.message):(Vue["delete"](i.list[t],e),void i.list[t].length--)}})},checkListAudio:function(){var t=this;if(""!=t._audioText){var e={wechat_id:t.realgroupId,message_id:t.edit$Key,status:2,u_wechat_id:t.editKey,text:t._audioText};t.$parent.loading.show=!0,t.$parent.wxData.msgList[t.editKey].msgContent=e.text,t.$parent.sendMsg(),wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:e,success:function(e){return 1e4!=e.status?alert(e.message):(t.list[t.editKey][t.edit$Key].status="1",_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),void(t.$parent.loading.show=!1))}})}},checkList:function(t){var e=this,i={wechat_id:e.realgroupId,message_id:e.edit$Key,status:2,score:t.score,u_wechat_id:t.u_wechat_id,correct_img:t.correct_img,text:t.text};wxHeck.getData({url:"/WorkCorrect/changeChatRoomStatus",data:i,success:function(t){return 1e4!=t.status?alert(t.message):void(e.list[e.editKey][e.edit$Key].status="1")}})},hide:function(){this.isShow=!1,this.list=[],this.realgroupId="",this.groupId="",this.pending=!0,this.editKey="",this.edit$Key="",this.groupData={},this.cur$key="",this.scoreShow=!1},getDate:function(){var t=new Date,e=function(t){var e=t+"";return e.length<2?"0"+e:e};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},getHomeWork:function(){var t=this;wxHeck.getData({url:"/WorkCorrect/getStudentJobList",data:{group_id:t.realgroupId,wechat_id:t.groupId,start_time:_startTime.value||"",end_time:_endTime.value||""},success:function(e){if(1e4!=e.status)return alert(e.message);if(""==e.message||e.message==[]){var i={};i.length=0;for(var s in t.groupData)i[s]={length:0},i.length++;return void(t.list=i)}t.list=function(t){for(var e in t){t[e].length=0;for(var i in t[e])"length"!=i&&(t[e][i].showTool=!1,t[e].length++)}return t}(e.message)},complete:function(){t.pending=!1}})},homeWorkTip:function(t){var e=this.groupData[t],i=e.nick+"\u5c0f\u670b\u53cb\u6293\u7d27\u65f6\u95f4\u4ea4\u4f5c\u4e1a\u54e6\uff0c\u6bcf\u5929\u7684\u575a\u6301\u90fd\u662f\u5f88\u91cd\u8981\u7684\u5462\uff01";this.$parent.wxData.msgList[t].msgContent=i,this.$parent.sendMsg(),_alert("\u53d1\u9001\u63d0\u9192\u6210\u529f\uff01")},sendScore:function(t){var e=this;if(""!=e._score||t){var i=this.$parent,s=this.imgSrc,n=e._score,a=e.comText,o=e.editKey;this.hideScore(),wxHeck.getData({beforeSend:function(){i.loading.show=!0},url:"/UploadFile/screenImg",data:{file_base64:s,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(t){if(1e4==t.status){var r=(new Date).getTime();window.testURL&&(t.message=window.testURL);var c={action:"chat",id:localInfo.id,type:"web",to_id:i.wxData.curUserId,to_type:"ios",content:t.message,cnt_type:1,content_id:String(r)};e.setSuccessFn=function(){clearTimeout(e.mt),wxHeck.pushMsg({pushId:i.wxData.curUserId,isCC:!0,msg:[s,t.message],time:r,cnt_type:9999}),e.checkList({score:n,correct_img:t.message,u_wechat_id:o,text:a}),_alert("\u53d1\u9001\u6279\u6539\u7ed3\u679c\u6210\u529f\uff01"),i.loading.show=!1},wxHeck.sendMsg(c),clearTimeout(e.mt),e.mt=setTimeout(e.setFailFn,1e4)}else _alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),i.loading.show=!1},error:function(){_alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),i.loading.show=!1}})}},hideScore:function(){this.scoreShow=!1,this.imgSrc="",this.score="",this.comText=""},setSuccessFn:function(){},setFailFn:function(t){clearTimeout(this.mt),this.setSuccessFn=function(){},_alert(t||"\u53d1\u9001\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),this.$parent.loading.show=!1}},computed:{_score:function(){return $.trim(this.score)},_audioText:function(){return $.trim(this.audioText)}},events:{hwSetSuccess:function(){this.setSuccessFn(),this.setSuccessFn=function(){}},hwSetFail:function(t){this.setFailFn(t)},sendHomeWorkResult:function(t){this.scoreShow=!0,this.imgSrc=t.img,this.comText=t.text},showHomeWorkOne:function(t){var e=this;e.groupId=t.groupId,e.realgroupId=wxHeck.getFullId(t.groupData[t.groupId].showHW)+"@chatroom",function(t){Vue.set(e.groupData,e.groupId,t[e.groupId].userInfo)}(t.groupData||[]),e.startTime=e.endTime=e.getDate(),e.isShow=!0,e.$nextTick(function(){$(".home-work-con").wxScroll(),e.getHomeWork()})}}}),C=Vue.extend({template:"#homeWorkDetail",data:function(){return{isShow:!1,pending:!0,list:[],startTime:"",endTime:"",groupId:"",groupData:{},groupheader:"",voicePlay:{voiceSrc:"",playVoiceSrc:""},hwShow:!1,hwSrc:""}},methods:{getJson:function(t){var e;try{e=JSON.parse(t)}catch(i){e=""}return e},playVoice:function(t){this.voicePlay.voiceSrc=t,this.$nextTick(function(){voiceMsgPlayer4.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},hide:function(){this.isShow=!1,this.list=[],this.groupId="",this.pending=!0,this.groupheader="",this.hwHideFn(),this.groupData={}},hwHideFn:function(){this.hwShow=!1,this.hwSrc=""},getDate:function(){var t=new Date,e=function(t){var e=t+"";return e.length<2?"0"+e:e};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())},getHomeWork:function(){var t=this;wxHeck.getData({url:"/WorkCorrect/classInfoList",data:{wechat_id:t.groupId,start_time:_startTime_2.value||"",end_time:_endTime_2.value||""},success:function(e){if(1e4!=e.status)return alert(e.message);var i=function(t){if(t){var e=t.split("$");return e[0]==e[1]}};return""==e.message||e.message==[]?void(t.list=[]):void(t.list=function(t){for(var e in t)if(!i(e)){t[e].length=0;for(var s in t[e])"length"!=s&&(t[e][s].showTool=!1,t[e].length++)}return t}(e.message))},complete:function(){t.pending=!1}})},send:function(t){if(wxHeck.isMyFriend(t)){var e=this.getUrl(t),i=location.origin+e._url,s=e._nick+"\u7684\u4f5c\u4e1a\u8bb0\u5f55",n="\u8fd9\u662f"+e._nick+"\u5c0f\u670b\u53cb\u572851Talk\u7684\u4f5c\u4e1a\u8bb0\u5f55\uff0c\u8bf7\u67e5\u6536\uff5e",a=localInfo.img,o=JSON.stringify({title:s,introduction:n,icon:a,link:i,id:999}),r={action:"chat",id:localInfo.id,to_id:t,type:"web",cnt_type:3e3,content:o};wxHeck.pushMsg({pushId:t,isCC:!0,msg:o,cnt_type:3e3,time:(new Date).getTime()}),wxHeck.sendMsg(r),_alert("\u53d1\u9001\u6210\u529f")}else _confirm("\u548c\u5b66\u5458\u8fd8\u4e0d\u662f\u597d\u53cb\u5173\u7cfb\uff0c\u662f\u5426\u6dfb\u52a0\u5bf9\u65b9\u4e3a\u597d\u53cb\uff1f\u5982\u5b66\u5458\u672a\u53ca\u65f6\u901a\u8fc7\u597d\u53cb\u8bf7\u6c42\uff0c\u5efa\u8bae\u7535\u8bdd\u6c9f\u901a~",function(){this.$root.$broadcast("showAddFriend",{wxAcc:t.split("$")[1],type:"1"})}.bind(this))},getUrl:function(t){var e=this,i=e.groupData[t],s=localInfo.wechat_id+"$"+localInfo.wechat_id,n=e.groupData[s],a=["startTime="+_startTime_2.value,"endTime="+_endTime_2.value,"u_wechat_id="+t,"wechat_id="+e.groupId,"nickName="+i.wechat_real_nick,"headUrl="+i.wechat_img,"teaName="+n.wechat_nick,"teaHead="+n.wechat_img],o="/Guest/stuInfoList?"+a.join("&");return{_url:o,_nick:i.wechat_real_nick}},preview:function(t){var e=this.getUrl(t)._url;this.hwSrc=e,this.hwShow=!0}},events:{showHomeWorkDetail:function(t){var e=this;e.groupheader=t.localInfo.groupheader,e.groupId=t.groupId,function(t){$.map(t,function(t,i){Vue.set(e.groupData,t.wechat_id,t)})}(t.groupData||[]),e.startTime=e.endTime=e.getDate(),e.isShow=!0,e.$nextTick(function(){$(".home-work-con").wxScroll()}),e.$nextTick(function(){e.getHomeWork()})}}}),U=Vue.extend({template:"#groupAnnounce",data:function(){return{show:!1,annContent:"",groupId:""}},methods:{sendAnnounce:function(){this.show=!1,wxHeck.sendMsg({action:"announcement",id:localInfo.id,u_id:this.groupId,type:"web",content:this.annContent}),this.annContent=""},hide:function(){this.show=!1}},events:{showAnnLayer:function(t){this.show=!0,this.groupId=t}}}),M=Vue.extend({template:"#autoSend",data:function(){return{show:!1,setTime:{walkhalf:{val:0,text:""},walkhour:{val:0,text:""},walkcut:{val:0,text:""}},uid:""}},methods:{confirmBtn:function(){this.show=!1},conselBtn:function(){this.show=!1},setTimeCheck:function(t){switch(t){case"walkhalf":0==this.setTime.walkhalf.val?this.setTime.walkhalf.val=1:this.setTime.walkhalf.val=0;break;case"walkhour":0==this.setTime.walkhour.val?this.setTime.walkhour.val=1:this.setTime.walkhour.val=0;break;case"walkcut":0==this.setTime.walkcut.val?this.setTime.walkcut.val=1:this.setTime.walkcut.val=0}},confirmBtn:function(){var t=this;wxHeck.getData({url:"/UserContact/saveRemindSwitch",data:{uid:t.uid,admin_id:localInfo.admin_id,walkhalf:void 0==t.setTime.walkhalf.val?"":t.setTime.walkhalf.val,walkhour:void 0==t.setTime.walkhour.val?"":t.setTime.walkhour.val,walkcut:void 0==t.setTime.walkcut.val?"":t.setTime.walkcut.val},success:function(e){1e4!=e.status&&_alert(e.message),_alert("\u81ea\u52a8\u53d1\u9001\u8bbe\u7f6e\u6210\u529f\uff01"),t.show=!1}})}},events:{showAutoLayer:function(){this.show=!0},setTimeAjax:function(t,e){this.uid=e,this.setTime.walkhalf.val=void 0==t.walkhalf?"":t.walkhalf,this.setTime.walkhalf.text=void 0==t.text.walkhalf?"":t.text.walkhalf,this.setTime.walkhour.val=void 0==t.walkhour?"":t.walkhour,this.setTime.walkhour.text=void 0==t.text.walkhour?"":t.text.walkhour,this.setTime.walkcut.val=void 0==t.walkcut?"":t.walkcut,this.setTime.walkcut.text=void 0==t.text.walkcut?"":t.text.walkcut}}}),F=Vue.extend({template:"#setHW",data:function(){return{show:!1,showLoading:!1,isGroupOwner:!1,list:[],groupId:"",sending:!1}},computed:{sel_nosure:function(){return 0==this.list.length}},methods:{sendHwMsg:function(){var t=this,e=t.list[0];wxHeck.pushMsg({pushId:t.groupId,isCC:!0,msg:[e,e],time:(new Date).getTime(),cnt_type:9999});var i={action:"chat",id:localInfo.id,type:"web",to_id:t.groupId,to_type:"ios",content:e,cnt_type:1};wxHeck.sendMsg(i)},subHW:function(){var t=this;0!=t.list.length&&wxHeck.getData({beforeSend:function(){t.sending=!0},url:"/WorkCorrect/assignHomework",data:{wechat_id:t.groupId,work_images:t.list.join(",")},success:function(e){return 1e4!=e.status?void alert(e.message):(t.sendHwMsg(),void _alert("\u53d1\u9001\u6210\u529f",t.hide))},error:function(){alert("\u53d1\u9001\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01")},complete:function(){t.sending=!1}})},hide:function(){this.show=!1,this.list=[],this.groupId="",this.isGroupOwner=!1},initUpload:function(){var t=this;wxHeck.uploadFn.init({browse_button:"set-hw-upload-btn",container:"set-hw-upload",filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}]},BeforeUpload:function(e,i,s){t.showLoading=!0},FileUploaded:function(e,i,s){t.list.push(i.fileFullName),t.showLoading=!1},Error:function(e,i){alert(i.message),t.showLoading=!1}})}},events:{showSetHW:function(t){this.isGroupOwner=t.isGroupOwner,this.groupId=t.groupId,this.show=!0,this.$nextTick(this.initUpload)}}}),G=Vue.extend({template:"#changeGroupOwner",data:function(){return{show:!1,showlayer:!1,showOk:!1,sel:"",groupList:[],groupId:"",groupOwnner:"",search:"",nickName:""}},methods:{hideChangeOwner:function(){this.show=!1,this.groupList=[]},selUser:function(t,e){t==this.sel?this.sel="":this.sel=t,this.nickName=e.wechat_nick||e.wechat_real_nick||"";
},setNewOwner:function(){if(""!=this.sel){var t=this;_confirm("\u786e\u5b9a\u9009\u62e9"+t.nickName+"\u4e3a\u65b0\u7fa4\u4e3b\uff0c\u4f60\u5c06\u81ea\u52a8\u653e\u5f03\u7fa4\u4e3b\u8eab\u4efd\u3002",function(){wxHeck.sendMsg({action:"change_chatroom_owner",id:window.localInfo.id,type:"web",new_owner_id:t.sel.split("$")[1],u_id:t.groupId})})}}},events:{showChangeOwner:function(t){wxHeck.wxInit.$root.$data.contentGroupLayer.show=!1,this.show=!0,this.showlayer=!0,this.groupId=t.groupId,this.groupOwnner=t.groupOwnner,this.groupList=t.groupList,this.$nextTick(function(){$(".group-user-list").wxScroll()})},changeOwnerOk:function(){this.showOk=!0,this.showlayer=!0;var t=this;setTimeout(function(){t.showOk=!1,t.show=!1},600)}},computed:{selLists:function(){var t=this,e=$.trim(t.search);if(""==e||0==t.groupList.length)return t.groupList;var i=[];return $.map(t.groupList,function(s,n){var a=t.groupList[n].wechat_nick,o=a.indexOf(e)>-1;o&&i.push(s)}),i}}}),A=Vue.extend({template:"#cutUserDetail",data:function(){return{show:!1,details:{}}},methods:{hideCutMask:function(){this.show=!1}},events:{showCutUserLayer:function(t){this.show=!0,this.details=t.details}}}),B=Vue.extend({template:"#instead",data:function(){return{show:!1,crm:""}},methods:{hide:function(){this.show=!1},submitCrm:function(){if(this.crm){var t=this;wxHeck.getData({url:"/AdminContact/updateTrust",data:{trust_id:t.crm},success:function(e){return 1e4!=e.status?_alert(e.message):(_alert(e.message),this.crm="",t.show=!1,void location.replace("http://www.51talk.com/"))}})}}},events:{crmTrust:function(){this.show=!0,console.log("----")}}}),O=Vue.extend({template:"#sendLink",data:function(){return{show:!1,classLink:"",className:"",id:"",course_id:"",dengdai:!1}},methods:{hide:function(){this.show=!1},sendLink:function(){console.log(this.id),this.show=!1,this.$root.sendMsg(null,!0,this.id,this.classLink)}},events:{sendLinkClassName:function(t){this.className=t.course_name_cn+t.unit_name_cn+t.lession_name_cn},sendLinkLayer:function(t){var e=this;e.id=t.id,e.course_id=t.course_id,wxHeck.getData({url:"/Course/getCourseLinkById",data:{course_id:e.course_id},success:function(t){return 1e4!=t.status?(e.show=!1,_alert(t.message)):(e.show=!0,void(e.classLink=t.message))}})}}}),P=Vue.extend({template:"#recommend",data:function(){return{show:!1,recMoble:"",des:"",user_id:""}},methods:{addRecomd:function(){var t=this;wxHeck.getData({url:"/RecommendUser/addRecomUser",data:{mobile:t.recMoble,remark:t.des,recomm_user_id:t.user_id},success:function(e){return 1e4!=e.status?_alert(e.message):(_alert(e.message),t.show=!1,void(t.recMoble=t.des=t.user_id=""))}})},hide:function(){this.show=!1,this.recMoble=this.des=""}},events:{recommendFn:function(t){this.show=!0,this.user_id=t.user_id}}}),R=Vue.extend({template:"#labelEditor",data:function(){return{show:!1,showvis:!1,labelList:[],labelData:[],sysList:[],labelDataRemark:"",wechatId:"",pos:{top:"1px"},mt:null}},methods:{editLabel:function(t){if(1!=t.status){var e=t.id,i=this.labelData.indexOf(e);i>-1?this.labelData.splice(i,1):this.labelData.push(e)}},sendEdit:function(){this.$dispatch("changeLabel",{labelData:this.labelData,wechatId:this.wechatId})},close:function(){this.show=this.showvis=!1,this.labelData.sort().join(",")!=this.labelDataRemark&&this.sendEdit(),this.labelList=[],this.sysList=[],this.labelData=[],this.labelDataRemark="",this.wechatId=""},blurHide:function(){this.$root.showLabelEditor="",this.$root.showLabelEditorBlur=this.wechatId,this.close(),clearTimeout(this.mt),setTimeout(function(){this.$root.showLabelEditorBlur=""}.bind(this),300)}},events:{openLabelEditor:function(t){this.close(),this.labelList=t.labelList,this.sysList=t.sysList,this.labelData=t.labelData,this.labelDataRemark=t.labelData.sort().join(","),this.wechatId=t.wechatId,this.show=!0,this.$nextTick(function(){var e=$(".label-editor"),i=t.target,s=i.offset().top,n=$(window).height()-s,a=e.outerHeight(),o=0;o=n>a?s:s-a,this.pos.top=o+"px",this.showvis=!0,this.$nextTick(function(){e.wxScroll().focus()})}.bind(this))},closeLabelEditor:function(){this.close()}}}),W=Vue.extend({template:"#helperLink",data:function(){return{show:!1,data:{}}},methods:{close:function(){this.show=!1,this.data={}}},events:{helperLinkOpen:function(t){this.data=t,this.show=!0}}});wxHeck.wxInit=new Vue({el:"body",data:{mesBackShow:!1,userProgress:{progress:0,isFirst:!0},wxData:wxHeck.dataSource,bindCrm:{showBindBtn:!1,showBindCon:!1,showBindInfo:!1,showBindPop:!1,searchKey:"",searchResult:{id:"",nick_name:""}},bindGroupCtl:{showBindGroup:!1,canselBindGroup:!1,showbindLayer:!1,searchKey:"",searchResult:{id:"",name:""},wechatCode:"http://static.51talk.com/static/images/html/www_new/common/guan-wx.png?v=1484273503143",groupDetail:{},groupType:{cst:!1,dls:!1,other:!1},menu:!1,userGroup:localInfo.user_group},historyMsg:{isLoading:!1},userOp:{show:!1},userOpt:{show:!1},voicePlay:{voiceSrc:"",playVoiceSrc:""},contentTip:"",contentType:{types:["0","1","2","9999","42","3000","3001","3100","4000","5000","495","4950","6000","6001","400","10000"]},fileDetailType:"",noReadAll:0,userListType:"",todayFocusUser:[],at_id:[],setGroupChat:{flag:!1,list:[],msg:"",chatType:""},loading:{show:!1},contentGroupLayer:{show:!1,del:!1},newFriCount:0,showOwnnerBtn:!1,shareArticle:{show:!1,title:"",desc:"",icon:"",dig:"",urlStr:"",videoUrl:""},groupUserInfo:{from_id:"",mem_id:"",name:""},addDelFriendInfo:{show:!1,nameTitle:"51Talk\u7684\u8bfe\u7a0b\u987e\u95ee",msg:""},showLength:{userListByType:{startMark:20,start:20,step:10,cH:64,buffer:30}},personalInfo:{personalMask:!1,copyWechatImg:!1,copyImgBtn:!1,id:"",wechat_username:"",img:"",nick:"",qrcode_url:"",show:!1},introImg:{show:!1,img:"http://weixinheiniao.oss-cn-beijing.aliyuncs.com/images/b2BZpkmGCriTDpTwhJSA.jpg"},classGroupInfo:{show:!1,bindBtn:!0,userGroup:localInfo.user_group},blackUseTip:!1,showInfo:{recent:!1,last:!1},cutUserMenuList:!1,labelsWrap:{data:[],show:!1,showvis:!1,pos:{top:0}},showLabelEditor:"",showLabelEditorBlur:"",showShare:"",parentSend:!1,forwardText:"",temShareMsg:{}},filters:{_parseInt:function(t){return Math.round(t)},y_m_d:function(t){return t.substring(0,10)},y_m_d_h_m:function(t){return t.substring(0,16)},h_m:function(t){return t.substring(11,16)}},components:{userSel:i,editName:n,quickCon:a,userSearch:o,infoUpdate:d,errorsTip:l,addFriend:h,chatTools:_,sendPaste:w,updateWechat:k,logout:I,userType:c,fnTab:y,crmRemark:v,quickTab:H,myStudy:b,userTypes:u,myFriend:D,homeWork:L,groupAnnounce:U,autoSend:M,homeWorkDetail:C,homeWorkOne:T,setHw:F,changeOwner:G,cutUserDetail:A,instead:B,sendClass:O,recommend:P,labelEditor:R,helperLink:W},computed:{userListByType:function(){var t=this,e=t.userListType,i=[];return""==e?i=t.wxData.userList:$.map(t.wxData.userList,function(s,n){if("todayFocus"==e){if(t.todayFocusUser.indexOf(s)>-1&&(i.push(s),i.length==t.todayFocusUser.length))return!1}else{var a=t.wxData.msgList[s].userInfo,o=a.label.indexOf(e)>-1;o&&i.push(s)}}),this.$nextTick(function(){wxHeck.userBoxTop()}),this.showLength.userListByType.start=this.showLength.userListByType.startMark,i},bindCrmSearchResult:function(){var t=this.bindCrm.searchResult,e=[];return""!=t.id&&e.push("id:"+t.id),""!=t.nick_name&&e.push("\u6635\u79f0:"+t.nick_name),e.join(" ")},bindGroupSearchResult:function(){var t=this.bindGroupCtl.searchResult,e=[];return""!=t.name&&e.push(t.name),e.join(" ")}},methods:{parentSendFn:function(t){if("send"==t){var e=$.extend({},this.temShareMsg,{forwardText:$.trim(this.forwardText)});this.$broadcast("shareMsg",{msg:e})}else this.$broadcast("userSelClose"),this.setGroupChat.flag=!1,this.parentSend=!1,this.forwardText=""},openHelperLink:function(t){this.$broadcast("helperLinkOpen",t)},showShareMenu:function(t,e){"show"==e?this.showShare=t.content.urlStr||t.content.url:this.showShare=""},operationLog:function(t){wxHeck.getData({url:"/OperationLog/addOperationLog",data:{operation_type:t},success:function(t){},error:function(t){}})},isHelper:function(t){return this.wxData.helpList.indexOf(t)>-1},groupBindMenu:function(){this.bindGroupCtl.menu=!this.bindGroupCtl.menu},showBindMenuList:function(){this.cutUserMenuList=!this.cutUserMenuList},hideBindMenuList:function(){this.cutUserMenuList=!1},recommendUser:function(){this.$broadcast("recommendFn",{user_id:this.wxData.msgList[this.wxData.curUserId].crmInfo.user_id})},introWechat:function(t){return void(this.introImg.show="show"==t?!0:!1)},introWechatImg:function(){var t={action:"chat",id:localInfo.id,type:"web",to_id:this.wxData.curUserId,to_type:"ios",content:this.introImg.img,cnt_type:1};wxHeck.pushMsg({pushId:this.wxData.curUserId,isCC:!0,msg:[this.introImg.img,this.introImg.img],time:(new Date).getTime(),cnt_type:9999}),wxHeck.sendMsg(t),this.introImg.show=!1;var e="\u4eb2\u7231\u7684\u5b69\u5b50\u5bb6\u957f\uff0c\u60a8\u53ea\u8981\u5c06\u4e8c\u7ef4\u7801\u56fe\u7247\u548c\u4e09\u5f20\u5b69\u5b50\u4e0a\u8bfe\u56fe\u7247\u914d\u4e0a\u8d70\u5fc3\u6587\u5b57\u4e00\u8d77\u5206\u4eab\u5230\u670b\u53cb\u5708\uff0c\u670b\u53cb\u901a\u8fc7\u60a8\u5206\u4eab\u7684\u4e8c\u7ef4\u7801\u6ce8\u518c\u5e76\u4ed8\u8d39\uff0c1990\u5143\u768410\u8282\u5916 \u6559\u8bfe\u5c31\u5230\u8d26\u54e6\uff01\u670b\u53cb\u4e5f\u80fd\u83b7\u5f973\u8282\u5916\u6559\u8bfe\u54e6\uff01\u6bd4\u5982\u60a8\u53ef\u4ee5\u8fd9\u6837\u53d1\u670b\u53cb\u5708\uff1a \u6211\u548c\u5b9d\u8d1d\u6b63\u572851Talk\u5b66\u4e60\uff0c\u5b9d\u8d1d\u4ece\u5f00\u59cb\u652f\u652f\u543e\u543e\u5230\u5982\u4eca\u5df2\u7ecf\u80fd\u4e0e\u5916\u6559\u8001\u5e08\u6d41\u7545\u6c9f\u901a\uff0c\u5feb\u5e26\u5b69\u5b50\u4e00\u8d77\u6765\u5b66\u4e60\u5427\uff01",i={action:"chat",id:localInfo.id,type:"web",to_id:this.wxData.curUserId,to_type:"ios",content:e,cnt_type:0};wxHeck.sendMsg(i),wxHeck.pushMsg({pushId:this.wxData.curUserId,isCC:!0,msg:e,time:(new Date).getTime()})},mesBack:function(){var t={action:"revoke_last_msg",id:localInfo.id,type:"web",to_id:this.wxData.curUserId.split("$")[1]};wxHeck.sendMsg(t)},mesBackShowFn:function(t,e){t&&(this.mesBackShow=1==e)},getLabel:function(t,e){var i=this.wxData.msgList[t].userInfo.label.split(","),s=wxHeck.labelFn.nameMap,n=wxHeck.labelFn.idMap;return $.map(i,function(t,i){if(t in s){var a=s[t].id,o=e?a:n[a];return o}})},setHWShow:function(t){this.$broadcast("showSetHW",{groupId:t,isGroupOwner:this.wxData.msgList[t].isGroupOwner})},scrollShow:function(t,e){if(0!=e){var i=t.target,s=this.showLength.userListByType,n=i.clientHeight,a=i.scrollTop,o=i.scrollHeight;if(n+a>=o-s.buffer){var r=s.start+s.step;r=r>=e?e:r,s.start=r}if(o-(n+a)>s.step*s.cH+s.buffer){var r=s.start-s.step;r=r<=s.startMark?s.startMark:r,s.start=r}}},getFileClass:function(t){var e=t.split(".").slice(-1)[0];return"doc"==e||"docx"==e?"fileWord":"xls"==e||"xlsx"==e?"fileExcel":"ppt"==e||"pptx"==e?"filePpt":"pdf"==e?"filePdf":void 0},gotoBottom:function(){var t=this;window.setTimeout(function(){wxHeck.scrollToBottom(),wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:t.wxData.curUserId})},0)},scrollFn:function(t){var e=t.target;e.scrollTop+e.clientHeight+5>=e.scrollHeight&&(this.wxData.msgList[this.wxData.curUserId].noRead=0,this.noReadAll=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:this.wxData.curUserId}))},homeWorkShow:function(t){this.$broadcast("showHomeWork",{localInfo:this.wxData.localInfo,groupId:t,groupData:this.wxData.groupUserLists[t]})},homeWorkOneShow:function(t){this.$broadcast("showHomeWorkOne",{localInfo:this.wxData.localInfo,groupId:t,groupData:this.wxData.msgList})},homeWorkShowDetail:function(t){this.$broadcast("showHomeWorkDetail",{localInfo:this.wxData.localInfo,groupId:t,groupData:this.wxData.groupUserLists[t]})},getMyFriend:function(){this.userOpHide(),this.$broadcast("myFriendShow"),wxHeck.sendMsg({action:"hello_list",id:localInfo.id,type:"web"}),this.newFriCount=0},closeGroupChat:function(){this.$broadcast("userSelClose"),this.setGroupChat.flag=!1,this.wxData.msgList[this.wxData.curUserId].msgContent=this.setGroupChat.msg},isMyFriend:function(t){var e=t.wxid;1==t.result?(wxHeck.toTop(e),this.changeUser(e),wxHeck.userBoxTop()):wxHeck.wxInit.$broadcast("addFriendGoNext",t)},quickTab:function(t,e,i){console.log(e),e.isCC||i&&(this.groupUserInfo.from_id=e.from_id,this.groupUserInfo.mem_id=e.mem_id,this.groupUserInfo.name=e.name,this.$broadcast("openQuickTab",{from_id:e.from_id||e.curtId,name:e.name||e.wechat_nick,event:t,mem_id:e.mem_id||e.wechat_id,wechat_id:e.wechat_id||e.mem_id,wechat_nick:e.wechat_nick||e.name,curtId:this.wxData.curUserId}))},crmRemarkOpen:function(t){this.$broadcast("crmRemarkOpen",{user_id:t})},getSelCon:function(t){var e="";e=document.selection?document.selection.createRange().text:document.getSelection(),e=e.toString(),e&&this.$broadcast("openFnTab",{pos:{left:t.x,top:t.y},sendSelData:e})},showLabelTab:function(t,e){0!=e.length&&(this.labelsWrap.data=e,this.labelsWrap.show=!0,this.$nextTick(function(){var e=$(".labels_wrap").outerHeight(),i=$(t.target).offset().top;this.labelsWrap.pos.top=i-e-5+"px",this.labelsWrap.showvis=!0}.bind(this)))},getSys:function(t){var e=this.wxData.localInfo.labelList,i=this.wxData.curUserId;if(t.labelData||i){var s=t.labelData||this.getLabel(this.wxData.curUserId,!0),n=e[1];return n?$.map(n,function(e,i){return s.indexOf(e.id)>-1?t.getId?e.id:e:void 0}):[]}},showLabelEdit:function(t,e){if(e==this.showLabelEditorBlur)return void(this.showLabelEditorBlur="");if(this.showLabelEditorBlur="",e==this.showLabelEditor)this.showLabelEditor="",this.$broadcast("closeLabelEditor");else{var i=this.wxData.localInfo.labelList,s=this.getLabel(e,!0),n=this.getSys({labelData:s});this.showLabelEditor=e,this.$broadcast("openLabelEditor",{labelList:i,labelData:s,sysList:n,wechatId:e,target:$(t.target)})}},hideLabelTab:function(){this.labelsWrap.showvis=!1,this.labelsWrap.show=!1},sendCircleFriend:function(){wxHeck.sendMsg({action:"receive_wcmsg",id:localInfo.id,type:"web",action_type:1})},enNameEdit:function(t,e){var i=$.trim(t.target.innerText);if(i!=e.nick_name)return""==i?(alert("\u4fee\u6539\u82f1\u6587\u540d\u4e0d\u80fd\u4e3a\u7a7a"),void(t.target.innerText=e.nick_name)):void wxHeck.getData({url:"/UserContact/ajaxUpdateUserNickName",data:{user_id:e.user_id,nick_name:i},success:function(s){1e4!=s.status?(_alert(s.message),t.target.innerText=e.nick_name):e.nick_name=i},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),t.target.innerText=e.nick_name}})},contentTipShow:function(){clearTimeout(wxHeck.contentTipMT)},contentTipHide:function(){var t=this;wxHeck.contentTipMT=setTimeout(function(){t.contentTip=""},3e3)},sendMsgForce:function(){this.sendMsg(event,!0),this.contentTip=""},updateSelectMember:function(t,e){wxHeck.getData({url:"/UserContact/ajaxUpdateUserWechat",data:{member:e.selectMember,wechat_id:t},success:function(t){return 1e4!=t.status?(e.selectMember=e.selectMemberMark,_alert(t.message)):void(e.selectMemberMark=e.selectMember)},error:function(){e.selectMember=e.selectMemberMark,alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}})},updateInfo:function(){this.userOpHide(),this.$broadcast("showUpdate")},blackUseTips:function(t){"show"==t?(this.blackUseTip=!0,this.userOp.show=!1):this.blackUseTip=!1},addFriend:function(t){0==t.type&&this.userOpHide(),this.$broadcast("showAddFriend",t)},myStudy:function(){var t=wxHeck.Util.setDate(0);wxHeck.isCC()&&(t=wxHeck.Util.setDate(2));var e="",i=this,s={start_time:wxHeck.Util.setDate(-90),end_time:t,page_num:1,page_size:10,appoint_status:1};wxHeck.isSS()&&(e="/UserContact/getCrmUser",i.$broadcast("setStudyTypeBoolean",{cc:!1,ss:!0})),wxHeck.isCC()&&(e="/UserContact/getCrmUserByCc",i.$broadcast("setStudyTypeBoolean",{ss:!1,cc:!0})),wxHeck.getData({url:e,data:s,success:function(t){var e=t.message;return 1e4!=t.status?_alert(e):void i.$broadcast("showMyStudyLayer",{user_info:localInfo.wechat_id,myStudyData:e})}}),i.userOpHide()},playVoice:function(t){this.voicePlay.voiceSrc=t,this.$nextTick(function(){voiceMsgPlayer.play()})},isPlaying:function(){this.voicePlay.playVoiceSrc=this.voicePlay.voiceSrc},isEnded:function(){this.voicePlay.playVoiceSrc=""},editNameShow:function(t,e){this.$broadcast("editNameOpen",{isGroup:t,reMark:e}),this.contentGroupLayer.del=!1,this.contentGroupLayer.show=!1},showUserDetail:function(t){t&&wxHeck.sendMsg({action:"get_contact_details",u_id:t.split("$")[1],type:"web",id:localInfo.id})},groupMenuSet:function(t,e){var i=this,s={action:"",u_id:this.wxData.curUserId.split("$")[1],type:"web",id:localInfo.id};switch(t){case"open":s.action="mute_session",s.mute_session=0,wxHeck.sendMsg(s),i.contentGroupLayer.show=!1;break;case"close":_confirm("\u786e\u5b9a\u8981\u5c4f\u853d\u8be5\u7fa4\u7684\u6d88\u606f\u63d0\u9192\u5417\uff1f",function(){console.log(0),i.contentGroupLayer.show=!1,s.action="mute_session",s.mute_session=1,wxHeck.sendMsg(s)});break;case"toTop":s.action="top_chat_session",s.set_to_top=1,wxHeck.sendMsg(s);break;case"closeTop":s.action="top_chat_session",s.set_to_top=0,wxHeck.sendMsg(s);break;case"announce":i.$broadcast("showAnnLayer",i.wxData.curUserId.split("$")[1]),i.contentGroupLayer.show=!1;break;case"power":i.$broadcast("showChangeOwner",{groupOwnner:i.wxData.groupOwnner,groupList:i.wxData.groupUserLists[i.wxData.curUserId],groupId:i.wxData.curUserId.split("$")[1]});break;case"delIco":i.contentGroupLayer.show=!0,i.$nextTick(function(){$(".content-group-list").wxScroll()}),i.contentGroupLayer.del=!0,i.$broadcast("showDelBtn",i.contentGroupLayer.show),$(".content-group-show-layer").focus();break;case"myNicker":var n=i.wxData.groupUserLists[i.wxData.curUserId]||[],a="";$.map(n,function(t,e){var i=t.wechat_id.split("$")[1],s=t.wechat_nick;i==localInfo.wechat_id&&(a=s)}),console.log("\u5f53\u524d\u6635\u79f0\uff1a"+a),i.$broadcast("editMyNicker",{show:!0,u_id:this.wxData.curUserId.split("$")[1],nicker:a});break;case"invite":console.log(e),e?_confirm("\u786e\u8ba4\u5173\u95ed\u3010\u7fa4\u804a\u9080\u8bf7\u786e\u8ba4\u3011\u529f\u80fd\uff1f",function(){s.action="allow_owner_approve",s.allow_owner_approve_value=0,wxHeck.sendMsg(s)}):_confirm("\u786e\u8ba4\u5f00\u542f\u3010\u7fa4\u804a\u9080\u8bf7\u786e\u8ba4\u3011\u529f\u80fd\uff1f",function(){s.action="allow_owner_approve",s.allow_owner_approve_value=1,wxHeck.sendMsg(s)});break;case"quit":_confirm("\u9000\u51fa\u540e\u4e0d\u4f1a\u901a\u77e5\u7fa4\u804a\u4e2d\u5176\u4ed6\u6210\u5458\uff0c\u4e14\u4e0d\u4f1a\u518d\u63a5\u53d7\u6b64\u7fa4\u804a\u4fe1\u606f",function(){s.action="quit_chatroom",wxHeck.sendMsg(s)});break;case"vip":var o="\u4eb2\u7231\u7684\u5b69\u5b50\u5bb6\u957f\uff0c\u60a8\u53ea\u8981\u5c06\u4e8c\u7ef4\u7801\u56fe\u7247\u548c\u4e09\u5f20\u5b69\u5b50\u4e0a\u8bfe\u56fe\u7247\u914d\u4e0a\u8d70\u5fc3\u6587\u5b57\u4e00\u8d77\u5206\u4eab\u5230\u670b\u53cb\u5708\uff0c\u670b\u53cb\u901a\u8fc7\u60a8\u5206\u4eab\u7684\u4e8c\u7ef4\u7801\u6ce8\u518c\u5e76\u4ed8\u8d39\uff0c1990\u5143\u768410\u8282\u5916 \u6559\u8bfe\u5c31\u5230\u8d26\u54e6\uff01\u670b\u53cb\u4e5f\u80fd\u83b7\u5f973\u8282\u5916\u6559\u8bfe\u54e6\uff01 \u6bd4\u5982\u60a8\u53ef\u4ee5\u8fd9\u6837\u53d1\u670b\u53cb\u5708\uff1a \u6211\u548c\u5b9d\u8d1d\u6b63\u572851Talk\u5b66\u4e60\uff0c\u5b9d\u8d1d\u4ece\u5f00\u59cb\u652f\u652f\u543e\u543e\u5230\u5982\u4eca\u5df2\u7ecf\u80fd\u4e0e\u5916\u6559\u8001\u5e08\u6d41\u7545\u6c9f\u901a\uff0c\u5feb\u5e26\u5b69\u5b50\u4e00\u8d77\u6765\u5b66\u4e60\u5427\uff01",r={user_id:e,wechat_id:i.wxData.curUserId.split("$")[1]};_confirm(o,function(){wxHeck.getData({url:"/RemindMainWechat/addRemindMainWechat",data:r,success:function(t){switch(t.status){case 1e4:_alert(t.message);break;case 10003:_confirm("\u8be5\u5b66\u5458\u4e3b\u8ddf\u8fdb\u5fae\u4fe1\u53f7\u5df2\u7ecf\u88ab\u6307\u5b9a,\u8981\u786e\u5b9a\u672c\u6b21\u66f4\u6539\u5417\uff1f",function(){wxHeck.getData({url:"/RemindMainWechat/updateRemindMainWechat",data:r,success:function(t){return 1e4!=t.status?_alert(t.message):void _alert(t.message)}})});break;default:_alert(t.message)}},error:function(){console.log("\u8bf7\u6c42\u5931\u8d25")}})})}},userOpShow:function(){this.userOp.show=!this.userOp.show},userOpHide:function(){this.userOp.show=!1},userOptShow:function(){this.userOpt.show=!this.userOpt.show},userOptHide:function(){this.userOpt.show=!1},delFriend:function(t,e){_confirm("\u5c06\u8054\u7cfb\u4eba\u3010"+e+"\u3011\u5220\u9664\uff0c\u5c06\u540c\u65f6\u5220\u9664\u4e0e\u8be5\u8054\u7cfb\u4eba\u7684\u804a\u5929\u8bb0\u5f55",function(){wxHeck.sendMsg({action:"remove_users",wxid:t,type:"web",id:localInfo.id})})},showGroupLayer:function(){this.contentGroupLayer.show=!this.contentGroupLayer.show,this.contentGroupLayer.del=!1,this.$nextTick(function(){$(".content-group-list").wxScroll()}),this.$broadcast("showDelBtn",this.contentGroupLayer.show),$(".content-group-show-layer").focus()},delGroupDetailUser:function(t){console.log(t.wechat_id,t.wechat_nick);var e=t.wechat_id.split("$");if(e[0]==e[1])return void _alert("\u4e0d\u80fd\u8e22\u51fa\u81ea\u5df1");var i=this.wxData.curUserId.split("$")[1];_confirm("\u5c06\u7fa4\u6210\u5458\u3010"+t.wechat_nick+"\u3011\u5220\u9664\uff1f",function(){wxHeck.sendMsg({action:"del_group_mem",u_id:i,type:"web",wxids:t.wechat_id,id:localInfo.id})}),this.contentGroupLayer.show=!this.contentGroupLayer.show},getChat:function(t,e){"0"==e&&_alert("\u4e3a\u4fdd\u969c\u5b66\u5458\u7684\u4f53\u9a8c\uff0c\u9ed1\u9e1f\u6bcf\u5468\u53ea\u5141\u8bb8\u4f7f\u75283\u6b21\u3010\u7fa4\u53d1\u4e2a\u4eba\u3011\uff08\u5176\u4e2d\uff1a\u53ea\u5141\u8bb8\u4f7f\u75281\u6b21\u5355\u53d1\u8bdd\u672f\uff0c\u53ea\u5141\u8bb8\u4f7f\u75282\u6b21\u53d1\u9001\u6587\u7ae0\u6216\u56fe\u7247\uff09\u3002\u8bf7\u8ba4\u771f\u7f16\u8f91\u4f60\u53d1\u7ed9\u5b66\u5458\u7684\u8bdd\u672f\uff0c\u9ed1\u9e1f\u4f1a\u76d1\u63a7\u7fa4\u53d1\u7684\u5185\u5bb9\u3002"),this.setGroupChat.chatType=e||"",this.userOpHide(),this.$broadcast("userSelOpen",{type:t,listPerson:this.wxData.userListPerson,listGroup:this.wxData.userListGroup,chatType:e}),"getGroupChat"==t&&(""==this.wxData.curUserId&&this.changeUser(this.userListByType[0]),this.setGroupChat.msg=this.wxData.msgList[this.wxData.curUserId].msgContent,this.wxData.msgList[this.wxData.curUserId].msgContent="",this.setGroupChat.flag=!0),"add_group_mem"==t&&(this.contentGroupLayer.show=!1,this.contentGroupLayer.del=!1)},userLogout:function(){this.userOpHide(),window.confirm("\u786e\u8ba4\u9000\u51fa\uff1f")&&wxHeck.Util.closeTab()},logoutTrust:function(){this.$broadcast("crmTrust"),this.userOpHide()},userLogoutTrustByWX:function(){this.userOpHide();var t=this;wxHeck.getData({url:"/AdminContact/getSelfWechat",data:{admin_id:localInfo.id},success:function(e){return 1e4!=e.status?alert(e.message):(void 0==e.message&&(e.message=""),void t.$broadcast("logoutShowFn",e.message))}})},getLabels:function(t){},setHeight:function(){var t=$(window).height(),e=$(".user_mes_boxc").outerHeight(),i=$(".user_mes_con dt").outerHeight(),s=t-e-i-10;$(".user_mes_con dd").height(s),console.log("\u5e95\u90e8\u9ad8\u5ea6\uff1a"+s)},getCrmInfo:function(t,e){var i=this,s=e||i.wxData.curUserId,n=i.wxData.msgList[s].userInfo.c_remark;if(i.wxData.msgList[s].crmInfo.isGet&&i.getLabels(s),!i.wxData.msgList[s].crmInfo.isGet||t,0)i.bindCrm.showBindCon=!1,i.bindCrm.showBindBtn=!1,i.bindCrm.showBindInfo=!0;else{var i=this;wxHeck.getData({url:"/UserContact/showUserInfo",data:{wechat_id:s,wid_remark_name:n,label_list:i.getSys({getId:!0})},success:function(t){if(1e4==t.status){null==t.message.selectMember&&(t.message.selectMember="0"),t.message.selectMemberMark=t.message.selectMember,i.wxData.msgList[s].crmInfo=$.extend({},i.wxData.msgList[s].crmInfo,t.message),i.$broadcast("setTagList",{labelList:i.wxData.msgList[s].crmInfo.tag_list||""});var e=t.message.user_id;wxHeck.getData({url:"/Course/getRecentlyLast",data:{user_id:e},success:function(t){t.message.combo&&t.message.combo.length>0&&(t.message.comboSel="0"),i.wxData.msgList[s].crmInfo=$.extend({},i.wxData.msgList[s].crmInfo,t.message,{isGet:!0}),i.bindCrm.showBindCon=!1,i.bindCrm.showBindBtn=!1,i.bindCrm.showBindInfo=!0,i.getLabels(s),i.$broadcast("sendLinkClassName",t.message.recent),i.$nextTick(i.setHeight)}}),function(){if(999==i.wxData.msgList[s].showHW){var e=t.message.group_list;if(0!=e.length){console.log("get show homework");var n={id:s.split("$")[1],grouparray:e},a={id:localInfo.id,action:"is_contact_in_grouparray",type:"web",to_type:"ios",groupdata:n};wxHeck.sendMsg(a)}}}()}else i.bindCrm.showBindCon=!0,i.bindCrm.showBindBtn=!0,i.bindCrm.showBindInfo=!1,i.wxData.msgList[s].crmInfo={isGet:!1},i.$broadcast("setTagList",{labelList:""}),i.$nextTick(i.setHeight)}})}},getGroupInfo:function(){var t="";"6"==localInfo.user_group?t="/UserWorkGroup/showBoundClass":(this.bindGroupCtl.groupType.dls=!0,t="/BoundCommodity/showBoundCommodity");var e=this;wxHeck.getData({url:t,data:{group_id:e.wxData.curUserId.split("$")[1].split("@")[0]},success:function(t){var i=t.message;""!=i.code&&(e.bindGroupCtl.wechatCode=i.code),("7"==localInfo.user_group||"9"==localInfo.user_group||"10"==localInfo.user_group||"11"==localInfo.user_group)&&(i.isBound?(e.bindGroupCtl.canselBindGroup=!0,e.bindGroupCtl.showBindGroup=!1,e.bindGroupCtl.groupDetail=i):(e.bindGroupCtl.showBindGroup=!0,e.bindGroupCtl.canselBindGroup=!1)),"6"==localInfo.user_group&&(10001==t.status?e.classGroupInfo.bindBtn=!0:e.classGroupInfo.bindBtn=!1,e.bindGroupCtl.groupType.cst=!0)}})},changeUser:function(t){var e=this.isHelper(t);if(this.contentGroupLayer.show=!1,this.contentGroupLayer.del=!1,this.wxData.curUserId!=t){var i=this;if(1==localInfo.is_trust){var s=-1==$.inArray(t,i.wxData.trustList);if(s&&0==i.wxData.msgList[t].noRead)return;s&&i.wxData.trustList.push(t)}this.wxData.curUserId=t,this.bindCrm.showBindCon=!1,this.bindCrm.showBindBtn=!1,this.bindCrm.showBindInfo=!1,i.bindCrm.isRebind=!1,function(){i.$broadcast("setOtherList",e)}(),this.$nextTick(function(){wxHeck.msgBox||(wxHeck.msgBox=$(".content_message"),wxHeck.msgBox.wxScroll(),$(".user_mes_con>dd").wxScroll(),wxHeck.upLoadImgInit(i),wxHeck.upLoadFileInit(i),$(".send_text").on("paste",function(t){wxHeck.Util.pasteFn(t.originalEvent,function(t){i.$broadcast("openSendPaste",{imgSrc:t})})})),i.wxData.msgList[t].isGroup?(i.getGroupInfo(),wxHeck.sendMsg({action:"group_user_list",u_id:t.split("$")[1],type:"web",id:localInfo.id}),wxHeck.sendMsg({action:"group_ownner_id",u_id:t.split("$")[1],type:"web",id:localInfo.id}),setTimeout(function(){localInfo.wechat_id==wxHeck.dataSource.groupOwnner?(wxHeck.dataSource.showOwnnerBtn=!0,wxHeck.wxInit.wxData.msgList[t].isGroupOwner=!0):wxHeck.dataSource.showOwnnerBtn=!1},500)):i.getCrmInfo(),wxHeck.scrollToBottom(),function(){if(!(i.wxData.msgList[t].noRead<=0)){var s=i.wxData.msgList[t].time,n=e?"/BlackBirdHelper/ajaxUnreadHelperMessage":"/WechatMessage/ajaxUnreadMessage";s&&s>0?i.getHistoryFn({url:n,data:{score:s},cb:function(){i.noReadAll-=i.wxData.msgList[t].noRead,i.wxData.msgList[t].noRead=0,i.wxData.msgList[t].time=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:t})},isGetNoRead:!0}):(i.noReadAll-=i.wxData.msgList[t].noRead,i.wxData.msgList[t].noRead=0,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:t}))}}()}),this.clearAtUs(),wxHeck.wxInit.$refs.quickcon.tagSel.selName="",wxHeck.wxInit.$refs.quickcon.inputData="",wxHeck.wxInit.$refs.quickcon.conList=[]}},sendMsg:function(t,e,i,s){var n=this,a=i||this.wxData.curUserId;if(a){var o=s||$.trim(n.wxData.msgList[a].msgContent);if(""!=o&&!(this.setGroupChat.flag&&0==this.setGroupChat.list.length||t&&13==t.which&&t.shiftKey)){t&&13==t.which&&t.preventDefault();var r=function(t,i){if(e)return!0;var s=t.match(i);return s?(n.contentTip="\u8bf7\u6839\u636e\u5b66\u5458\u60c5\u51b5\u66f4\u6539"+s.join("\uff0c")+"\u7684\u5185\u5bb9\u540e\u518d\u53d1\u9001",n.contentTipShow(),void n.contentTipHide()):!0}(o,wxHeck.Util.conReg);if(r){var c={action:"chat",id:localInfo.id,type:"web",to_id:a,to_type:"ios"};if(0!=this.at_id.length?(c.content=JSON.stringify({atwxid:this.at_id.join(","),content:o}),c.cnt_type=3100,this.at_id=[]):c.content=o,this.setGroupChat.flag)return void this.sendGroupChat(c);wxHeck.sendMsg(c),wxHeck.pushMsg({pushId:a,isCC:!0,msg:o,time:(new Date).getTime()}),wxHeck.toTop(a),n.wxData.msgList[a].msgContent=""}}}},clearAtUs:function(){this.wxData.msgList[this.wxData.curUserId].at_fg=0,this.wxData.msgList[this.wxData.curUserId].atshow=!1},sendGroupChat:function(t,e){function i(){s.loading.show=!0,t.to_id=n.join(","),r?wxHeck.getData({url:"/WechatMessage/ajaxMassMessage",data:{id:localInfo.id,wechat_id:localInfo.wechat_id,action:"group_chat",type:"web",to_type:"ios",u_ids:t.to_id,content:t.content,cnt_type:t.cnt_type,chatType:o},success:function(t){return 1e4!=t.status?_alert(t.message):(_alert("\u8f6c\u53d1\u6210\u529f"),void s.closeGroupChat())},complete:function(){s.loading.show=!1}}):(t.chatType=o,wxHeck.getData({url:"/WechatMessage/ajaxChangeMessage",data:t,success:function(t){return 1e4!=t.status?_alert(t.message):(_alert("\u8f6c\u53d1\u6210\u529f"),void s.closeGroupChat())},complete:function(){s.loading.show=!1}})),wxHeck.getData({url:"/OperationLog/addOperationLog",data:{operation_type:1},success:function(t){console.log("\u7edf\u8ba1\u7fa4\u53d1\u5230\u7fa4\u6b21\u6570")},error:function(){console.log("\u8bf7\u6c42\u51fa\u9519")}})}var s=this,n=s.setGroupChat.list,a=n.length;if(0==n.length)return _alert("\u8bf7\u9009\u62e9\u8054\u7cfb\u4eba\uff01");var o=s.setGroupChat.chatType,r="0"==o&&!e;if("0"==o){var s=this;wxHeck.getData({url:"/MassMessageLog/getMassMessageCount",data:{admin_id:localInfo.admin_id},success:function(e){if(1e4!=e.status)return _alert(e.message);if(r&&1!=t.cnt_type)parseInt(e.message[0])>0?_alert("\u672c\u5468\u5df2\u7ecf\u65e0\u6cd5\u901a\u8fc7\u3010\u7fa4\u53d1\u4e2a\u4eba\u3011\u53d1\u9001\u8bdd\u672f\u7ed9\u5b66\u5458\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5c1d\u8bd5\u53d1\u9001\u6587\u7ae0\u6216\u56fe\u7247"):i();else if(parseInt(e.message[1])>1)_alert("\u672c\u5468\u5df2\u7ecf\u65e0\u6cd5\u3010\u7fa4\u53d1\u4e2a\u4eba\u3011\u53d1\u9001\u6587\u7ae0\u6216\u56fe\u7247\u7ed9\u5b66\u5458");else{var s="\u9009\u62e9"+a+"\u4eba\u7fa4\u53d1\u6d88\u606f\u9700\u7b49\u5f85"+Math.ceil(3*a/60)+"\u5206\u949f\uff0c\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u662f\u5426\u7fa4\u53d1\uff1f";_confirm(s,function(){i()})}}})}else{var c="\u9009\u62e9"+a+"\u4eba\u7fa4\u53d1\u6d88\u606f\u9700\u7b49\u5f85"+Math.ceil(3*a/60)+"\u5206\u949f\uff0c\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u662f\u5426\u7fa4\u53d1\uff1f";_confirm(c,function(){i()})}},bindUser:function(){this.bindCrm.showBindPop=!0},unbindUser:function(){var t=this;wechat_id=t.wxData.curUserId,user_id=t.wxData.msgList[wechat_id].crmInfo.user_id,wid_remark_name=t.wxData.msgList[wechat_id].userInfo.c_remark,_confirm("\u786e\u8ba4\u89e3\u9664\u7ed1\u5b9a\uff1f",function(){wxHeck.getData({url:"/UserContact/deleteUserInfo",data:{user_id:user_id,wechat_id:wechat_id,wid_remark_name:wid_remark_name},success:function(e){return 1e4!=e.status?_alert(e.message):(_alert("\u89e3\u7ed1\u6210\u529f"),void t.getCrmInfo(!0))}})})},hideBindPop:function(){this.bindCrm.showBindPop=!1,this.bindCrm.searchKey="",this.bindCrm.searchResult.id="",this.bindCrm.searchResult.nick_name=""},bindSearch:function(){var t=$.trim(this.bindCrm.searchKey),e=this;return""==t?alert("\u8bf7\u8f93\u5165\u641c\u7d22\u7535\u8bdd\u53f7\u7801\u6216ID\u53f7"):void wxHeck.getData({url:"/UserContact/searchUserInfo",data:{user_num:t,admin_id:localInfo.admin_id},success:function(t){return t?1e4!=t.status?alert(t.message):(e.bindCrm.searchResult.id=t.message.id,void(e.bindCrm.searchResult.nick_name=t.message.nick_name)):alert("\u8fd4\u56de\u6570\u636e\u4e3a\u7a7a\uff0c\u8bf7\u4fdd\u7559\u73b0\u573a\uff0c\u8054\u7cfb\u9ed1\u9e1f\u6280\u672f\uff01")}})},bindCrmFn:function(){var t=this,e=t.bindCrm.searchResult.id,i=t.wxData.curUserId;return e?void wxHeck.getData({url:"/UserContact/addUserWechatContact",data:{wechat_id:i,user_id:e},success:function(e){return 1e4!=e.status?alert(e.message):(alert("\u7ed1\u5b9a\u6210\u529f"),
t.hideBindPop(),void t.getCrmInfo(!0))}}):alert("\u8bf7\u63d0\u4f9b\u7ed1\u5b9a\u4fe1\u606f\uff01")},bindGroupBtn:function(){this.bindGroupCtl.showbindLayer=!0},hideBindGroupLayer:function(){this.bindGroupCtl.showbindLayer=!1,this.bindGroupCtl.searchKey="",this.bindGroupCtl.searchResult.id="",this.bindGroupCtl.searchResult.name=""},bindGroupSearch:function(){var t=$.trim(this.bindGroupCtl.searchKey),e=this;return""==t?alert("\u8bf7\u8f93\u5165\u5546\u54c1ID"):/^[0-9]*$/.test(t)?void wxHeck.getData({url:"/BoundCommodity/getCommodityById",data:{id:t,group_id:e.wxData.curUserId.split("$")[1].split("@")[0]},success:function(i){return 1e4!=i.status?alert(i.message):(e.bindGroupCtl.searchResult.id=t,e.bindGroupCtl.searchResult.name=i.message.name,void(""==i.message.name&&alert("\u6682\u65e0\u8be5ID\u5546\u54c1\uff01")))}}):alert("\u5546\u54c1ID\u53ea\u80fd\u662f\u6570\u5b57\uff01")},bindGroupFn:function(){var t=this,e=t.bindGroupCtl.searchResult.id,i=t.wxData.curUserId.split("$")[1].split("@")[0],s=t.bindGroupCtl.searchResult.name;return console.log("\u63d0\u4ea4\u7fa4\u7ed1\u5b9a\u53c2\u6570\uff1a"+e,i,s,localInfo.admin_id),e?void wxHeck.getData({url:"/BoundCommodity/boundCommodity",data:{commodity_id:e,commodity_name:s,wechat_id:localInfo.wechat_id,group_id:i},success:function(e){return 1e4!=e.status?alert(e.message):(alert("\u7ed1\u5b9a\u6210\u529f"),t.hideBindGroupLayer(),void t.getGroupInfo())}}):alert("\u8bf7\u63d0\u4f9b\u7ed1\u5b9a\u5546\u54c1ID\uff01")},unbindGroup:function(){var t=this;group_id=t.wxData.curUserId.split("$")[1].split("@")[0],window.confirm("\u786e\u8ba4\u89e3\u9664\u7fa4\u7ed1\u5b9a\uff1f")&&wxHeck.getData({url:"/BoundCommodity/canserBound",data:{group_id:group_id},success:function(e){return 1e4!=e.status?alert(e.message):(alert("\u7fa4\u89e3\u7ed1\u6210\u529f"),void t.getGroupInfo())}})},getHistoryFn:function(t){var e=this;curUserId=e.wxData.curUserId,score=e.wxData.msgList[curUserId].historyMsg.score,e.historyMsg.isLoading=!0;var i,s=e.isHelper(curUserId);i=s?{url:"/BlackBirdHelper/ajaxHelperMessage",data:{helper_id:curUserId,score:score,cc_id:localInfo.id}}:{url:"/WechatMessage/ajaxMessageList",data:{wechatId:curUserId,score:score,ccId:localInfo.id}};var n=$.extend(!0,{},i,t);wxHeck.getData({url:n.url,data:n.data,success:function(t){return 1e4!=t.status?alert(t.message):(0==t.message.length?e.wxData.msgList[curUserId].historyMsg.isGetAll=!0:$.map(t.message,function(i,s){!function(){s==t.message.length-1&&(e.wxData.msgList[curUserId].historyMsg.score=i.time)}(),function(t){var e=t.from_id==localInfo.id,i=e?t.to_id:t.from_id;if(wxHeck.wxInit.wxData.msgList[i]){var s="object"==typeof t.content?JSON.stringify(t.content):t.content;3e3==t.cnt_type&&t.content.forward_text&&""!=t.content.forward_text&&wxHeck.pushMsg({pushId:i,isCC:e,msg:t.content.forward_text,pushType:"unshift",isGetHistory:!0,time:t.time,name:t.name,c_remark:t.c_remark,source:t}),wxHeck.pushMsg({pushId:i,isCC:e,msg:s,pushType:"unshift",isGetHistory:!0,time:t.time,name:t.name,c_remark:t.c_remark,cnt_type:t.cnt_type,source:t})}}(i)}),void("function"==typeof n.cb&&n.cb()))},complete:function(){e.historyMsg.isLoading=!1}})},getChatPar:function(t){var e=this,i=t.selectList;if(1==i.length){var s=i[0];wxHeck.toTop(s),e.changeUser(s),wxHeck.userBoxTop()}else wxHeck.sendMsg({id:localInfo.id,action:"create_group",type:"web",wxids:i.join(",")});this.$broadcast("userSelClose")},add_group_memPar:function(t){var e=this,i=t.selectList;wxHeck.sendMsg({id:localInfo.id,action:"add_group_mem",type:"web",to_id:e.wxData.curUserId,to_type:"ios",wxids:i.join(",")}),this.$broadcast("userSelClose")},addUsersPar:function(t){var e=this,i=t.selectList;wxHeck.sendMsg({id:localInfo.id,action:"add_group_mem",type:"web",to_id:e.wxData.curUserId,to_type:"ios",wxids:i.join(",")}),this.$broadcast("userSelClose")},getGroupPar:function(t){var e=this,i=t.selectList,s=t.inputMsg;this.$broadcast("userSelPending","\u6b63\u5728\u7fa4\u53d1\u4e2d..."),wxHeck.getData({url:"/WechatMessage/ajaxMassMessage",data:{id:localInfo.id,wechat_id:localInfo.wechat_id,action:"group_chat",type:"web",to_type:"ios",u_ids:i.join(","),content:s},success:function(t){1e4!=t.status?alert(t.message):(alert("\u7fa4\u53d1\u6210\u529f"),e.$broadcast("userSelClose")),e.$broadcast("userSelPendingDefault")}})},hideContentTip:function(){this.contentTips.show=!1},handCall:function(){wxHeck.getData({url:"/Call/handCall",data:{user_id:this.wxData.msgList[this.wxData.curUserId].crmInfo.user_id,wechat_id:localInfo.wechat_id},success:function(t){1e4!=t.status?alert(t.message):_alert("\u62e8\u6253\u6210\u529f\uff01")}})},sendClassLink:function(){var t="";wxHeck.wxInit.wxData.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo.recent.course_id&&(t=wxHeck.wxInit.wxData.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo.recent.course_id),this.$broadcast("sendLinkLayer",{id:wxHeck.wxInit.wxData.curUserId,course_id:t})},setAutoSend:function(){var t=this;wxHeck.getData({url:"/UserContact/getRemindSwitch",data:{uid:t.wxData.msgList[t.wxData.curUserId].crmInfo.user_id,admin_id:localInfo.admin_id},success:function(e){1e4!=e.status&&_alert(e.message),t.$broadcast("setTimeAjax",e.message,t.wxData.msgList[t.wxData.curUserId].crmInfo.user_id)}}),this.$broadcast("showAutoLayer")},shareMenu:function(t,e,i){switch(e){case"article":this.shareArticle.dig=this.shareArticle.videoUrl="",this.shareArticle.show=!0,this.shareArticle.title=t.title,this.shareArticle.desc=t.desc,this.shareArticle.icon=t.thumbUrl,this.shareArticle.urlStr=t.urlStr;break;case"video":var s=this.wxData.wechat_version;if(t.size>1048576&&"6.3.23">=s)return _alert("\u8be5\u89c6\u9891\u8d85\u51fa\u5206\u4eab\u9650\u5236,\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc71M");this.shareArticle.dig=this.shareArticle.title=this.shareArticle.desc=this.shareArticle.icon=this.shareArticle.urlStr="",this.shareArticle.show=!0,this.shareArticle.videoUrl=t.url;break;case"single":this.parentSend=!0,this.showShare="",this.getChat("getGroupChat","0"),this.temShareMsg=t;break;case"group":this.parentSend=!0,this.showShare="",this.getChat("getGroupChat","1"),this.temShareMsg=t;break;case"videoSend":this.parentSend=!0,this.showShare="",this.getChat("getGroupChat","single"==i?"0":"1"),this.temShareMsg={desc:"",thumbUrl:"http://useoss.51talk.com/images/5C84hnaJsdmJpzadXiiW.jpg",title:"\u89c6\u9891\u5206\u4eab",urlStr:t.url.replace(/^http:.+com/,"http://useoss.51talk.com")}}},shareArticleBtn:function(){var t=this;wxHeck.getData({url:"/CircleFriend/publishShareArticle",data:{title:t.shareArticle.title,introduction:t.shareArticle.desc,icon:t.shareArticle.icon,link:t.shareArticle.urlStr||t.shareArticle.videoUrl,shareword:t.shareArticle.dig},success:function(e){1e4!=e.status&&_alert(e.message),_alert(e.message),t.shareArticle.show=!1}})},hideShareBtn:function(){this.shareArticle.show=!1},inviteGroupMem:function(t){var e=this;_confirm("\u786e\u5b9a\u63a5\u53d7\u9080\u8bf7\u8fdb\u7fa4\u5417\uff1f",function(){console.log(t,e.wxData.curUserId),msgObj={id:localInfo.id,action:"invite_group_mem",type:"web",to_type:"ios",u_id:e.wxData.curUserId.split("$")[1],localMsgId:t},wxHeck.sendMsg(msgObj)})},addDelFriend:function(){this.addDelFriendInfo.nameTitle=wxHeck.checkUserType("",""),this.addDelFriendInfo.show=!0},sendAddFriendBtn:function(){msgObj={id:localInfo.id,action:"add_friend",type:"web",to_type:"ios",wxid:this.wxData.curUserId.split("$")[1],verify_msg:this.addDelFriendInfo.msg,user_id:"",mobile:"",remark:"",cnt_type:400},wxHeck.sendMsg(msgObj)},hideSendfriendBtn:function(){this.addDelFriendInfo.show=!1},showPersonalMask:function(){wxHeck.sendMsg({action:"user_info",type:"web",id:localInfo.id,to_type:"ios"}),this.personalInfo.personalMask=!0},hidePersonalMask:function(){this.personalInfo.personalMask=!1,this.personalInfo.id=this.personalInfo.qrcode_url=this.personalInfo.nick=""},copyImgOk:function(){this.personalInfo.copyWechatImg=!1},showCopyBtn:function(){this.personalInfo.copyImgBtn=!0},hideCopyBtn:function(){this.personalInfo.copyImgBtn=!1},copyImgBtn:function(){},copyWechatText:function(){},setGroupToClass:function(t){if("bind"==t)this.classGroupInfo.show=!0;else{var e=this;wxHeck.getData({url:"/UserWorkGroup/cancelBound",data:{group_id:e.wxData.curUserId.split("$")[1].split("@")[0]},success:function(t){return 1e4!=t.status?_alert(t.message):(_alert(t.message),void(e.classGroupInfo.bindBtn=!0))}})}},confirmClassGroup:function(t){if("yes"==t){var e=this;wxHeck.getData({url:"/UserWorkGroup/boundWorkClass",data:{wechat_id:localInfo.wechat_id,group_id:e.wxData.curUserId.split("$")[1].split("@")[0]},success:function(t){return 1e4!=t.status?_alert(t.message):void _alert(t.message)}}),this.classGroupInfo.show=!1,this.classGroupInfo.bindBtn=!1}else this.classGroupInfo.show=!1},showInfoFn:function(t){switch(t){case"recent":this.showInfo.recent=!this.showInfo.recent;break;case"last":this.showInfo.last=!this.showInfo.last}},checkTea:function(t,e){var i=e.crmInfo;i||_alert("\u8be5\u5b66\u5458\u672a\u88ab\u7ed1\u5b9a\uff01"),wxHeck.getData({url:"/Ifttt/AbsenceJudgment",data:{user_id:i.user_id,wechat_id:t},success:function(t){return 1e4!=t.status?_alert(t.message):void 0}})}},events:{changeLabel:function(t){var e=wxHeck.labelFn,i=this.wxData.msgList[t.wechatId].userInfo.label,s=$.map(t.labelData,function(t,i){return e.idMap[t].tag_name});""==i?i=s:(i=i.split(","),i=$.map(i,function(t,i){return t in e.nameMap?void 0:t}),i=i.concat(s)),wxHeck.sendMsg({action:"modify_label",u_id:t.wechatId,id:localInfo.id,type:"web",labels:i.join(",")})},reGetMyStudy:function(){this.myStudy()},getSelList:function(t){this.setGroupChat.list=t},getAt:function(t,e,i){-1==$.inArray(e,this.at_id)&&this.at_id.push(e),this.wxData.msgList[this.wxData.curUserId].msgContent+=" @"+t+" ",i&&(this.wxData.msgList[this.wxData.curUserId].msgContent+=i)},oneChat:function(t){var e={id:localInfo.id,action:"is_myfriend",type:"web",to_type:"ios",wxid:t};wxHeck.sendMsg(e)},groupListUserDelete:function(t){var e=t.groupUserWechat_id.split("$");if(console.log(e),e[0]==e[1])return void _alert("\u4e0d\u80fd\u8e22\u51fa\u81ea\u5df1");var i=this.wxData.curUserId.split("$")[1];_confirm("\u5c06\u7fa4\u6210\u5458\u3010"+t.groupUserWechat_nick+"\u3011\u5220\u9664\uff1f",function(){wxHeck.sendMsg({action:"del_group_mem",u_id:i,type:"web",wxids:t.groupUserWechat_id,id:localInfo.id})})},getSelData:function(t){this.$broadcast("setSelData",t)},setListType:function(t){this.userListType=t},userLogoutTrust:function(t){wxHeck.getData({url:"/AdminContact/saveSelfWechat",data:{wechat_id:t,admin_id:localInfo.id},success:function(e){return 1e4!=e.status?alert(r.message):void wxHeck.sendMsg({action:"chat_trust_set",id:localInfo.id,type:"web",trust_id:t})}})},getSendPaste:function(t){var e=this,i=t.imgSrc;wxHeck.getData({url:"/UploadFile/screenImg",data:{file_base64:i,admin_id:localInfo.admin_id,wechat_id:localInfo.wechat_id},success:function(t){if(1e4==t.status){var s={action:"chat",id:localInfo.id,type:"web",to_id:e.wxData.curUserId,to_type:"ios",content:t.message,cnt_type:1};if(e.setGroupChat.flag)return e.sendGroupChat(s),void e.$broadcast("hideSendPaste");wxHeck.pushMsg({pushId:e.wxData.curUserId,isCC:!0,msg:[i,t.message],time:(new Date).getTime(),cnt_type:9999}),wxHeck.sendMsg(s),e.$broadcast("hideSendPaste")}else alert("\u4e0a\u4f20\u5931\u8d25\u8bf7\u91cd\u8bd5\uff01"),e.$broadcast("enableSendPaste")},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01"),e.$broadcast("enableSendPaste")}})},addFriendNextCb:function(t){var e={id:localInfo.id,action:"find_contact_keywd",type:"web",to_type:"ios",keyword:t.keyword};wxHeck.sendMsg(e)},addFriendCb:function(t){var e={0:"add_friend",1:"add_card_friend"},i={id:localInfo.id,action:e[t.type],type:"web",to_type:"ios",wxid:t.wxid,verify_msg:t.verify_msg,user_id:t.user_id,mobile:t.mobile,remark:t.remark};wxHeck.sendMsg(i),wxHeck.getData({url:"/WechatUserInfo/addUserInfo",data:{stu_id:t.user_id,wechat_id:t.wxid,mobile:t.mobile},success:function(t){console.log("\u8bb0\u5f55\u5f53\u524d\u5b66\u5458\u6dfb\u52a0\u8005\u4fe1\u606fOK")},error:function(){}})},addListFriend:function(t,e,i,s){this.$broadcast("showAddFriend",{type:0,acc:t,crmMobile:t,crmId:e,addType:i,trialStatus:s})},getFace:function(t){if(0==t.type){var e=wxHeck.getTextPos();if(!e)return;var i=t.con,s=e.startPos,n=e.endPos,a=s,o=this.wxData.msgList[this.wxData.curUserId].msgContent,r=o.slice(0,s)+i+o.slice(n);this.wxData.msgList[this.wxData.curUserId].msgContent=r,this.$nextTick(function(){e.setPos(a+i.length)})}},infoUpdateCb:function(t){$.extend(this.wxData.localInfo,t),this.$broadcast("hideUpdate")},getSearch:function(t){wxHeck.toTop(t),this.changeUser(t),wxHeck.userBoxTop()},getQuickCon:function(t){var e=this,i=wxHeck.Util.conRegArr,s={},n=e.wxData,a=n.msgList[wxHeck.wxInit.wxData.curUserId].crmInfo,o=[n.localInfo.nick_name,a.member?4==a.selectMember?"":a.member[a.selectMember]:a.member,a.nick_name],r=t.replace(/{[^{}]*}/,"");$.map(i,function(t,e){s[t]=o[e]}),e.wxData.msgList[this.wxData.curUserId].msgContent=wxHeck.Util.conFilter(r,s)},userSelSure:function(t){var e=this;"getGroup"==t.openType?_confirm("\u9ed1\u9e1f\u4e0d\u4f1a\u9650\u5236\u7fa4\u53d1\uff0c\u4f46\u9891\u7e41\u7fa4\u53d1\u4f1a\u88ab\u5fae\u4fe1\u9650\u5236\uff0c\u800c\u4e14\u5b66\u5458\u4e5f\u4e0d\u559c\u6b22\u7ecf\u5e38\u6536\u5230\u548c\u8425\u9500\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f60\u662f\u5426\u8981\u6025\u9700\u7fa4\u53d1\uff1f",function(){e[t.openType+"Par"](t.returnData)}):e[t.openType+"Par"](t.returnData)},editNameSure:function(t){console.log(t),this.$broadcast("editNameClose"),"nicker"==t.nickInfo?wxHeck.sendMsg({id:localInfo.id,action:"modify_self_groupname",type:"web",u_id:this.wxData.curUserId.split("$")[1],to_type:"ios",displayname:t.editValue}):wxHeck.sendMsg({id:localInfo.id,action:t.isGroup?"modify_name":"modify_remark",type:"web",to_id:this.wxData.curUserId,to_type:"ios",new_name:t.editValue})},crmRemarkTableOpen:function(t){this.$broadcast("crmRemarkOpen",{user_id:t})},callTelpnone:function(t,e){wxHeck.getData({url:"/Call/handCall/",data:{user_id:t,wechat_id:localInfo.wechat_id},success:function(t){1e4!=t.status?alert(t.message):_alert("\u62e8\u6253\u6210\u529f\uff01")}})},studyChat:function(t){wxHeck.toTop(localInfo.wechat_id+"$"+t),this.changeUser(localInfo.wechat_id+"$"+t),wxHeck.userBoxTop()},changePage:function(t){this.$broadcast("pageOK",t)}},watch:{userListType:function(t){var e=this;"todayFocus"==t&&wxHeck.getData({url:"/UserContact/getFollowUserDate",success:function(t){if(1e4!=t.status)return!1;for(var i=t.message.length,s=[],n=0;i>n;n++)s.push(localInfo.wechat_id+"$"+t.message[n].wechat_id);e.todayFocusUser=s}})},noReadAll:function(t){t>0?wxHeck.flashTitleFn.set("\u60a8\u6709\u65b0\u7684\u6d88\u606f\uff01"):wxHeck.flashTitleFn.reset()}},created:function(){$(document).on("visibilitychange",function(){if(!document.hidden){var t=this.wxData,e=t.curUserId;if(e){var i=t.msgList[e].noRead;if(0!=i){var s=$(".content_message")[0];if(s){var n=s.clientHeight==s.scrollHeight;n&&(t.msgList[e].noRead=0,this.noReadAll-=i,wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:e}))}}}}}.bind(this))}}),function(){wxHeck.entered=!1,wxHeck.wb=function(){return e.WebSocket||e.MozWebSocket}(),wxHeck.wb&&(wxHeck.sendMsg=function(t){if(wxHeck.isHelper()){var e={};switch(t.action){case"chat":e={to_type:"helper",name:localInfo.admin_name,helper_fg:"1"}}$.extend(t,e)}wxHeck.wb.OPEN==wxHeck.socket.readyState?wxHeck.socket.send(JSON.stringify(t)):console.log("The socket is not open.")},wxHeck.msgHandler=new function(){var t=this;t.heartbeat=function(t){wxHeck.heartbeat=0},t.enter=function(t){wxHeck.enterTime=t.time||(new Date).getTime(),wxHeck.wxInit.$broadcast("setErrors",{netErr:!1,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.heartbeat=0,clearInterval(wxHeck.interVal),wxHeck.interVal=window.setInterval(function(){wxHeck.heartbeat>=3?(wxHeck.wxInit.$broadcast("setErrors",{netErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.socket.close()):(wxHeck.sendMsg({action:"heartbeat",id:localInfo.id,type:"web"}),wxHeck.heartbeat++)},5e3)},t.ios_online=function(){wxHeck.wxInit.$broadcast("setErrors",{phoneErr:!1,iscc:wxHeck.isCC(),isss:wxHeck.isSS()}),wxHeck.getUserList()},t.ios_offline=function(){wxHeck.wxInit.$broadcast("setErrors",{phoneErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()})},t.find_contact_keywd=function(t){wxHeck.wxInit.$broadcast("addFriendToNext",t)},t.add_friend=t.add_card_friend=function(t){wxHeck.getData({url:"/UserContact/addFriendAndRmark",data:{admin_id:localInfo.id,user_id:wxHeck.wxInit.$refs.addfriend.crmId},success:function(){wxHeck.wxInit.$refs.addfriend.addType&&wxHeck.wxInit.$broadcast("studySearch")},error:function(){}}),wxHeck.wxInit.$broadcast("hideAddFriend"),wxHeck.wxInit.$root.$data.addDelFriendInfo.show=!1},t.remove_users=function(t){var e=$.inArray(t.wxid,wxHeck.dataSource.userList),i=e==wxHeck.dataSource.userList.length-1?e-1:e+1,s=wxHeck.dataSource.userList[i];wxHeck.dataSource.userList.$remove(t.wxid),wxHeck.dataSource.userListPerson.$remove(t.wxid),wxHeck.wxInit.changeUser(s),_alert("\u5220\u9664\u6210\u529f\uff01")},t.group_user_list=function(t){Vue.set(wxHeck.dataSource.groupUserLists,t.from_id,t.list)},t.group_ownner_id=function(t){wxHeck.dataSource.groupFromId=t.from_id,wxHeck.dataSource.groupOwnner=t.owner_id},t.add_group_mem=function(t){$.map(t.infoList,function(e,i){wxHeck.dataSource.groupUserLists[t.from_id].push(e)})},t.del_group_mem=function(t){wxHeck.wxInit.$broadcast("delGroupListUser",t)},t.is_contact_in_grouparray=function(t){var e=t.result,i=wxHeck.getFullId(t.groupdata.id);wxHeck.wxInit.wxData.msgList[i].showHW=e},t.add_helper=t.user_list=t.add_users_res=function(e){!function(){if(1e4!=e.action_type){var i="add_users_res"==e.action,s="user_list"==e.action,n="add_helper"==e.action;if(function(t,e){$.map(t,function(t,s){var a=t.id,o=t.time,r=t.mute_session;r&&wxHeck.dataSource.muteList.push(a);var c=!!o&&o>0,u=t.num,d=1==t.c_type,l=2==t.c_type;if(a in e)return!0;if(c&&!r&&(wxHeck.wxInit.noReadAll+=u),t.label||(t.label=""),t.labelOpen=!1,Vue.set(e,a,{showHW:999,at_fg:0,atshow:!1,userInfo:t,userMsg:[],noRead:c?u:0,lastMsg:"",msgContent:"",crmInfo:{isGet:!1},historyMsg:{isGetAll:!1,score:wxHeck.enterTime},time:o,isGroup:d,isTop:!1,isGroupOwner:!1}),i)wxHeck.toTop(a),wxHeck.userBoxTop();else{var h=!c||t.mute_session?"push":"unshift";wxHeck.dataSource.userList[h](a)}n||l||wxHeck.dataSource[d?"userListGroup":"userListPerson"].push(a)}),wxHeck.wxInit.userProgress.isFirst&&(wxHeck.wxInit.userProgress.isFirst=!1)}(e.list,wxHeck.dataSource.msgList),s){wxHeck.sendMsg({action:"top_session_list",id:localInfo.id,type:"web"});var a=wxHeck.wxInit.wxData,o=localInfo.wxHelper;o||(o=localInfo.wxHelper=[]),$.map(o,function(t,e){a.helpList.push(t.id)}),t.add_helper({action:"add_helper",list:o})}n&&wxHeck.sendMsg({action:"chat_helper_msg_st",id:localInfo.id,type:"web",to_ids:wxHeck.wxInit.wxData.helpList.join(",")})}}()},t.chat_helper_msg_st=function(t){var e=t.list;0!=e.length&&$.map(e,function(t,e){var i=wxHeck.wxInit.wxData.msgList[t.id];i&&(i.noRead=t.num,i.time=t.time)})},t.modify_name=function(t){var e=t.from_id;wxHeck.dataSource.msgList[e].userInfo.nick=wxHeck.dataSource.msgList[e].userInfo.c_remark=t.new_name},t.modify_remark=function(t){var e=t.from_id;wxHeck.dataSource.msgList[e].userInfo.c_remark=t.c_remark,wxHeck.wxInit.getCrmInfo()},t.modify_label=function(t){wxHeck.dataSource.msgList[t.from_id].userInfo.label=t.labels},t.chat=function(t){if(3100==t.cnt_type){var e=JSON.parse(t.content),i=wxHeck.wxInit;i.wxData.msgList[t.from_id].at_fg=parseInt(e.at_fg),i.wxData.msgList[t.from_id].atshow=!0}!function(){var e=t.from_id==localInfo.id,i=e?t.to_id:t.from_id;if(wxHeck.wxInit.wxData.msgList[i]){!function(){if(0==t.cnt_type&&!e){var s=new RegExp("\u8001\u5e08\u6ca1\u6765|\u8001\u5e08\u7f3a\u5e2d");t.content.search(s)<0||wxHeck.getData({url:"/Ifttt/sendCustMessage",data:{wechat_id:i,admin_id:localInfo.id,cust_type:"1"},success:function(){},error:function(){}})}}();var s=function(){var t=$(".content_message")[0];return t?t.scrollTop+t.clientHeight<t.scrollHeight:!1}(),n=wxHeck.wxInit.wxData.curUserId!=i&&!e,a=function(){var e=4e3==t.cnt_type||5e3==t.cnt_type;return e&&wxHeck.wxInit.wxData.curUserId!=i||e&&wxHeck.wxInit.wxData.curUserId==i&&s}(),o=wxHeck.wxInit.wxData.curUserId==i&&!e&&s,r=wxHeck.wxInit.wxData.curUserId==i&&document.hidden;(n||a||o||r)&&(5e3!=t.cnt_type||"is"!=localInfo.admin_type&&"2"!=localInfo.user_group&&"4"!=localInfo.user_group&&"6"!=localInfo.user_group&&1!=t.visible?(wxHeck.wxInit.wxData.msgList[i].noRead++,wxHeck.wxInit.wxData.msgList[i].userInfo.mute_session||wxHeck.wxInit.noReadAll++):console.log("SS\uff0cCST\u6d88\u606f\u4e0d\u63d0\u9192\uff01"),wxHeck.toTop(i)),wxHeck.wxInit.wxData.curUserId!=i||e||o||r||wxHeck.sendMsg({action:"chat_ok",id:localInfo.id,type:"web",to_id:i});var c=function(t){return t?t[0].scrollTop==t[0].scrollHeight-t[0].clientHeight:!1}(wxHeck.msgBox);wxHeck.pushMsg({pushId:i,isCC:e,msg:t.content,gotoBottom:c,time:t.time,name:t.name,c_remark:t.c_remark,cnt_type:t.cnt_type,source:t})}}()},t.receive_wcmsg=function(t){wxHeck.wxInit.wxData.comment=t.number},t.get_version=function(t){wxHeck.dataSource.clientVersion=t.client_version,wxHeck.dataSource.cloudVersion=t.cloud_version,wxHeck.dataSource.wechat_version=t.wechat_version||""},t.chat_trust_set=function(){_alert("\u6258\u7ba1\u6210\u529f\uff01"),wxHeck.Util.closeTab()},t.is_myfriend=function(t){wxHeck.wxInit.isMyFriend(t)},t.hello_number=function(t){wxHeck.wxInit.newFriCount=t.number},t.hello_list=function(t){wxHeck.wxInit.$broadcast("myFriendData",t.arr)},t.add_hello_friend=function(t){wxHeck.wxInit.$broadcast("myFriendSure",t.encryptusername)},t.top_session_list=function(t){var e=localInfo.wechat_id+"$",i=$.map(t.list,function(t,i){var s=e+t,n=wxHeck.wxInit.wxData.userList.$remove(s);return n?s:void 0}),s=$.map(wxHeck.wxInit.wxData.helpList,function(t,e){var i=wxHeck.wxInit.wxData.userList.$remove(t);return i?t:void 0}),n=s.concat(i.concat(wxHeck.wxInit.wxData.userList));wxHeck.wxInit.wxData.userList=n,wxHeck.wxInit.wxData.topList=i},t.receive_file=function(t){console.log(t)},t.user_info=function(t){wxHeck.wxInit.$root.$data.personalInfo.id=void 0==t.id?"":t.id,wxHeck.wxInit.$root.$data.personalInfo.wechat_username=void 0==t.wechat_username?"":t.wechat_username,wxHeck.wxInit.$root.$data.personalInfo.img=void 0==t.img?"":t.img,wxHeck.wxInit.$root.$data.personalInfo.nick=void 0==t.nick?"":t.nick,wxHeck.wxInit.$root.$data.personalInfo.qrcode_url=void 0==t.qrcode_url?"":t.qrcode_url},t.change_chatroom_owner=function(t){wxHeck.wxInit.$broadcast("changeOwnerOk")},t.mute_session=function(t){1==t.mute_session?(_alert("\u5c4f\u853d\u7fa4\u6d88\u606f\u8bbe\u7f6e\u6210\u529f"),wxHeck.dataSource.muteList.push(t.from_id)):(_alert("\u5f00\u542f\u7fa4\u6d88\u606f\u6210\u529f"),wxHeck.dataSource.muteList.$remove(t.from_id)),wxHeck.wxInit.wxData.msgList[t.from_id].userInfo.mute_session=1==t.mute_session},t.top_chat_session=function(t){wxHeck.wxInit.wxData.msgList[t.from_id].userInfo.set_to_top=1==t.set_to_top},t.modify_self_groupname=function(t){var e=wxHeck.wxInit.wxData.groupUserLists[t.from_id];$.map(e,function(i,s){i.wechat_id.split("$")[1]==localInfo.wechat_id&&(e[s].wechat_nick=t.displayname)})},t.get_contact_details=function(t){wxHeck.wxInit.$broadcast("showCutUserLayer",{details:t.details})},t.allow_owner_approve=function(t){console.log(t.allow_owner_approve_value),wxHeck.wxInit.wxData.msgList[t.from_id].userInfo.allow_owner_approve_value=1==t.allow_owner_approve_value},t.quit_chatroom=function(t){var e=$.inArray(t.wxid,wxHeck.dataSource.userList),i=e==wxHeck.dataSource.userList.length-1?e-1:e+1,s=wxHeck.dataSource.userList[i];wxHeck.dataSource.userList.$remove(t.wxid),wxHeck.dataSource.userListGroup.$remove(t.wxid),wxHeck.wxInit.changeUser(s),_alert("\u9000\u51fa\u7fa4\u804a\u6210\u529f\uff01")}},function(){return wxHeck.args=arguments,wxHeck.wsHost=function(){return localInfo.isLocal?"ws://172.16.0.92:8801/websocket":localInfo.ws_host?"ws://"+localInfo.ws_host+"/websocket":void 0}(),wxHeck.wsHost?(wxHeck.socket=new wxHeck.wb(wxHeck.wsHost),wxHeck.socket.onopen=function(t){wxHeck.entered=!0,clearInterval(wxHeck.interFirstEnter),wxHeck.sendMsg({action:"enter",id:localInfo.id,type:"web",v_code:localInfo.v_code})},wxHeck.socket.onclose=function(t){console.log("The socket is closed")},wxHeck.socket.onerror=function(){wxHeck.wxInit.$broadcast("setErrors",{netErr:!0,iscc:wxHeck.isCC(),isss:wxHeck.isSS()})},void(wxHeck.socket.onmessage=function(t){var e=JSON.parse(t.data);if("web_update_msg"==e.action)return void _alert("\u6709\u65b0\u7248\u672c\u4e0a\u7ebf\uff0c\u8bf7\u5237\u65b0\u6d4f\u89c8\u5668\u66f4\u65b0",function(){window.location.reload(!0)});if("proc_comp"==e.action)return void(1e4==e.status?wxHeck.wxInit.$broadcast("hwSetSuccess"):wxHeck.wxInit.$broadcast("hwSetFail",e.msg));if(10005==e.status&&"enter"==e.action)return clearInterval(wxHeck.interVal),void(1==localInfo.is_trust?(alert("\u6258\u7ba1\u8eab\u4efd\u88ab\u53d6\u6d88\uff01"),wxHeck.Util.closeTab()):wxHeck.dataSource.repeatEnter=!0);if(e.status&&2e4==e.status&&"find_contact_keywd"==e.action){var i=wxHeck.wxInit.$refs.addfriend;if(i.addType&&i.crmId)return void wxHeck.getData({url:"/WechatUserInfo/getUserInfoByUserId",data:{stu_id:i.crmId},success:function(t){return 1e4!=t.status?alert(t.message):void(t.message&&t.message.wechat_id?(_alert("\u4e0a\u4e00\u4e2a\u624b\u673a\u53f7\u672a\u641c\u7d22\u5230\u5fae\u4fe1\u53f7\uff0c\u7cfb\u7edf\u4eceCRM\u5e93\u4e2d\u6362\u4e00\u4e2a\u624b\u673a\u53f7\u7ee7\u7eed\u641c\u7d22\u3002"),i.wxAcc=t.message.wechat_id):_alert(e.message))}})}if(e.status&&2e4==e.status&&"add_friend"==e.action){var i=wxHeck.wxInit.$refs.addfriend,s=localInfo.wechat_id+"$"+e.wxid;if(i.addType){var n=i.crmId;wxHeck.getData({url:"/UserContact/addUserWechatContact",data:{wechat_id:s,user_id:n},success:function(t){return 1e4!=t.status?alert(t.message):(_alert("\u5b66\u5458\u5df2\u5728\u4f60\u7684\u597d\u53cb\u5217\u8868\u4e2d\uff0c\u73b0\u5df2\u6210\u529f\u7ed1\u5b9a\uff01"),wxHeck.sendMsg({id:localInfo.id,action:"modify_remark",type:"web",to_id:s,to_type:"ios",new_name:i.remark}),wxHeck.wxInit.getCrmInfo(!0,s),i.addFriendHide(),void wxHeck.wxInit.$broadcast("studySearch"))}})}else _alert(e.message),i.addFriendHide(),wxHeck.toTop(s)}else{if(e.status&&1e4!=e.status){var a=e.message||e.msg;return _alert(a)}"function"==typeof wxHeck.msgHandler[e.action]&&wxHeck.msgHandler[e.action](e)}})):void(window.confirm("\u8fde\u63a5\u5931\u8d25\uff0c\u5237\u65b0\u91cd\u8bd5\uff1f")&&window.location.reload())}())}()}(window)});