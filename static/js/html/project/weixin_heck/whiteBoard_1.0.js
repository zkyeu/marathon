const img_backGIMG="",img_read="",img_start="",openCon={pencil:!0,highPencil:!0,rect:!0,text:!0,rubberOld:!0,seal:!0,back:!0,clear:!0,rubberNew:!0,draft:!0,reEdit:!0,firstTool:"pencil",baseSize:800,parentID:"paintCon",canvasID:"canvasRes",canvasBakID:"canvasBak",canvasBakImgID:"canvasBakImg",canvasImgID:"canvasImg"};var confInfo={pencil:{color:"#FF0000",size:3},highPencil:{color:"#FF0000",size:20,alpha:.5},rect:{color:"#FF0000",size:3},text:{fontStyle:"songti",fontSize:30,fontColor:"#FF0000",minSize:16},rubberOld:{size:30},seal:{width:30,height:30,type:"star",source:img_start},targetSelect:{color:"#0000FF"},background:{module:"default",source:img_backGIMG}};!function(t,e){t.getTimeNow=function(){var t=new Date,e=t.toLocaleTimeString()+" "+t.getMilliseconds()+"ms";return e};var a=function(t){return t>confInfo.text.minSize?t:confInfo.text.minSize};t.WBSdk=function(){var n=[],o={conf:{type:"stu",pauseDraw:!1,paintModule:"draw",version:"old",canvas:{parentCon:null,target:null,targetContext:null,targetImg:null,targetImgContext:null,centerPX:0,centerPY:0,targetBak:null,targetBakContext:null,width:0,height:0,left:0,top:0,seal:{curType:"",img:{}}},paintBoard:{input:null,edit:null,inputBak:null,editBak:null},cssInfo:{input:{"min-width":"0px",_width:"0px","min-height":"0px",_height:"0px",display:"none",position:"absolute",overflow:"hidden"},edit:{border:"0px","background-color":"transparent",cursor:"text","word-break":"break-all","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden",margin:"0px 0px 0px 0px"},inputBak:{"z-index":"-1",position:"absolute","min-width":"0px",_width:"0px","min-height":"0px",_height:"0px"},editBak:{width:"0px",border:"0px","word-break":"break-all","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden",position:"relative",margin:"0px 0px 0px 0px"}}},isInited:!1,recordConArr:[],orderList:[],svcId:1,curBackGIMG:{module:"",source:""},curDrawType:"pencil",curTarget:null,downEvent:!1,outEvent:!1,colorChange:!1,colorName:"",colorChangeId:-1,sealData:{drag:null,dragId:"sealDataDrag",dragImgId:"sealImgDrag",dragOuterId:"sealDataDragOuter",config:{},min:50,getDrag:function(t){var a=this;e.extend(a.config,t);var n=a.config,r=e('<div id="'+a.dragOuterId+'"></div>'),i=e("<div tabIndex=-1></div>"),c=e('<img id="'+a.dragImgId+'" src="'+confInfo.seal.source+'" alt="" />'),s=e('<span id="'+a.dragId+'"></span>');r.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",zIndex:5}),i.css({position:"absolute",left:n.margin_left,top:n.margin_top,outline:"none",boxShadow:"0 0 0 1px #fff"}),c.css({width:n.width,height:"auto",verticalAlign:"middle"}),s.css({width:4,height:"100%",background:"#fcc800",position:"absolute",right:-2,top:"0",borderRadius:"999px",cursor:"e-resize"}),i.append(c).append(s),r.append(i),o.conf.canvas.target.parentNode.appendChild(r[0]),i.focus(),a.bindEvent(a,r,i)},bindEvent:function(t,e,a){t.bindInner(t,e,a),t.bindOuter(t,e,a)},bindOuter:function(t,a,n){var o,r,i,c=!1,s=this,l=(e(s.dragId),e(document));l.on({"mousedown.k":function(t){var e=t.target;if(e)switch(e.id){case s.dragId:c=1;var l=a.offset().left+a.outerWidth()-n.offset().left,d=(a.offset().top+a.outerHeight()-n.offset().top)*(n.outerWidth()/n.outerHeight());o=Math.floor(Math.min(l,d))-1;break;case s.dragImgId:c=2,r=t.clientX-n.offset().left,i=t.clientY-n.offset().top}},"mousemove.k":function(e){switch(c){case 1:var s=e.clientX-n.offset().left;s<t.min&&(s=t.min),s>o&&(s=o),n.find("img").width(s);break;case 2:var s=e.clientX-a.offset().left-r,l=e.clientY-a.offset().top-i;1>s&&(s=1),1>l&&(l=1);var d=a.outerWidth()-n.outerWidth();s>d&&(s=d-1);var p=a.outerHeight()-n.outerHeight();l>p&&(l=p-1),t.config.margin_left=s,t.config.margin_top=l,n.css({left:s,top:l})}return!1},"mouseup.k":function(){return c=!1,!1},"mouseleave.k":function(){return c=!1,!1}})},bindInner:function(t,e,a){a.on("blur",function(){t.setLocal(t.config.sealType,a.width(),a.height()),t.drawSeal(t,e,a)})},drawSeal:function(t,e,a){var n=t.config;if(""!=o.conf.canvas.seal.curType&&o.conf.canvas.seal.img[o.conf.canvas.seal.curType]){var r={handleType:0,drawingType:20,id:o.svcId,specialValue:{owner:o.conf.type,width:a.width(),height:a.height(),sealType:n.sealType,canvasWidth:o.conf.canvas.width,canvasHeight:o.conf.canvas.height,child_div_W:a.width(),child_div_H:a.height(),margin_left:n.margin_left,margin_top:n.margin_top}};o.showPaint(r),e.remove()}},setLocal:function(t,e,a){return},getLocal:function(t){return}},dragData:{initialLeft:0,initialTop:0},textData:{signTextDrag:!1,signREdit:!1,inputBorder:0,inputMaxWid:0,inputMaxHei:0,fontSize:0,textInput:"",lastTextInput:"",pointXTD:0,pointYTD:0,pointLeftTD:0,pointTopTD:0},mouseData:{startX:0,startY:0,nowX:0,nowY:0,endX:0,endY:0,minX:0,minY:0,maxX:0,maxY:0,pointArr:[]},commentText:"",initWEBTools:function(a){try{var r=["pencil","highPencil","rect","text","rubberOld","seal","back","clear","reEdit","rubberNew","rubberNew","draft"];if(e.each(r,function(t,e){openCon[e]===!0&&n.push(e)}),(openCon.reEdit||openCon.rubberNew||openCon.draft)&&(o.conf.version="new"),o.conf.canvas.parentCon=e("#"+openCon.parentID),o.conf.canvas.target=document.getElementById(openCon.canvasID),o.conf.canvas.targetBak=document.getElementById(openCon.canvasBakID),o.conf.canvas.targetImg=document.getElementById(openCon.canvasImgID),o.conf.canvas.targetImg.style.visibility="hidden",o.conf.canvas.targetContext=o.conf.canvas.target.getContext("2d"),o.conf.canvas.targetBakContext=o.conf.canvas.targetBak.getContext("2d"),o.conf.canvas.targetImgContext=o.conf.canvas.targetImg.getContext("2d"),o.conf.canvas.canvasBakImg=e("#"+openCon.canvasBakImgID),o.conf.canvas.parentCon.css("overflow","hidden"),e("#"+openCon.canvasID).css({position:"absolute",top:"0px",left:"0px","z-index":1}),e("#"+openCon.canvasBakID).css({position:"absolute",top:"0px",left:"0px","z-index":2}),e("#"+openCon.canvasImgID).css({position:"absolute"}),o.conf.paintBoard.input=e('<div id="input" autofocus="autofocus" tabindex="-1"></div>').appendTo(o.conf.canvas.parentCon),o.conf.paintBoard.edit=e('<span id="edit" contenteditable="true"></span>').appendTo(o.conf.paintBoard.input),o.conf.paintBoard.inputBak=e('<div id="inputBak"></span><div>').appendTo(o.conf.canvas.parentCon),o.conf.paintBoard.editBak=e('<span id="editBak">').appendTo(o.conf.paintBoard.inputBak),o.conf.paintBoard.input.css(o.conf.cssInfo.input),o.conf.paintBoard.edit.css(o.conf.cssInfo.edit),o.conf.paintBoard.inputBak.css(o.conf.cssInfo.inputBak),o.conf.paintBoard.editBak.css(o.conf.cssInfo.editBak),o.commentText="","draw"==o.conf.paintModule)if(o.conf.paintBoard.edit.on("keyup",function(t){o.key_event(document.getElementById("edit"),t)}),o.conf.paintBoard.edit.on("keydown",function(t){o.key_event(document.getElementById("edit"),t)}),o.draw(o.curDrawType),o.bindEvent(e("#"+openCon.canvasBakID)),o.bindEvent(o.conf.paintBoard.input),""!=openCon.firstTool){if(-1===n.indexOf(openCon.firstTool))return void console.error("[ %s ]---------------------------------> error happened when init default tool , unopened tool is used to init current tool : %s",t.getTimeNow(),openCon.firstTool);o.draw(openCon.firstTool),console.log("[ %s ]---------------------------------> init default tool : %s",t.getTimeNow(),openCon.firstTool)}else console.warn("[ %s ]---------------------------------> there is no default tool type when init default tool!",t.getTimeNow());o.drawBackImg(),o.review(o.conf.canvas.parentCon.width(),o.conf.canvas.parentCon.height()),o.isInited=!0,o.quickDownCb=a.quickDownCb||function(){},o.quickUpCb=a.quickUpCb||function(){}}catch(i){return void console.error("[ %s ]---------------------------------> error happened when init canvas data : %s",t.getTimeNow(),i)}},review:function(t,e){o.conf.paintBoard.input&&"none"!=o.conf.paintBoard.input.css("display")&&o.write_end();var a=o.conf.canvas.target,n=o.conf.canvas.targetBak;a.width=t,a.height=e,n.width=t,n.height=e,o.conf.paintBoard.inputBak.css("top",e+"px");var r=o.conf.canvas.parentCon.offset();o.conf.canvas.width=t,o.conf.canvas.height=e,o.conf.canvas.left=r.left,o.conf.canvas.top=r.top,o.repaint()},bindEvent:function(t){t.unbind(),t.bind("mousedown",o.mousedown),t.bind("mousemove",o.mousemove),t.bind("mouseup",o.mouseup),t.bind("mouseout",o.mouseout)},drawBackImg:function(e,a,n,r){if("function"==typeof e?(r=e,e=o.conf.canvas.width):e=e||o.conf.canvas.width,"function"==typeof a?(r=a,a=o.conf.canvas.height):a=a||o.conf.canvas.height,"function"==typeof n?(r=n,n=0):a=a||0,r)try{o.conf.pauseDraw=!0;var i=document.createElement("img");i.crossOrigin="",i.onload=function(){var t=o.conf.canvas.width,c=o.conf.canvas.height;o.conf.canvas.width=e,o.conf.canvas.height=a,o.conf.canvas.targetImg.width=e,o.conf.canvas.targetImg.height=a,function(){if(0==n)return void o.conf.canvas.targetImgContext.drawImage(i,0,0,e,a);var t=e/2,r=a/2;o.conf.canvas.targetImgContext.save(),o.conf.canvas.targetImgContext.translate(t,r),o.conf.canvas.targetImgContext.rotate(n*Math.PI/180),90==n||270==n?o.conf.canvas.targetImgContext.translate(-r,-t):180==n&&o.conf.canvas.targetImgContext.translate(-t,-r),o.conf.canvas.targetImgContext.drawImage(i,0,0),o.conf.canvas.targetImgContext.restore()}(),o.repaint(1,o.conf.canvas.targetImgContext),o.conf.canvas.width=t,o.conf.canvas.height=c;try{r({img:o.conf.canvas.targetImg.toDataURL("img/png"),text:o.commentText})}catch(s){r(s,"1"),o.conf.pauseDraw=!1}o.conf.pauseDraw=!1,editImgFn.loading.close()},i.onerror=function(t){o.drawBackImg(),o.repaint(),o.conf.pauseDraw=!1,r(t,"1")},i.src=confInfo.background.source}catch(c){console.error("[ %s ]---------------------------------> error happened when build current canvas to base64 images : %s",t.getTimeNow(),c)}else"default"===confInfo.background.module?o.conf.canvas.canvasBakImg.css({"background-image":'url("'+confInfo.background.source+'")',"background-size":"100% 100%","-moz-background-size":"100% 100%","-webkit-background-size":"100% 100%"}):"real"===confInfo.background.module&&o.conf.canvas.canvasBakImg.css({"background-image":'url("'+confInfo.background.source+'")',"background-size":"auto auto","-moz-background-size":"auto auto","-webkit-background-size":"auto auto"}),o.curBackGIMG.module=confInfo.background.module,o.curBackGIMG.source=confInfo.background.source},buildImg:function(t,e,a,n){return o.drawBackImg(t,e,a,n)},setSealIMG:function(e){e||console.warn("[ %s ]---------------------------------> there is no callback function,something will be wrong!",t.getTimeNow());try{(""!==confInfo.seal.source||""!==confInfo.seal.type)&&""!==confInfo.seal.source&&""!==confInfo.seal.type?o.conf.canvas.seal.img[confInfo.seal.type]?(o.conf.canvas.seal.curType=confInfo.seal.type,e&&e("success")):(o.conf.canvas.seal.img[confInfo.seal.type]=document.createElement("img"),o.conf.canvas.seal.img[confInfo.seal.type].onload=function(){o.conf.canvas.seal.curType=confInfo.seal.type,e&&e("success")},o.conf.canvas.seal.img[confInfo.seal.type].onerror=function(){o.conf.canvas.seal.img[confInfo.seal.type]=null,e&&e("error")},o.conf.canvas.seal.img[confInfo.seal.type].src=confInfo.seal.source):(e&&e("error"),console.error("[ %s ]---------------------------------> error happened when draw seal type : there is some confInfo for seal lost",t.getTimeNow()))}catch(a){e&&e("error"),console.error("[ %s ]---------------------------------> error happened when change seal's source : %s",t.getTimeNow(),a)}},draw:function(t,e){if("back"==t){if(0!=o.orderList.length){var a=o.orderList.pop();a&&o.handle_back(a)}e&&e("success")}else"clear"==t?(o.handle_clear(),e&&e("success")):(this.curDrawType=t,"seal"===t?o.setSealIMG(e):e&&e("success"))},mousedown:function(t){if(t=t||window.event||arguments.callee.caller.arguments[0],"function"==typeof o.quickDownCb&&o.quickDownCb(t,o),o.outEvent=!1,"draw"==o.conf.paintModule&&!o.conf.pauseDraw){var e=o.conf.canvas.targetBakContext,a=o.conf.canvas.width;o.conf.canvas.height;if("none"!=o.conf.paintBoard.input.css("display")&&"text"!=o.curDrawType){var r=(t.target||t.srcElement).id;"input"!=r&&"edit"!=r&&o.write_end()}o.downEvent=!0;var i=o.conf.canvas.parentCon.offset();if(o.conf.canvas.left=i.left,o.conf.canvas.top=i.top,o.mouseData.startX=Math.round(t.clientX+document.body.scrollLeft-o.conf.canvas.left),o.mouseData.startY=Math.round(t.clientY+document.body.scrollTop-o.conf.canvas.top),"rect"===o.curDrawType){var c=Math.round(confInfo.rect.size*a/openCon.baseSize);o.mouseData.startX=o.mouseData.startX-c>=0?o.mouseData.startX:c,o.mouseData.startY=o.mouseData.startY-c>=0?o.mouseData.startY:c}switch(o.mouseData.minX=o.mouseData.startX,o.mouseData.minY=o.mouseData.startY,o.mouseData.maxX=o.mouseData.startX,o.mouseData.maxY=o.mouseData.startY,o.mouseData.pointArr.length=0,o.curDrawType){case"pencil":var s=Math.round(confInfo.pencil.size*a/openCon.baseSize);e.strokeStyle=confInfo.pencil.color,e.lineWidth=s,e.moveTo(o.mouseData.startX,o.mouseData.startY),o.mouseData.pointArr.push({x:o.mouseData.startX,y:o.mouseData.startY}),e.beginPath();break;case"highPencil":e.moveTo(o.mouseData.startX,o.mouseData.startY),o.mouseData.pointArr.push({x:o.mouseData.startX,y:o.mouseData.startY}),e.save(),e.beginPath(),e.globalAlpha=confInfo.highPencil.alpha,e.globalCompositeOperation="xor",e.strokeStyle=confInfo.highPencil.color,e.lineWidth=confInfo.highPencil.size*a/openCon.baseSize;break;case"rect":var s=Math.round(confInfo.rect.size*a/openCon.baseSize);e.strokeStyle=confInfo.rect.color,e.lineWidth=s,e.moveTo(o.mouseData.startX,o.mouseData.startY),o.mouseData.pointArr.push({x:o.mouseData.startX,y:o.mouseData.startY});break;case"rubberOld":var l=confInfo.rubberOld.size;o.mouseData.pointArr.push({x:o.mouseData.startX,y:o.mouseData.startY}),e.clearRect(o.mouseData.startX-l/2,o.mouseData.startY-l/2,l,l);break;case"rubberNew":var d=o.curTarget;d&&(o.reInitColor(),d.color=confInfo.targetSelect.color,o.repaint());break;case"text":var p=t.target||t.srcElement;"input"==p.id?(o.textData.signTextDrag=!0,o.conf.paintBoard.edit.readOnly="true",o.conf.paintBoard.input.css({"min-width":o.conf.paintBoard.input.scrollWidth+"px","min-height":o.conf.paintBoard.input.scrollHeight+"px"}),t.preventDefault(),t.stopPropagation()):"edit"==p.id?(o.textData.signTextDrag=!1,o.conf.paintBoard.edit.readOnly="",t.stopPropagation()):"none"==o.conf.paintBoard.input.css("display")?-1!==n.indexOf("reEdit")&&null!=o.curTarget&&4==o.curTarget.drawingType?o.reEditText(t):o.write_start(o.mouseData.startX,o.mouseData.startY):(o.write_end(),o.clearConText(),o.textData.signTextDrag=!1);break;case"draft":o.curTarget&&10!=o.curTarget.drawingType&&(o.dragData.initialLeft=o.curTarget.drag_left,o.dragData.initialTop=o.curTarget.drag_top,o.curTarget.color=confInfo.targetSelect.color,o.curTarget.display=0,o.repaint(),o.curTarget.display=1,o.curTarget.handle(e,2));break;case"seal":}"text"!=o.curDrawType&&(t.preventDefault(),t.stopPropagation())}},mousemove:function(t){t=t||window.event||arguments.callee.caller.arguments[0],o.outEvent=!1;var e=o.conf.canvas.targetBakContext,a=o.conf.canvas.width,n=(o.conf.canvas.height,Math.round(t.clientX+document.body.scrollLeft-o.conf.canvas.left)),r=Math.round(t.clientY+document.body.scrollTop-o.conf.canvas.top);if(o.mouseData.nowX=n,o.mouseData.nowY=r,o.downEvent)switch(o.mouseData.minX=n<o.mouseData.minX?n:o.mouseData.minX,o.mouseData.maxX=n>o.mouseData.maxX?n:o.mouseData.maxX,o.mouseData.minY=r<o.mouseData.minY?r:o.mouseData.minY,o.mouseData.maxY=r>o.mouseData.maxY?r:o.mouseData.maxY,o.curDrawType){case"pencil":e.lineTo(n,r),e.stroke(),o.mouseData.pointArr.push({x:n,y:r});break;case"highPencil":e.lineTo(n,r),e.stroke(),o.mouseData.pointArr.push({x:n,y:r});break;case"rect":e.beginPath(),o.clearConText(),e.moveTo(o.mouseData.startX,o.mouseData.startY),e.lineTo(n,o.mouseData.startY),e.lineTo(n,r),e.lineTo(o.mouseData.startX,r),e.lineTo(o.mouseData.startX,o.mouseData.startY),e.lineTo(n,o.mouseData.startY),e.stroke();break;case"rubberOld":var i=confInfo.rubberOld.size;o.mouseData.pointArr.push({x:n,y:r}),o.conf.canvas.targetContext.clearRect(n-i/2,r-i/2,i,i);break;case"rubberNew":o.curTarget=o.e_search(n,r);var c=o.curTarget;o.reInitColor(),c&&(c.color=confInfo.targetSelect.color),o.repaint();break;case"text":o.textData.signTextDrag&&(o.conf.paintBoard.input.css({left:o.textData.pointXTD+n-o.mouseData.startX+"px",top:o.textData.pointYTD+r-o.mouseData.startY+"px"}),o.textData.pointLeftTD=o.textData.pointXTD+n-o.mouseData.startX,o.textData.pointTopTD=o.textData.pointYTD+r-o.mouseData.startY);break;case"draft":if(o.curTarget){o.clearConText();var s=o.curTarget.canvasWidth/a;o.curTarget.drag_left=Math.round((n-o.mouseData.startX)*s+o.dragData.initialLeft),o.curTarget.drag_top=Math.round((r-o.mouseData.startY)*s+o.dragData.initialTop),o.curTarget.handle(e,2)}break;case"seal":}else if(!o.conf.pauseDraw&&"new"==o.conf.version&&!o.textData.signREdit)if(o.curTarget=null,o.curTarget=o.e_search(n,r),o.curTarget){var l="rubberNew"==o.curDrawType,d="draft"==o.curDrawType&&10!=o.curTarget.drawingType,p="text"==o.curDrawType&&4==o.curTarget.drawingType,u=o.curTarget.id!=o.colorChangeId;(l||d||p)&&u&&(o.reInitColor(),o.colorChange=!0,4!=o.curTarget.drawingType?(o.colorName=o.curTarget.color,o.curTarget.color=confInfo.targetSelect.color):(o.colorName=o.curTarget.font_color,o.curTarget.font_color=confInfo.targetSelect.color),o.repaint(),o.colorChangeId=o.curTarget.id)}else o.colorChange&&(o.reInitColor(),o.repaint(),o.colorChange=!1,o.colorChangeId=-1);"text"!=o.curDrawType&&(t.preventDefault(),t.stopPropagation())},mouseup:function(t){if(t=t||window.event||arguments.callee.caller.arguments[0],!o.conf.pauseDraw&&o.downEvent){var e,n=o.conf.canvas.width,r=o.conf.canvas.height;"text"==o.curDrawType&&(e=o.inputRange(),o.conf.paintBoard.edit.focus()),o.downEvent=!1;var i=0,c=0;if(i=t.clientX?Math.round(t.clientX+document.body.scrollLeft-o.conf.canvas.left):o.mouseData.nowX,c=t.clientY?Math.round(t.clientY+document.body.scrollTop-o.conf.canvas.top):o.mouseData.nowY,"rect"===o.curDrawType){var s=Math.round(confInfo.rect.size*n/openCon.baseSize);i=i-s>=0?i:s,c=c-s>=0?c:s,i=i+s-o.conf.canvas.width<=0?i:o.conf.canvas.width-s,c=c+s-o.conf.canvas.height<=0?c:o.conf.canvas.height-s}"seal"===o.curDrawType?(i=i-confInfo.seal.width/2>0?i:confInfo.seal.width/2,c=c-confInfo.seal.height/2>0?c:confInfo.seal.height/2,i=n-i-confInfo.seal.width/2>=0?i:n-confInfo.seal.width/2,c=r-c-confInfo.seal.height/2>=0?c:r-confInfo.seal.height/2,i-=confInfo.seal.width/2,c-=confInfo.seal.height/2,o.mouseData.minX=i,o.mouseData.maxX=i+confInfo.seal.width,o.mouseData.minY=c,o.mouseData.maxY=c+confInfo.seal.height):(o.mouseData.minX=i<o.mouseData.minX?i:o.mouseData.minX,o.mouseData.maxX=i>o.mouseData.maxX?i:o.mouseData.maxX,o.mouseData.minY=c<o.mouseData.minY?c:o.mouseData.minY,o.mouseData.maxY=c>o.mouseData.maxY?c:o.mouseData.maxY);var l=Math.max(Math.round(o.mouseData.maxX-o.mouseData.minX),10*n/openCon.baseSize),d=Math.max(Math.round(o.mouseData.maxY-o.mouseData.minY),10*n/openCon.baseSize);o.mouseData.pointArr.push({x:i,y:c});var p=o.mouseData.minX!=o.mouseData.maxX||o.mouseData.minY!=o.mouseData.maxY;switch(o.curDrawType){case"pencil":if(p){var u={handleType:0,drawingType:0,id:o.svcId,specialValue:{owner:o.conf.type,color:confInfo.pencil.color,size:confInfo.pencil.size,canvasWidth:n,canvasHeight:r,child_div_W:l,child_div_H:d,margin_left:o.mouseData.minX,margin_top:o.mouseData.minY,point:o.mouseData.pointArr.slice(0)}};o.showPaint(u),o.clearConText()}break;case"highPencil":if(p){var u={handleType:0,drawingType:10,id:o.svcId,specialValue:{owner:o.conf.type,color:confInfo.highPencil.color,size:confInfo.highPencil.size,alpha:confInfo.highPencil.alpha,canvasWidth:n,canvasHeight:r,child_div_W:l,child_div_H:d,margin_left:o.mouseData.minX,margin_top:o.mouseData.minY,point:o.mouseData.pointArr.slice(0)}};o.showPaint(u),o.conf.canvas.targetBakContext.restore(),o.clearConText()}break;case"rect":if(p){l=o.mouseData.maxX-o.mouseData.minX,d=o.mouseData.maxY-o.mouseData.minY;var u={handleType:0,drawingType:2,id:o.svcId,specialValue:{owner:o.conf.type,color:confInfo.rect.color,size:confInfo.rect.size,canvasWidth:n,canvasHeight:r,child_div_W:l,child_div_H:d,margin_left:o.mouseData.minX,margin_top:o.mouseData.minY,point:o.mouseData.pointArr.slice(0)}};o.showPaint(u),o.clearConText()}break;case"rubberOld":var u={handleType:0,drawingType:3,id:o.svcId,specialValue:{owner:o.conf.type,color:confInfo.pencil.color,size:confInfo.rubberOld.size,canvasWidth:n,canvasHeight:r,child_div_W:l,child_div_H:d,margin_left:o.mouseData.minX,margin_top:o.mouseData.minY,point:o.mouseData.pointArr.slice(0)}},f=confInfo.rubberOld.size;o.conf.canvas.targetContext.clearRect(i-f/2,c-f/2,f,f),o.showPaint(u);break;case"rubberNew":var g=o.e_search(i,c);if(g){var u={handleType:0,drawingType:500,id:o.svcId,specialValue:{id:g.id,type:0}};switch(g.drawingType){case 0:g.color=confInfo.pencil.color;break;case 2:g.color=confInfo.rect.color;break;case 4:g.color=confInfo.text.fontColor;break;case 10:g.color=confInfo.targetSelect.color}o.showPaint(u),o.repaint()}else o.reInitColor(),o.repaint();break;case"text":if(o.textData.signTextDrag){var h=document.getElementById("input"),m=document.getElementById("edit"),v=document.getElementById("inputBak"),x=2*o.textData.inputBorder,T=Math.round(a(confInfo.text.fontSize*n/openCon.baseSize));o.textData.pointLeftTD=o.textData.pointXTD+i-o.mouseData.startX,o.textData.pointTopTD=o.textData.pointYTD+c-o.mouseData.startY,o.textData.pointXTD=o.textData.pointLeftTD+e.shiftX,o.textData.pointYTD=o.textData.pointTopTD+e.shiftY,o.textData.inputMaxWid=n-o.textData.pointXTD-x,o.textData.inputMaxHei=r-o.textData.pointYTD-x,h.style.maxWidth=o.textData.inputMaxWid+"px",h.style.maxHeight=o.textData.inputMaxHei+"px",v.style.maxWidth=o.textData.inputMaxWid+"px",v.style.maxHeight=o.textData.inputMaxHei+"px",h.style.left=o.textData.pointXTD+"px",h.style.top=o.textData.pointYTD+"px",h.style.minWidth=T+"px",h.style.minHeight=T+"px",o.textData.signTextDrag=!1,m.readOnly=""}break;case"draft":if(p){if((i-o.mouseData.startX!=0||c-o.mouseData.startY!=0)&&o.curTarget&&!o.textData.signREdit){var D=n/o.curTarget.canvasWidth;D*(o.curTarget.margin_left+o.curTarget.drag_left)<0&&(o.curTarget.drag_left=Math.round(0-o.curTarget.margin_left)),D*(o.curTarget.margin_top+o.curTarget.drag_top)<0&&(o.curTarget.drag_top=Math.round(0-o.curTarget.margin_top)),D*(o.curTarget.margin_left+o.curTarget.drag_left+o.curTarget.child_div_W)>n&&(o.curTarget.drag_left=Math.round((n-10)/D-o.curTarget.child_div_W-o.curTarget.margin_left)),D*(o.curTarget.margin_top+o.curTarget.drag_top+o.curTarget.child_div_H)>r&&(o.curTarget.drag_top=Math.round(r/D-o.curTarget.child_div_H-o.curTarget.margin_top)),o.clearConText();var u={handleType:0,drawingType:500,id:o.svcId,specialValue:{id:o.curTarget.id,type:1,drag_left:o.curTarget.drag_left,drag_top:o.curTarget.drag_top}};o.showPaint(u),o.curTarget.handle(o.conf.canvas.targetContext,2)}}else o.repaint();break;case"seal":o.sealData.getDrag({width:confInfo.seal.width,height:confInfo.seal.height,margin_left:o.mouseData.minX,margin_top:o.mouseData.minY,sealType:o.conf.canvas.seal.curType})}try{"text"!=o.curDrawType&&(o.clearConText(),t.preventDefault(),t.stopPropagation())}catch(t){}}o.outEvent=!1,"function"==typeof o.quickUpCb&&o.quickUpCb(t,o)},mouseout:function(t){var e=t.target||t.srcElement;o.outEvent=!0,o.downEvent&&"input"!=e.id&&"edit"!=e.id&&"text"!=o.curDrawType&&o.mouseup(),t.preventDefault(),t.stopPropagation()},key_event:function(t,e){o.textData.signTextDrag&&o.mouseup(),o.textData.textInput=t.innerText,document.getElementById("editBak").innerText="",document.getElementById("editBak").innerText=o.textData.textInput,document.getElementById("inputBak").scrollHeight!=document.getElementById("inputBak").clientHeight&&8!=e.keyCode&&46!=e.keyCode?(t.innerText=o.textData.lastTextInput,o.keyAction(t),e.preventDefault()):(o.textData.lastTextInput=o.textData.textInput,o.textData.textInput=""),document.getElementById("editBak").innerText=""},write_start:function(t,e){var n=document.getElementById("input"),r=document.getElementById("edit"),i=document.getElementById("editBak"),c=document.getElementById("inputBak"),s=o.conf.canvas.width,l=o.conf.canvas.height;r.autofocus="true",r.innerText="",o.textData.textInput="";var d=Math.round(a(confInfo.text.fontSize*s/openCon.baseSize)),p=Math.round((confInfo.text.fontSize+10)*s/openCon.baseSize),u=Math.round(4*s/openCon.baseSize);e=e+p+2*u>l?l-p-2*u:e,t=t+d+2*u>s?s-d-2*u:t,o.textData.inputBorder=u,o.textData.inputMaxWid=s-t-2*u,o.textData.inputMaxHei=l-e-2*u,o.textData.fontSize=d,n.style.border="dashed "+u+"px blue",n.style.zIndex=5,n.style.maxWidth=o.textData.inputMaxWid+"px",n.style.maxHeight=o.textData.inputMaxHei+"px",n.style.display="block",n.style.left=t+"px",n.style.top=e+"px",r.style.minWidth=d+"px",r.style.display="block",r.style.font="bold "+d+"px "+confInfo.text.fontStyle,c.style.border="dashed "+u+"px blue",c.style.maxWidth=o.textData.inputMaxWid+"px",c.style.maxHeight=o.textData.inputMaxHei+"px",i.style.font="bold "+d+"px "+confInfo.text.fontStyle,o.textData.pointXTD=t,o.textData.pointYTD=e,o.textData.pointLeftTD=t,o.textData.pointTopTD=e},write_writing:function(){"none"!=o.conf.paintBoard.css("display")&&o.write_end()},write_end:function(){var t=o.conf.canvas.width,e=o.conf.canvas.height,n=document.getElementById("input"),r=document.getElementById("edit"),i=document.getElementById("editBak"),c=document.getElementById("inputBak"),s=parseInt(n.scrollWidth),l=parseInt(n.scrollHeight);n.style.display="none";var d="",p="",u="",f=-1,g=-1,h=-1,m=0,v=0;if(d=r.innerHTML,d=o.removeDanger(d),v=d.length,-1!=d.indexOf("<div>")||-1!=d.indexOf("<br>")){for(m=0;v>m;m++){if(f=d.indexOf("<div>"),g=d.indexOf("<br>"),h=d.indexOf("</div>"),-1==f){if(-1==g){d=d.replace(/<\/div>/g,"");break}d=d.replace(/<br>/g,"\n");break}if(-1==g){d.replace(/<div>/g,"\n").replace(/<\/div>/g,"");break}f>g?d=d.replace(/<br>/,"\n"):h>g?d.replace(/<div>/,"\n").replace(/<\/div>/,"").replace(/<br>/,""):d.replace(/<div>/,"\n").replace(/<\/div>/,"")}d=-1!=d.indexOf("<div>")?d.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/<br>/g,""):d.replace(/<br>/g,"\n")}if(""!=d){var x="",T=0,D=0;i.innerText="";for(var _=0;_<d.length;_++,T++)"\n"!=d.charAt(_)&&"\r\n"!=d.charAt(_)?(i.innerText+=d.charAt(_),0!=D&&c.clientHeight>D&&Math.abs(c.clientHeight-D)>confInfo.text.fontSize/3?(x+="\n",p+=x,x=d.charAt(_)):x+=d.charAt(_),_+1==d.length&&(p+=x),D=c.clientHeight):(x+="\n",p+=x,x="",i.innerText="",D=c.clientHeight);i.innerText="",u=p}if(o.textData.signREdit){var w=o.curTarget.canvasWidth/t;o.curTarget.child_div_W=Math.round(s*w),o.curTarget.child_div_H=Math.round(l*w),o.curTarget.drag_left=Math.round(o.textData.pointXTD*w-o.curTarget.margin_left),o.curTarget.drag_top=Math.round(o.textData.pointYTD*w-o.curTarget.margin_top);var y={handleType:0,drawingType:500,id:o.svcId,specialValue:{id:o.curTarget.id,type:2,font:{font_color:confInfo.text.fontColor,font_size:Math.round(a(confInfo.text.fontSize*w)),font_style:confInfo.text.fontStyle},child_div_W:o.curTarget.child_div_W,child_div_H:o.curTarget.child_div_H,drag_left:o.curTarget.drag_left,drag_top:o.curTarget.drag_top,str_text:u}};o.curTarget.display=1,o.showPaint(y),o.textData.signREdit=!1}else if(""!=d){var y={handleType:0,drawingType:4,id:o.svcId,specialValue:{owner:o.conf.type,font:{font_color:confInfo.text.fontColor,font_size:Math.round(a(confInfo.text.fontSize*t/openCon.baseSize)),font_style:confInfo.text.fontStyle},canvasWidth:t,canvasHeight:e,child_div_W:s,child_div_H:l,margin_left:o.textData.pointXTD,margin_top:o.textData.pointYTD,str_text:u}};o.showPaint(y)}o.downEvent=!1,o.commentText=y.specialValue.str_text,r.innerText=""},inputRange:function(){var t=o.conf.paintBoard.input,e=o.conf.canvas.width,a=o.conf.canvas.height,n=parseInt(t[0].scrollWidth),r=parseInt(t[0].scrollHeight),i=parseInt(t.css("left").replace("px","")),c=parseInt(t.css("top").replace("px","")),s=0,l=0,d=2*o.textData.inputBorder;return i+n+d>=e&&(s=e-i-n-d),c+r+d>=a&&(l=a-c-r-d),0>i&&(s=0-i),0>c&&(l=0-c),{shiftX:s,shiftY:l}},removeDanger:function(t){var e=t;return e=e.replace(/&nbsp;/g," "),e=e.replace(/&amp;/g,"&"),e=e.replace(/&quot;/g,"\\"),e=e.replace(/&#039;/g,"'"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">")},keyAction:function(t){var e=t,a=window.getSelection(),n=document.createRange();n.selectNodeContents(e),n.collapse(!1),a.removeAllRanges(),a.addRange(n)},objFactory:function(t,e,a,n){var o=null;return o={handleType:t,drawingType:e,id:a,specialValue:n}},reEditText:function(t){t=t||window.event||arguments.callee.caller.arguments[0];var e=document.getElementById("input"),n=document.getElementById("edit"),r=document.getElementById("inputBak"),i=document.getElementById("editBak"),c=o.conf.canvas.width,s=o.conf.canvas.height;if(o.curTarget&&0==o.curTarget.handleType&&4==o.curTarget.drawingType){o.textData.signREdit=!0,o.curTarget.display=0,o.repaint();var l=o.curTarget.point_Arr_text,d=o.conf.canvas.width/o.curTarget.canvasWidth,p=Math.round(4*c/openCon.baseSize);o.textData.inputBorder=p,o.textData.inputMaxWid=c-(o.curTarget.drag_left+o.curTarget.margin_left)*d-2*p,o.textData.inputMaxHei=s-(o.curTarget.drag_top+o.curTarget.margin_top)*d-2*p,o.textData.fontSize=Math.round(a(o.curTarget.font_size*d)),e.style.border="dashed "+o.textData.inputBorder+"px red",e.style.zIndex=5,e.style.display="block",e.style.maxWidth=o.textData.inputMaxWid+"px",e.style.maxHeight=o.textData.inputMaxHei+"px",e.style.left=(o.curTarget.margin_left+o.curTarget.drag_left)*d+"px",e.style.top=(o.curTarget.margin_top+o.curTarget.drag_top)*d+"px",n.style.display="block",n.style.font="bold "+o.textData.fontSize+"px "+confInfo.text.fontStyle,i.style.font="bold "+o.textData.fontSize+"px "+confInfo.text.fontStyle,r.style.border="dashed "+o.textData.inputBorder+"px red",r.style.maxWidth=o.textData.inputMaxWid+"px",r.style.maxHeight=o.textData.inputMaxHei+"px",n.innerText=l,o.keyAction(n),o.textData.pointXTD=(o.curTarget.margin_left+o.curTarget.drag_left)*d,o.textData.pointYTD=(o.curTarget.margin_top+o.curTarget.drag_top)*d,o.textData.pointLeftTD=o.textData.pointXTD,o.textData.pointTopTD=o.textData.pointYTD}},reInitColor:function(){for(var t=o.recordConArr,e=0,a=t.length;a>e;e++)t[e].id==o.colorChangeId&&(4!=t[e].drawingType?t[e].color=o.colorName:t[e].font_color=o.colorName)},e_search:function(t,e){var a,n,r,i,c=o.conf.canvas.parentCon.offset();for(o.conf.canvas.left=c.left,o.conf.canvas.top=c.top,r=0,i=o.recordConArr.length;i>r;r++)if(a=o.recordConArr[r],n=o.conf.canvas.width/a.canvasWidth,0==a.handleType&&500!=a.drawingType&&3!=a.drawingType&&1==a.display&&(10!=a.drawingType||"draft"!=o.curDrawType)&&t>=(a.margin_left+a.drag_left)*n&&e>=(a.margin_top+a.drag_top)*n&&t<=(a.margin_left+a.child_div_W+a.drag_left)*n&&e<=(a.margin_top+a.child_div_H+a.drag_top)*n)return a;return null},showPaint:function(t){try{if(0==t.handleType){if(-1!=[0,2,3,4,10,20,500].indexOf(t.drawingType))if(500!=t.drawingType){var e=new r(t);e.init_paint(t),e.handle(o.conf.canvas.targetContext)}else switch(t.specialValue.type){case 0:var a=o.searchByID(t.specialValue.id);null!=a?(a.init_paint(t),o.repaint()):console.error("["+window.getTimeNow()+"]----------->error happened when new rubber: error id to new rubber");break;case 1:var a=o.searchByID(t.specialValue.id);null!=a?(a.init_paint(t),o.repaint()):console.error("["+window.getTimeNow()+"]----------->error happened when draft handle: error id to draft");break;case 2:var a=o.searchByID(t.specialValue.id);null!=a?(a.init_paint(t),o.repaint()):console.error("["+window.getTimeNow()+"]----------->error happened when reedit handle: error id to reedit")}}else 1==t.handleType?1==t.drawingType?o.draw("back",1):2==t.drawingType&&o.draw("clear",1):2==t.handleType}catch(a){console.error("["+window.getTimeNow()+"]----------->error happened when Paint update: "+a)}},searchByID:function(t){var e,a,n=o.recordConArr;for(e=0,a=n.length;a>e;e++)if(n[e].id==t&&0!=n[e].changeCount)return n[e];return null},handle_back:function(t){
var e,a;for(e=0,a=o.recordConArr.length;a>e;e++)if(o.recordConArr[e].id==t&&0!=o.recordConArr[e].changeCount){o.clearConText(1);var n=o.recordConArr[e];if(n.changeCount--,0==n.changeCount)n.display=0,o.svcId--;else{var r=n.Arr_data_handle.pop();if(500==r.drawingType&&0==r.specialValue.type)n.display=1;else{var i=n.Arr_data_handle[n.Arr_data_handle.length-1];n.init_paint(i,1)}}o.repaint()}},handle_clear:function(){for(var t,e=0,a=o.recordConArr.length;a>e;e++)t=o.recordConArr[e],t.display=0,t.changeCount=0;o.orderList.length=0,o.repaint(),o.svcId=1},clearConText:function(t){try{t?(o.conf.canvas.targetContext.clearRect(0,0,o.conf.canvas.width,o.conf.canvas.height),o.conf.canvas.targetBakContext.clearRect(0,0,o.conf.canvas.width,o.conf.canvas.height)):o.conf.canvas.targetBakContext.clearRect(0,0,o.conf.canvas.width,o.conf.canvas.height)}catch(e){}},repaint:function(t,e){t||o.clearConText(1);for(var a,n=0,r=o.recordConArr.length,i=e||o.conf.canvas.targetContext;r>n;)a=o.recordConArr[n],a.handle(i,2),n++},getOffset:function(t,e){return e||(e={},e.top=0,e.left=0),t==document.body?e:(e.top+=t.offsetTop,e.left+=t.offsetLeft,o.getOffset(t.parentNode,e))}},r=function(t){this.Arr_data_handle=new Array,this.version_type=o.conf.version,this.id=o.svcId,this.handleType=t.handleType,this.drawingType=t.drawingType,o.orderList.push(o.svcId),o.recordConArr.push(this),o.svcId++};return r.prototype.init_paint=function(t,e){if(e||this.Arr_data_handle.push(t),0==t.handleType)if(500!=t.drawingType)this.canvasWidth=t.specialValue.canvasWidth,this.canvasHeight=t.specialValue.canvasHeight,this.changeCount=1,this.display=1,this.child_div_W=t.specialValue.child_div_W,this.child_div_H=t.specialValue.child_div_H,this.margin_left=t.specialValue.margin_left,this.margin_top=t.specialValue.margin_top,this.drag_left=0,this.drag_top=0,4==t.drawingType?(this.font_color=t.specialValue.font.font_color,this.font_size=t.specialValue.font.font_size,this.font_style=t.specialValue.font.font_style,this.point_Arr_text=t.specialValue.str_text):20==t.drawingType?(this.sealWidth=t.specialValue.width,this.sealHeight=t.specialValue.height,this.sealType=t.specialValue.sealType):(this.color=t.specialValue.color,this.size=t.specialValue.size,this.point_Arr_text=t.specialValue.point),10==t.drawingType&&(this.alpha=t.specialValue.alpha);else switch(o.orderList.push(this.id),o.svcId++,e||this.changeCount++,t.specialValue.type){case 0:this.display=0;break;case 1:this.drag_left=t.specialValue.drag_left,this.drag_top=t.specialValue.drag_top;break;case 2:this.child_div_W=t.specialValue.child_div_W,this.child_div_H=t.specialValue.child_div_H,this.drag_left=t.specialValue.drag_left,this.drag_top=t.specialValue.drag_top,this.point_Arr_text=t.specialValue.str_text}else 1==t.handleType||2==t.handleType},r.prototype.handle=function(t){try{if(1==this.display)switch(this.drawingType){case 0:this.canvas_pencil(t);break;case 2:this.canvas_square(t);break;case 10:this.canvas_sign(t);break;case 20:this.canvas_seal(t);break;case 4:this.canvas_write(t);break;case 3:this.canvas_rubber(t)}}catch(e){console.error("["+window.getTimeNow()+"]----------->error happened when paint.prototype.handle : "+e)}},r.prototype.canvas_pencil=function(t){var e=o.conf.canvas.width/this.canvasWidth,a=o.conf.canvas.width/openCon.baseSize,n=this,r=Math.round(n.size*a);t.lineCap="round",t.lineJoin="round",t.strokeStyle=n.color,t.lineWidth=r,t.moveTo((this.point_Arr_text[0].x+this.drag_left)*e-o.conf.canvas.centerPX,(this.point_Arr_text[0].y+this.drag_top)*e-o.conf.canvas.centerPY),t.beginPath();for(var i=1;i<this.point_Arr_text.length;i++)t.lineTo((this.point_Arr_text[i].x+this.drag_left)*e-o.conf.canvas.centerPX,(this.point_Arr_text[i].y+this.drag_top)*e-o.conf.canvas.centerPY);t.stroke()},r.prototype.canvas_square=function(t){var e=o.conf.canvas.width/this.canvasWidth,a=o.conf.canvas.width/openCon.baseSize,n=this,r=Math.round(n.size*a),i=o.conf.canvas.centerPX,c=o.conf.canvas.centerPY;t.strokeStyle=n.color,t.lineJoin="round",t.lineWidth=r,t.moveTo((this.point_Arr_text[0].x+this.drag_left)*e-i,(this.point_Arr_text[0].y+this.drag_top)*e-c),t.beginPath(),t.lineTo((this.point_Arr_text[1].x+this.drag_left)*e-i,(this.point_Arr_text[0].y+this.drag_top)*e-c),t.lineTo((this.point_Arr_text[1].x+this.drag_left)*e-i,(this.point_Arr_text[1].y+this.drag_top)*e-c),t.lineTo((this.point_Arr_text[0].x+this.drag_left)*e-i,(this.point_Arr_text[1].y+this.drag_top)*e-c),t.lineTo((this.point_Arr_text[0].x+this.drag_left)*e-i,(this.point_Arr_text[0].y+this.drag_top)*e-c),t.closePath(),t.stroke()},r.prototype.canvas_sign=function(t){t.save();var e=o.conf.canvas.width/this.canvasWidth,a=o.conf.canvas.centerPX,n=o.conf.canvas.centerPY;t.lineCap="round",t.lineJoin="round",t.strokeStyle=this.color,t.globalAlpha=this.alpha,t.globalCompositeOperation="source-over",t.lineWidth=this.size*o.conf.canvas.width/openCon.baseSize,t.moveTo((this.point_Arr_text[0].x+this.drag_left)*e-a,(this.point_Arr_text[0].y+this.drag_top)*e-n),t.beginPath();for(var r=2;r<this.point_Arr_text.length;r++)t.lineTo((this.point_Arr_text[r].x+this.drag_left)*e-a,(this.point_Arr_text[r].y+this.drag_top)*e-n);t.stroke(),t.restore()},r.prototype.canvas_write=function(t){var e,n,r=this.point_Arr_text,i=o.conf.canvas.width/this.canvasWidth,c=(this.margin_top+this.drag_top)*i,s=(this.margin_left+this.drag_left)*i+o.textData.inputBorder,l=[];for(t.font="bold "+Math.round(a(this.font_size*i))+"px "+this.font_style,t.fillStyle=this.font_color,r.replace(/\r\n/g,"\n"),l=r.split(/\n/),e=0,n=l.length;n>e;e++)c+=(this.font_size+2.5)*i,t.fillText(l.shift(),s-o.conf.canvas.centerPX,c-o.conf.canvas.centerPY)},r.prototype.canvas_rubber=function(t){var e=o.conf.canvas.width/this.canvasWidth,a=this.size*e;t.lineCap="round",t.lineJoin="round";for(var n=0;n<this.point_Arr_text.length;n++)t.clearRect(this.point_Arr_text[n].x*e-a/2-o.conf.canvas.centerPX,this.point_Arr_text[n].y*e-a/2,a,a-o.conf.canvas.centerPY)},r.prototype.canvas_seal=function(t){var e=o.conf.canvas.width/this.canvasWidth,a=this.sealType,n=this.sealWidth*e,r=this.sealHeight*e,i=o.conf.canvas.seal.img[a];t.globalCompositeOperation="source-over",t.drawImage(i,(this.margin_left+this.drag_left)*e-o.conf.canvas.centerPX,(this.margin_top+this.drag_top)*e-o.conf.canvas.centerPY,n,r)},{initBoard:o.initWEBTools,mouseup:function(){o.mouseup()},draw:function(e,a){return o.isInited?void(-1!==n.indexOf(e)?(console.log("[ %s ]---------------------------------> change current tool : %s",t.getTimeNow(),e),o.draw(e,a)):(console.error("[ %s ]---------------------------------> error happened when change current tool , unopened tool or undefined tool is used : %s",t.getTimeNow(),e),a&&a("error"))):(console.error("[ %s ]---------------------------------> error happened when change current tool , please init white board first!",t.getTimeNow()),!1)},buildCurrentImg:function(e,a,n,r){null!==o.conf.canvas.target?(console.log("[ %s ]---------------------------------> build current canvas to base64 images",t.getTimeNow()),o.buildImg(e,a,n,r)):console.error("[ %s ]---------------------------------> error happened when build current canvas to base64 images : please init white board first!",t.getTimeNow())},changeSealSource:function(t){o.setSealIMG(t)},canvasResize:function(){return o.conf.canvas.parentCon?void o.review(o.conf.canvas.parentCon.width(),o.conf.canvas.parentCon.height()):void console.error("[ %s ]---------------------------------> error happened when resize canvas : please init white board first!",t.getTimeNow())}}}()}(window,jQuery);