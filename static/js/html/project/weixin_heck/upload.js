define("upload",["plupload"],function(e,t,n){var r=new function(){var e=this;e.upSign={expire:0},e.randomStr=function(e){var e=e||32,t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,r=[];for(i=0;i<e;i++)r.push(t.charAt(Math.floor(Math.random()*n)));return r.join("")},e.getSuffix=function(e){var t=e.lastIndexOf(".");return t>-1?e.substring(t):void 0},e.getRandomName=function(t){return e.randomStr(20)+e.getSuffix(t)},e.getNativeName=function(e){var t=e.lastIndexOf(".");return t>-1?e.slice(0,t)+"_"+Math.round((new Date).getTime()/1e3)+e.slice(t):void 0},e.getSign=function(){return $.ajax({url:"/AdminContact/upload",type:"post",dataType:"json",success:function(t){e.upSign=t},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")},async:!1})},e.previewImage=function(e,t){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var n=new mOxie.FileReader;n.onload=function(){t(n.result),n.destroy(),n=null},n.readAsDataURL(e.getSource())}else{var r=new mOxie.Image;r.onload=function(){var e="image/jpeg"==r.type?r.getAsDataURL("image/jpeg",80):r.getAsDataURL();t&&t(e),r.destroy(),r=null},r.load(e.getSource())}},e.init=function(t){var n={browse_button:"send_img_btn",container:"send_img",progress:function(){},filters:{max_file_size:"5120kb"},rename:!0},r=$.extend(!0,{},n,t),i=new plupload.Uploader({url:"http://oss.aliyuncs.com",runtimes:"html5,flash,silverlight,html4",browse_button:r.browse_button,container:r.container,filters:r.filters,init:{PostInit:function(){console.log("upload init")},FilesAdded:function(e,t){e.start()},BeforeUpload:function(t,n){var i=Math.ceil((new Date).getTime()/1e3),a=8;i+a>e.upSign.expire&&e.getSign(),n.fileName=r.rename?e.getRandomName(n.name):e.getNativeName(n.name),n.fileKey=e.upSign.dir+n.fileName,n.fileFullName=e.upSign.host+"/"+e.upSign.dir+n.fileName,new_multipart_params={key:n.fileKey,policy:e.upSign.policy,OSSAccessKeyId:e.upSign.accessid,success_action_status:"200",signature:e.upSign.signature},t.setOption({url:e.upSign.host,multipart_params:new_multipart_params}),r.progress()&&(r.progress().style.width="0%"),!!r.BeforeUpload&&r.BeforeUpload(t,n,e.previewImage)},UploadProgress:function(e,t){r.progress()&&(r.progress().style.width=t.percent+"%"),!!r.UploadProgress&&r.UploadProgress.apply(null,arguments)},FileUploaded:function(e,t,n){r.progress()&&(r.progress().style.width="0%");var i=arguments;200==n.status?!!r.FileUploaded&&r.FileUploaded.apply(null,i):console.log(n.response)},Error:function(e,t){console.log("error"+e,t),r.progress()&&(r.progress().style.width="0%"),-600==t.code&&alert("\u6700\u5927\u53ea\u80fd\u53d1\u90015M\u7684\u6587\u4ef6\uff01"),!!r.Error&&r.Error.apply(null,arguments)}}});i.init()}};n.exports=r});