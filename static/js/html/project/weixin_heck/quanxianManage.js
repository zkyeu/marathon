define("quanxianManage",["niceScroll"],function(a,e,t){function n(){u.request("GET","/AuthGroup/authGroupList",{},function(a){if(1e4!=a.status)return alert(a.message);var e=a.message.length;e||($(".table-detail").hide(),$(".table-box h5").show()),$(".table-detail").show();for(var t="",n=a.message,s=0;e>s;s++){var i=n[s].id,r=n[s].alias_name,o=n[s].admin_id,l=n[s].admin_name;t+="<tr><td>"+l+"</td>",t+='<td style="text-align: left;">'+r+"</td>",t+='<td><span data-name="'+l+'" data-alias_name="'+r+'" data-eid="'+o+'" class="edit">\u7f16\u8f91</span><span data-id="'+i+'" class="del">\u5220\u9664</span></tr>'}$(".sel-dom").html(t)})}function s(){u.request("GET","/AuthGroup/getCrmGroup",{},function(a){if(1e4!=a.status)return alert(a.message);var e=a.message.length,t="";if(0!=e){for(var n=0;e>n;n++)t+='<span data-name="'+a.message[n]+'">'+a.message[n]+"</span>";$(".manage-name-list").html(t).niceScroll(),$(".name-list").show(),d()}})}function i(){for(var a=$("#admin_name").val(),e=[],t=$(".manage-name-list span.group-sel"),n=0;n<t.length;n++)e.push(t[n].innerText);return""==a?(alert("\u8bf7\u8f93\u5165CRM\u8d26\u53f7\uff01"),!1):0==e.length?(alert("\u8bf7\u9009\u62e9\u7ba1\u7406\u7ec4"),!1):void r($(".edit-layer").attr("data-etid"),a,e.join(","))}function r(a,e,t){u.request("POST","/AuthGroup/hasAuthGroup",{user_name:e},function(a){return 1e4!=a.status?alert(a.message):void(void 0!=a.message.id?($(".edit-layer").hide(),$(".doLayer-w2 .confirm").attr("style","display:inline-block"),$(".doLayer-w2").show(),$(".doLayer-w2 .confirm").on("click",function(){l(a.message.admin_id,t)})):o(e,t))})}function o(a,e){u.request("POST","/AuthGroup/saveAuthGroup",{admin_name:a,group_alias:e},function(a){return 1e4!=a.status?alert(a.message):(alert(a.message),n(),void c.hide())})}function l(a,e){u.request("POST","/AuthGroup/updateAuthGroup",{admin_id:a,group_alias:e},function(a){return 1e4!=a.status?alert(a.message):(alert(a.message),n(),void c.hide())})}function d(){var a=$(".manage-name-list span");a.on("click",function(){$(this).hasClass("group-sel")?$(this).removeClass("group-sel"):$(this).addClass("group-sel")})}var u={request:function(a,e,t,n,s){$.ajax({url:e,type:a,data:t,dataType:"JSON",success:function(a){n(a)},error:s})}};n();var m=$(".edit-layer .confirm"),c=$("#maskLayer"),h=$(".edit-layer"),g=$(".concel");$("#addNew").on("click",function(){$(".doLayer-w1 .edit").hide(),$("#admin_name").val(""),$("#group_alias").val(""),m.attr("style","display:inline-block"),c.show(),h.show(),$(".doLayer-w2").hide(),s()}),m.on("click",function(){i()}),g.on("click",function(){c.hide(),$(".doLayer-w1").removeAttr("data-etid")}),$("body").on("click",".del",function(){var a=$(this).data("id"),e=$(this).siblings("span").data("name");if(console.log(e),confirm("\u786e\u5b9a\u8981\u5220\u9664"+e+"\u7684\u6743\u9650\u5417\uff1f")){var t=$(this).parent().parent().remove();u.request("POST","/AuthGroup/delAuthGroup",{id:a},function(a){return 1e4!=a.status?alert(a.message):(alert(a.message),void t.remove())})}}),$("body").on("click","td .edit",function(){$(".doLayer-w2").hide(),m.removeAttr("style"),$(".doLayer-w1 .edit").attr("style","display:inline-block");var a=$(this).data("eid");console.log("\u8bbe\u7f6e\u5f53\u524d:"+a),$(".edit-layer").attr("data-etid",a);var e=$(this).data("name"),t=$(this).data("alias_name");$("#admin_name").val(e),$("#group_alias").val(t),u.request("POST","/AuthGroup/getCrmGroupByEdit",{admin_id:a},function(a){if(1e4!=a.status)return alert(a.message);var e=a.message.length,t="";if(0!=e){for(var t="",n=0;e>n;n++){var s=a.message[n].group_alias,i=a.message[n].is_check;t+=i?'<span class="group-sel" data-name="'+s+'">'+s+"</span>":'<span data-name="'+s+'">'+s+"</span>"}$(".manage-name-list").html(t).niceScroll(),$(".name-list").show(),d()}}),c.show(),h.show()}),$(".doLayer-w1 .edit").on("click",function(){for(var a=$("#admin_name").val(),e=$(".doLayer-w1").attr("data-etid"),t=[],n=$(".manage-name-list span.group-sel"),s=0;s<n.length;s++)t.push(n[s].innerText);return""==a?(alert("\u8bf7\u8f93\u5165CRM\u8d26\u53f7\uff01"),!1):0==t.length?(alert("\u8bf7\u9009\u62e9\u7ba1\u7406\u7ec4"),!1):void l(e,t.join(","))})});