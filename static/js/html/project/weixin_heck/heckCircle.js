define("heckCircle",["plupload","niceScroll","fancybox"],function(e,t,n){function a(){var e=window.location.href;return e.indexOf("manageMomentLibrary")>0?!0:!1}e("niceScroll"),e("fancybox"),$("[rel=gallery]").fancybox({openEffect:"none",closeEffect:"none"}),$.fn.heckScroll=function(){var e=$(this);return e.niceScroll({cursorcolor:"#686b71",autohidemode:!0,cursorwidth:7,cursorborderradius:"999px",cursorborder:0,horizrailenabled:!1}),e};var o=$(".message_center_con");o.heckScroll().on("click","li",function(){var e=$(this);url=e.attr("data-url"),url&&(window.open(url),e.remove(),0==o.find("li").length&&o.find("ul").append('<li class="message_none">\u6682\u65e0\u65b0\u7684\u6d88\u606f</li>'))}),$(".ifra").heckScroll();var s=$(".ifr");s.find("iframe");$(".Circle_library").on("click",function(){var e=s.find("iframe");e.attr("src",e.attr("data-src")),s.show()}),s.find("span").click(function(){s.hide()});var r=Number($(".friend_comment h6 em").text());0>=r&&$(".friend_comment").hide(),window.onscroll=function(){$(document).scrollTop()>80?$(".uptop").show():$(".uptop").hide()},$(".uptop").click(function(){$("html,body").animate({scrollTop:0},500)}),$(".content").heckScroll(),$(".already_send").find("ul").heckScroll();var l=function(e,t,n){$.ajax({url:"/CircleFriend/giveLikeCircleFriend",type:"post",dataType:"json",data:{status:e,wechat_mid:t},success:function(e){return 1e4!=e.status?alert(e.message):void n.apply(null,arguments)},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}})};$(".already_send_mes").on("click",".close_btn",function(){var e=$(this).closest(".already_mes").attr("wechat-mid"),t=$(this).attr("delet-url");console.log(e),window.confirm("\u786e\u8ba4\u5220\u9664\u6b64\u6761\uff1f")&&$.ajax({url:t,type:"post",dataType:"json",data:{wechat_mid:e},success:function(e){1e4==e.status?window.location.reload():10020==e.status?window.location="/AdminContact/guide":alert(e.message)},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}})}).on("click",".js-like-mes",function(){var e=$(this),t=e.closest(".already_mes").attr("wechat-mid"),n=!e.hasClass("not-like"),a=e.attr("data-like"),i=e.closest(".comment_people"),o=i.find(".comment_like"),s=i.find(".comment_h"),r=$("#data-self"),c=r.attr("data-nick"),d=r.attr("wechat-id"),m={username:d,nickname:c},f=function(e){return $.map(e,function(e,t){return e.nickname}).join("\uff0c")};a=a?JSON.parse(e.attr("data-like")):[],n?l(1,t,function(){e.addClass("like-animate").one("animationend",function(){e.removeClass("like-animate"),e.addClass("not-like")}),$.map(a,function(e,t){var n=e.username;n==d&&a.splice(t,1)}),0==a.length?(o.remove(),e.attr("data-like","")):(o.html(f(a)),e.attr("data-like",JSON.stringify(a)))}):l(0,t,function(){e.addClass("like-animate").one("animationend",function(){e.removeClass("like-animate"),e.removeClass("not-like")}),a.push(m),1==a.length?s.prepend('<div class="comment_like">'+f(a)+"</div>"):o.html(f(a)),e.attr("data-like",JSON.stringify(a))})});var c=$(".zhuanfa-layer");$(".js-broad-mes").on("click",function(e){c.show(),c.find(".confirm").attr("data-id",$(this).attr("data-admin-id"));var t=$(this).attr("data-share-words");c.find("textarea").val(t)}),c.find(".confirm").on("click",function(){var e=c.find("textarea").val(),t=c.find(".confirm").attr("data-id");$.ajax({url:"/CircleFriend/transmitCircleFriend",dataType:"json",data:{wechat_mid:t,share_word:e},type:"post",success:function(e){return console.log(e.status,e.message),console.log(1e4!=e.status),1e4!=e.status?alert(e.message):($(".zhuanfa-layer").attr("style","display:none"),void console.log("hide ok"))},error:function(e){}})}),c.find(".concel").on("click",function(){c.find("textarea").val(""),c.hide()});var d,m,f,u,h,p,g,v,w,_=function(){var e=$(".up_img"),t=e.children("ul"),n=t.find(".add_img");return $browse=$("#browse"),close,close=function(){window.confirm("\u786e\u8ba4\u5173\u95ed\u5220\u9664\u56fe\u7247\u5417\uff1f")&&(t.find(".js-check").remove(),e.hide(),d.splice(0,20),t.find(".js-addP").parent().remove())},e.on("click","p>span",close),t.on("click","#addImg",function(){$browse.trigger("click")}).on("click","li>span",function(){var e=$(this),n=e.siblings("img").attr("imgId");d.removeFile(n),e.parent().remove(),t.find("li").length<=10&&$(".add_img").show()}).on("click","li>i",function(){var e=$(this);e.parent().remove(),t.find("li").length<=10&&$(".add_img").show()}),{close:close,open:function(){e.show()},setCon:function(e){var t=[];$.map(e,function(e,n){t.push('<li><img src="'+e.imgSrc+'" imgId="'+e.imgId+'"class="js-addP" /><span>&times;</span></li>')}),e.length<=9&&(n.before(t.join("")),$(".add_img").show())}}},k=_(),y={expire:0};m=function(){var e=Math.ceil((new Date).getTime()/1e3),t=y.expire,n=8,a=0>=t-(e+n);a&&$.ajax({url:"/AdminContact/upload",type:"post",dataType:"json",success:function(e){y=e},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")},async:!1})},f=function(e,t){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var n=new mOxie.FileReader;n.onload=function(){t(n.result),n.destroy(),n=null},n.readAsDataURL(e.getSource())}else{var a=new mOxie.Image;a.onload=function(){var e="image/jpeg"==a.type?a.getAsDataURL("image/jpeg",80):a.getAsDataURL();t&&t(e),a.destroy(),a=null},a.load(e.getSource())}},u=function(e,t){var n=e.length,a=[];$.map(e,function(e,i){f(e,function(i){a.push({imgId:e.id,imgSrc:i}),n--,0==n&&"function"==typeof t&&t(a)})})},h=function(e){var e=e||32,t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,a=[];for(i=0;i<e;i++)a.push(t.charAt(Math.floor(Math.random()*n)));return a.join("")},p=function(e){var t=e.lastIndexOf(".");return t>-1?e.substring(t):void 0},g=function(e){return h(20)+p(e)},v=function(e){var t=$(".send_to_user").attr("ajax-url"),n={url:t,type:"post",dataType:"json",success:function(e){1e4==e.status?window.location.reload():10020==e.status?window.location="/AdminContact/guide":($(".load_up").hide(),alert(e.message))},error:function(){$(".load_up").hide(),alert("\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01")},complete:function(){$(".load_up").hide()}},a=$.extend({},n,e);$.ajax(a)},w=function(e){d=new plupload.Uploader({url:"http://oss.aliyuncs.com",runtimes:"html5,silverlight,html4",browse_button:"browse",container:"select_mes",filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png,bmp"}],max_file_size:"5120kb"},init:{PostInit:function(){console.log("upload init")},FilesAdded:function(e,t){var n=$(".up_img").find(".js-check");e.files.length>9-n.length?(alert("\u4e0a\u4f20\u56fe\u7247\u6570\u4e0d\u80fd\u591a\u4e8e9\u5f20"),e.splice(0,100)):e.files.length<9-n.length?u(t,function(e){k.setCon(e),k.open()}):e.files.length==9-n.length&&(console.log(e.files.length),u(t,function(e){k.setCon(e),k.open(),$(".add_img").hide()}))},BeforeUpload:function(e,t){m(),t.fileName=g(t.name),t.fileKey=y.dir+t.fileName,t.fileFullName=y.host+"/"+y.dir+t.fileName,new_multipart_params={key:t.fileKey,policy:y.policy,OSSAccessKeyId:y.accessid,success_action_status:"200",signature:y.signature},e.setOption({url:y.host,multipart_params:new_multipart_params})},UploadProgress:function(e,t){},FileUploaded:function(e,t,n){},UploadComplete:function(t,n){"function"==typeof e.complete&&e.complete(t,n)},FilesRemove:function(e,t){},Error:function(e,t){console.log("error "+e,t)}}}),window.uploader=d,d.init()},w({complete:function(e,t){var n=$.map(t,function(e,t){return e.fileKey}),a=[],i=$(".js-check");if(i.length>0)for(var o=0;o<i.length;o++)a.push(i.eq(o).find("img").attr("src"));var s={text:b,imgHost:y.host,imgSrc:n.join(","),imgCirSrc:a.join(","),arrShow:x};v({data:s})}}),$.fn.insertText=function(e){return this.each(function(){if("INPUT"===this.tagName||"TEXTAREA"===this.tagName)if(document.selection){this.focus();var t=document.selection.createRange();t.text=e,t.collapse(),t.select()}else if(void 0!==this.selectionStart){var n=this.selectionStart,a=this.selectionEnd;this.value=this.value.substring(0,n)+e+this.value.substring(a,this.value.length),this.selectionStart=this.selectionEnd=n+e.length}else this.value+=e}),this},$(".smail").on("click","em",function(e){$(".face_panel").fadeIn(),e.stopPropagation()}),$(window).on("click",function(){$(".face_panel").fadeOut()}),$(".face_con").on("click",".qqface",function(){var e=$(this),t=$("textarea"),n="/"+e.attr("title");t.val();t.insertText(n)});var b,j=$(".send_message textarea"),x=["all"];$("#start_upload").on("click",function(){b=$.trim(j.val());var e=d.files.length;if(!a()&&0==$(".choose-show").length&&0==$(".choose-show2").length)return alert("\u8bf7\u52fe\u9009\u81f3\u5c11\u4e00\u4e2a\u670b\u53cb\u5708\u53ef\u89c1\u6807\u7b7e\uff01");if($(".choose-show2").length>0)x="";else{x=[];var t=$(".choose-show");$.each(t,function(e,t){var n=$(t).attr("label-value");x.push(n)})}if(console.log("\u6807\u7b7e\u662f:"+x),0==e){var n=[],i=$(".js-check");if(i.length>0)for(var o=0;o<i.length;o++)n.push(i.eq(o).find("img").attr("src"));var s={text:b,imgCirSrc:n.join(","),arrShow:x};console.log(s),v({data:s})}else $(".load_up").show(),d.start()});var C,S,I=$(".comment_people");I.on("click",".js-back-mes",function(){var e=$(this);if($(".comment_b").remove(),S=e.attr("wechat-rid")||"",C=e.attr("back-name")||"",0==e.closest(".comment_people").find("textarea").length){var t='<div class="comment_b"><dt>'+S+'</dt><dd><span class="re_con">\u56de\u590d'+C+'\uff1a</span><textarea></textarea><div class="com-btn"><a href="javascript:;" class="js-sure-back" wechat_name='+C+'>\u53d1\u5e03</a><a href="javascript:;" class="js-close">\u53d6\u6d88</a></div></dd></div>';e.closest(".comment_people").find(".comment_h").append(t)}}),I.on("click",".js-sure-back",function(){var e=$(this),t=e.closest(".already_mes").attr("wechat-mid"),n=e.closest(".comment_people").find("textarea").val(),a=e.attr("wechat_name");console.log(t,S,n,a),n.length?$.ajax({url:"/CircleFriend/commentMoments",type:"post",data:{wechat_mid:t,wechat_rid:S,wechat_name:a,weiVal:n},dataType:"json",success:function(e){if(1e4==e.status){var t;t=0==a.length?'<div class="comment_g"><p><em>\u6211:</em>'+n+"</p></div>":'<div class="comment_g"><p><em>\u6211</em>\u56de\u590d<em>'+C+":</em>"+n+"</p></div>",$(".comment_b").before(t),$(".comment_b").remove()}else alert(e.message)},error:function(){alert("\u7f51\u7edc\u9519\u8bef\u8bf7\u91cd\u8bd5\uff01")}}):alert("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a!")}),I.on("click",".js-close",function(){$(".comment_b").remove()}),I.on("click","h2",function(){if(0==$(this).parent().find("input").length){var e='<div class="comment_b"><dt>'+S+'</dt><dd><textarea placeholder="\u56de\u590d\uff1a"></textarea><div class="com-btn"><a href="javascript:;" class="js-sure-back">\u53d1\u5e03\u8bc4\u8bba</a><a href="javascript:;" class="js-close">\u53d6\u6d88</a></div></dd></div>';$(this).parent().append(e)}}),window.closeIfr=function(){s.hide();var e=sessionStorage.getItem("text"),t=$(".up_img"),n=t.children("ul"),a=sessionStorage.getItem("imgArr");a||(a="");var i=a.split(","),o=sessionStorage.getItem("flag"),r=$(".up_img");1==o&&(""!=$(".send_message").find("textarea").val()?confirm("\u60a8\u786e\u5b9a\u8981\u653e\u5f03\u73b0\u5728\u7f16\u8f91\u7684\u5185\u5bb9\u5417\uff1f")&&$(".send_message").find("textarea").val(e):$(".send_message").find("textarea").val(e),""!=a&&(i.length<9&&i.length>=1?(n.find(".js-check").remove(),d.splice(0,20),n.find(".js-addP").parent().remove(),r.find(".add_img").before(i.join("")),r.show(),r.find(".add_img").show()):9==i.length&&(n.find(".js-check").remove(),d.splice(0,20),n.find(".js-addP").parent().remove(),r.find(".add_img").before(i.join("")),r.find(".add_img").hide(),r.show())),sessionStorage.setItem("flag",0),sessionStorage.setItem("text",""),sessionStorage.setItem("imgArr",""))},function(){var e=$(".show-lable span[label-value=all]"),t=$(".show-lable span[label-value!=all]");e.on("click",function(){e.hasClass("choose-show2")?(e.removeClass("choose-show2"),t.removeClass("choose-show")):(e.addClass("choose-show2"),t.addClass("choose-show"))}),t.on("click",function(){var n=$(this);n.hasClass("choose-show")?n.removeClass("choose-show"):n.addClass("choose-show"),t.length!=$(".choose-show").length?e.removeClass("choose-show2"):e.addClass("choose-show2")})}()});